<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>USMLE Mobile</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: #1a73e8;
            color: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }

        .icon-btn:active {
            background: rgba(255,255,255,0.3);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            padding: 8px 0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            background: none;
            border: none;
            color: #666;
            font-size: 11px;
            cursor: pointer;
        }

        .nav-item.active {
            color: #1a73e8;
        }

        .nav-item:active {
            background: #f0f0f0;
        }

        .nav-icon {
            font-size: 24px;
        }

        /* Main Content */
        .content {
            padding: 16px;
            padding-bottom: 80px;
            min-height: calc(100vh - 64px);
        }

        /* View Screens */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Search */
        .search-box {
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
        }

        .search-input:focus {
            border-color: #1a73e8;
        }

        /* Topics List */
        .topic-group {
            background: white;
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .topic-header {
            background: #f8f9fa;
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            border: none;
            width: 100%;
            text-align: left;
        }

        .topic-header:active {
            background: #e9ecef;
        }

        .topic-arrow {
            transition: transform 0.3s;
            font-size: 14px;
        }

        .topic-header.expanded .topic-arrow {
            transform: rotate(180deg);
        }

        .subtopics {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .subtopics.expanded {
            max-height: 2000px;
        }

        .subtopic-item {
            padding: 12px 16px 12px 32px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background: white;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .subtopic-item:active {
            background: #f8f9fa;
        }

        .question-count {
            font-size: 12px;
            background: #e8f0fe;
            color: #1a73e8;
            padding: 4px 8px;
            border-radius: 12px;
        }

        /* Question View */
        .question-container {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .question-number {
            font-weight: 600;
            color: #1a73e8;
        }

        /* Sidebar Toggle Button */
        .sidebar-toggle {
            position: fixed;
            left: 16px;
            bottom: 90px;
            width: 44px;
            height: 44px;
            background: #1a73e8;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 90;
            display: none;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        /* Show sidebar toggle only in question view */
        .view.active .sidebar-toggle {
            display: flex;
        }

        .sidebar-toggle:active {
            transform: scale(0.95);
        }

        /* Questions Sidebar */
        .questions-sidebar {
            position: fixed;
            left: -100%;
            top: 60px;
            width: 280px;
            height: calc(100vh - 60px - 70px);
            background: white;
            box-shadow: 2px 0 8px rgba(0,0,0,0.2);
            transition: left 0.3s ease;
            z-index: 95;
            overflow-y: auto;
            padding: 16px;
        }

        .questions-sidebar.open {
            left: 0;
        }

        .sidebar-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-list-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .question-list-item:active {
            background: #e0e0e0;
        }

        .question-list-item.current {
            background: #e8f0fe;
            border-color: #1a73e8;
        }

        .question-list-item.correct {
            background: #e8f5e9;
            border-left: 4px solid #34a853;
        }

        .question-list-item.incorrect {
            background: #fce8e6;
            border-left: 4px solid #ea4335;
        }

        .question-list-item.flagged {
            background: #fef7e0;
            border-left: 4px solid #fbbc04;
        }

        /* Current question takes priority over other states */
        .question-list-item.current.correct {
            background: #c8e6c9;
            border-color: #34a853;
        }

        .question-list-item.current.incorrect {
            background: #ffcdd2;
            border-color: #ea4335;
        }

        .question-list-item.current.flagged {
            background: #fff9c4;
            border-color: #fbbc04;
        }

        .question-list-id {
            font-weight: 600;
            color: #1a73e8;
            font-size: 14px;
        }

        .question-list-status {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            display: flex;
            gap: 8px;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 70px;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 90;
        }

        .sidebar-overlay.open {
            display: block;
        }

        .question-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            background: none;
            border: 1px solid #ddd;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .action-btn:active {
            background: #f0f0f0;
        }

        .action-btn.flagged {
            background: #fbbc04;
            border-color: #fbbc04;
            color: white;
        }

        .action-btn.correct {
            background: #34a853;
            border-color: #34a853;
            color: white;
        }

        .action-btn.incorrect {
            background: #ea4335;
            border-color: #ea4335;
            color: white;
        }

        .answer-selector {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .answer-selector label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            white-space: nowrap;
        }

        .answer-dropdown {
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 18px;
            background: white;
            color: #202124;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 50px;
            height: 36px;
            text-align: center;
        }

        .answer-dropdown:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .question-iframe {
            width: 100%;
            border: none;
            min-height: 500px;
            border-radius: 8px;
        }

        .question-nav {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .nav-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            background: white;
            border: 2px solid #ddd;
            color: #333;
        }

        .nav-btn:active {
            background: #f0f0f0;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn.primary {
            background: #1a73e8;
            border-color: #1a73e8;
            color: white;
        }

        .nav-btn.primary:active {
            background: #1557b0;
        }

        /* Backup Section */
        .backup-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .backup-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1a73e8;
        }

        .backup-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .backup-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .backup-btn.download {
            background: #34a853;
            color: white;
        }

        .backup-btn.upload {
            background: #1a73e8;
            color: white;
        }

        .backup-btn.clear {
            background: white;
            border: 2px solid #ea4335;
            color: #ea4335;
        }

        .backup-btn:active {
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #1a73e8;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .modal-text {
            font-size: 14px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn.primary {
            background: #1a73e8;
            color: white;
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f0f0f0;
            border-top: 3px solid #1a73e8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Search ID Input */
        .search-id-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .search-id-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
        }

        .search-id-btn {
            padding: 12px 20px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
        }

        .search-id-btn:active {
            background: #1557b0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-text {
            font-size: 16px;
            color: #666;
        }

        /* File input hidden */
        input[type="file"] {
            display: none;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s, transform 0.3s;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-box {
            background: white;
            padding: 40px 32px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 320px;
            width: 90%;
        }

        .login-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 24px;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 8px;
            transition: border-color 0.2s;
        }

        .login-input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .login-error {
            color: #d32f2f;
            font-size: 13px;
            margin-bottom: 16px;
            min-height: 20px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .login-btn:hover {
            background: #1557b0;
        }

        .login-btn:active {
            transform: scale(0.98);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Hide app content until authenticated */
        body:not(.authenticated) .header,
        body:not(.authenticated) .content,
        body:not(.authenticated) .bottom-nav {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="login-screen">
        <div class="login-box">
            <div class="login-icon">üîí</div>
            <div class="login-title">USMLE Mobile</div>
            <div class="login-subtitle">Enter password to access</div>
            <input
                type="password"
                class="login-input"
                id="password-input"
                placeholder="Password"
                onkeypress="if(event.key === 'Enter') checkPassword()"
            />
            <div class="login-error" id="login-error"></div>
            <button class="login-btn" onclick="checkPassword()">Unlock</button>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-title">USMLE Mobile</div>
        <div class="header-actions">
            <button class="icon-btn" id="backupBtn" title="Backup">üíæ</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content">
        <!-- Topics View -->
        <div class="view active" id="topicsView">
            <div class="search-box">
                <input type="text" class="search-input" id="topicSearch" placeholder="üîç Search topics...">
            </div>
            <div id="topicsList"></div>
        </div>

        <!-- Search ID View -->
        <div class="view" id="searchView">
            <div class="search-id-container">
                <input type="text" class="search-id-input" id="questionIdInput" placeholder="Enter Question ID (or comma-separated IDs: 174, 556, 1340)">
                <button class="search-id-btn" onclick="searchQuestionById()">Go</button>
            </div>
            <div id="searchResults"></div>
        </div>

        <!-- Question View -->
        <div class="view" id="questionView">
            <!-- Sidebar Toggle Button -->
            <button class="sidebar-toggle" onclick="toggleSidebar()" id="sidebarToggle">
                ‚ò∞
            </button>

            <!-- Sidebar Overlay -->
            <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

            <!-- Questions Sidebar -->
            <div class="questions-sidebar" id="questionsSidebar">
                <div class="sidebar-header">
                    <span>Questions</span>
                    <button class="sidebar-close" onclick="closeSidebar()">√ó</button>
                </div>
                <div id="questionsList">
                    <!-- Question list items will be added here dynamically -->
                </div>
            </div>

            <div class="question-container">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Question #</span>
                    <div class="question-actions">
                        <div class="answer-selector">
                            <label for="answer-select">Ans:</label>
                            <select id="answer-select" class="answer-dropdown" onchange="saveSelectedAnswer()">
                                <option value="">-</option>
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="G">G</option>
                                <option value="H">H</option>
                                <option value="I">I</option>
                                <option value="J">J</option>
                                <option value="K">K</option>
                                <option value="L">L</option>
                                <option value="M">M</option>
                                <option value="N">N</option>
                                <option value="O">O</option>
                                <option value="P">P</option>
                                <option value="Q">Q</option>
                                <option value="R">R</option>
                                <option value="S">S</option>
                                <option value="T">T</option>
                                <option value="U">U</option>
                                <option value="V">V</option>
                                <option value="W">W</option>
                                <option value="X">X</option>
                                <option value="Y">Y</option>
                                <option value="Z">Z</option>
                            </select>
                        </div>
                        <button class="action-btn" id="correctBtn" onclick="markQuestion('correct')" title="Mark Correct">‚úì</button>
                        <button class="action-btn" id="incorrectBtn" onclick="markQuestion('incorrect')" title="Mark Incorrect">‚úó</button>
                        <button class="action-btn" id="flagBtn" onclick="toggleFlag()" title="Flag">üö©</button>
                    </div>
                </div>
                <iframe id="questionIframe" class="question-iframe"></iframe>
                <div class="question-nav">
                    <button class="nav-btn" id="prevBtn" onclick="previousQuestion()">‚Üê Previous</button>
                    <button class="nav-btn primary" id="nextBtn" onclick="nextQuestion()">Next ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Backup View -->
        <div class="view" id="backupView">
            <div class="backup-card">
                <div class="backup-title">üìä Your Progress</div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="totalAnswered">0</div>
                        <div class="stat-label">Answered</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalCorrect">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalIncorrect">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalFlagged">0</div>
                        <div class="stat-label">Flagged</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="accuracyRate">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
            </div>

            <div class="backup-card">
                <div class="backup-title">üíæ Backup & Sync</div>
                <div class="backup-info">
                    Download your progress to use on desktop or upload a backup from your computer to continue studying.
                </div>
                <button class="backup-btn download" onclick="downloadBackup()">
                    üì• Download Backup
                </button>
                <button class="backup-btn upload" onclick="document.getElementById('uploadInput').click()">
                    üì§ Upload Backup
                </button>
                <input type="file" id="uploadInput" accept=".json" onchange="uploadBackup(event)">
                <button class="backup-btn clear" onclick="confirmClearData()">
                    üóëÔ∏è Clear All Data
                </button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-view="topics" onclick="switchView('topics')">
            <div class="nav-icon">üìö</div>
            <span>Systems</span>
        </button>
        <button class="nav-item" data-view="search" onclick="switchView('search')">
            <div class="nav-icon">üîç</div>
            <span>Search ID</span>
        </button>
        <button class="nav-item" data-view="question" onclick="switchView('question')">
            <div class="nav-icon">üìù</div>
            <span>Question</span>
        </button>
        <button class="nav-item" data-view="backup" onclick="switchView('backup')">
            <div class="nav-icon">üíæ</div>
            <span>Backup</span>
        </button>
    </nav>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Confirm</div>
            <div class="modal-text" id="modalText"></div>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeModal()">Cancel</button>
                <button class="modal-btn primary" id="modalConfirmBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Embedded Topics -->
    <script>
        // Password Authentication
        const CORRECT_PASSWORD = 'captain';

        function checkPassword() {
            const passwordInput = document.getElementById('password-input');
            const errorDiv = document.getElementById('login-error');
            const loginScreen = document.getElementById('login-screen');
            const password = passwordInput.value;

            if (password === CORRECT_PASSWORD) {
                // Save authentication status
                localStorage.setItem('authenticated', 'true');

                // Add authenticated class to body to show content
                document.body.classList.add('authenticated');

                // Hide login screen with animation
                loginScreen.style.opacity = '0';
                loginScreen.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    loginScreen.classList.add('hidden');
                    // Load app content after login screen is hidden
                    if (typeof window.topics !== 'undefined') {
                        init();
                    }
                }, 300);
            } else {
                // Show error
                errorDiv.textContent = '‚ùå Incorrect password. Please try again.';
                passwordInput.value = '';
                passwordInput.focus();

                // Shake animation
                passwordInput.style.animation = 'shake 0.4s';
                setTimeout(() => {
                    passwordInput.style.animation = '';
                }, 400);
            }
        }

        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('authenticated') === 'true';
            const loginScreen = document.getElementById('login-screen');

            if (isAuthenticated) {
                // User is authenticated, hide login screen immediately
                document.body.classList.add('authenticated');
                loginScreen.classList.add('hidden');
                return true;
            } else {
                // Focus on password input
                setTimeout(() => {
                    document.getElementById('password-input').focus();
                }, 100);
                return false;
            }
        }

        // Topics data embedded directly in the HTML
        console.log('üì¶ Loading embedded topics...');
        const topics = {
          "Biochemistry (General Principles)": {
            "Amino Acids, Proteins, and Enzymes": [
              12066, 1119, 1244, 1340, 1480, 1483, 1372, 2066, 1247, 11930, 995,
              1248, 1332, 1370, 1245, 1369, 1334, 1484, 788, 1482,
            ],
            "Bioenergetics and Carbohydrate Metabolism": [
              1034, 1071, 12276, 1032, 1070, 1069, 1066, 1028, 1035, 1036, 1019,
              1022, 1073, 1807, 1074, 998, 1067, 1030, 1023, 1866, 107111,
            ],
            "Cell and Molecular Biology": [
              1122, 1382, 1381, 1355, 1378, 8385, 11950, 790, 1756, 992, 757,
              2031, 21501, 1473, 989, 1872, 107732,
            ],
            "Lipid Metabolism": [1886, 11918, 1888],
            Miscellaneous: [107590, 12278, 21503, 2042],
          },
          "Genetics (General Principles)": {
            "Clinical Genetics": [
              633, 8328, 1412, 1728, 1970, 1727, 11960, 14781, 8283, 21307, 596,
              1487, 1610, 1789, 701, 112284, 2034, 11914, 1790, 1788,
            ],
            "DNA Structure, Replication, and Repair": [
              1472, 1418, 2017, 21310, 1486, 1474, 1477, 1434, 1475, 1419,
              15340, 1436, 1435, 2027, 1438, 1437, 1476, 11912, 883,
            ],
            "Gene Expression and Regulation": [
              7791, 22214, 8276, 11913, 2015, 12263, 2025,
            ],
            "Protein Synthesis": [2041],
            "RNA Structure, Synthesis, and Processing": [
              1424, 2029, 2039, 11595, 2037, 2035, 1417, 2030, 1428, 1420, 2038,
              2032, 2033,
            ],
            Miscellaneous: [1599, 2044],
          },
          "Microbiology (General Principles)": {
            Bacteriology: [
              1098, 1099, 1135, 1139, 677, 679, 736, 1912, 1779, 1100, 678,
              1479, 11812, 1003, 1140,
            ],
            Mycology: [15057, 107],
            Parasitology: [15453],
            Virology: [12708, 1377, 1462, 1375, 374, 1411, 1495, 44, 1461, 376],
            Miscellaneous: [15325, 1596],
          },
          "Pathology (General Principles)": {
            "Cellular Pathology": [11916, 297, 1611, 18929, 177, 178],
            "Inflammation and Repair": [1801, 20879],
            Neoplasia: [
              1039, 11955, 15021, 1660, 1762, 1083, 428, 12049, 1760, 1717,
              11754, 1160, 285, 1753, 420, 429, 1873, 313, 2092, 2093, 421,
              18628, 15645, 345, 22637, 20932, 1718, 1084, 1759, 22635, 22656,
            ],
          },
          "Pharmacology (General Principles)": {
            "Drug Metabolism and Toxicity": [
              18563, 1716, 1818, 14919, 175, 778, 1816, 1777, 1711, 21437,
              15941, 161, 1564, 8327, 1712, 1257, 713, 139,
            ],
            "Drug Receptors and Pharmacodynamics": [
              1708, 1869, 20604, 18421, 1707,
            ],
            Pharmacokinetics: [
              8291, 1713, 11678, 18648, 2112, 1714, 1710, 17636, 18565, 18457,
              17635, 852, 1715, 18022,
            ],
            Miscellaneous: [
              11567, 17511, 11761, 18644, 18419, 8530, 11740, 18722,
            ],
          },
          "Biostatistics & Epidemiology": {
            "Epidemiology and Population Health": [
              19810, 19468, 19848, 19517, 10443, 19447, 11105, 19445, 19732,
              19441, 19511, 19741, 11835, 19410, 19806, 19496, 19431, 19451,
              1187, 19723, 14853, 20086, 1208, 1270, 108026, 20088, 10579,
              19665, 20250, 19798, 1171,
            ],
            "Measures and Distribution of Data": [
              1209, 1172, 19308, 19309, 1281, 1282, 1765, 1201, 108029, 19022,
              1183,
            ],
            "Probability and Principles of Testing": [
              1283, 19239, 1192, 19800, 1190, 19621, 1191, 1177, 1169, 19314,
              1229, 1278, 1284, 1271, 1285, 1232, 19619, 19262, 1233, 1230,
              1300, 1178, 12854,
            ],
            "Study Design and Interpretation": [
              1274, 1280, 1202, 19742, 10570, 1174, 10672, 1207, 1302, 1279,
              1273, 1184, 19199, 1303, 1176, 1189, 19195, 8519, 1299, 1185,
              19691, 18995, 19632, 1231, 19197, 108178, 19315, 14857, 1170,
              1173, 1277, 1276, 1204, 19391, 8422, 19406, 19105, 108159, 14862,
              1188, 1205, 1275, 14859, 1186, 1203, 19388, 19398, 19734, 1301,
              19247, 1272, 14861, 1210, 1175,
            ],
            Miscellaneous: [109119],
          },
          "Poisoning & Environmental Exposure": {
            "Environmental Exposure": [
              19079, 1454, 19261, 19084, 19108, 19080, 19088, 11949,
            ],
            Toxicology: [
              8482, 18748, 18622, 20603, 107167, 1544, 107146, 1448, 18623,
              15235, 19182, 1254, 18021, 2088, 2089, 12504, 18830, 18626, 841,
              172, 1361, 1321, 1868, 16052, 15606,
            ],
          },
          "Psychiatric/Behavioral & Substance Use Disorder": {
            "Normal Behavior and Development": [
              1459, 1429, 1234, 11586, 11875, 8295, 1350, 11773, 1351, 15242,
              10465, 15493, 11785, 15488, 1729, 2053, 2051, 1781,
            ],
            "Anxiety and Trauma-Related Disorders": [
              2049, 10581, 1443, 937, 11789, 11751, 247, 11825, 11866, 11619,
              11838, 11846, 15732, 248, 15481, 15349, 2123, 11603, 1352, 11759,
              15348, 15601, 2048, 15700, 15701,
            ],
            "Mood Disorders": [
              15607, 518, 105280, 15492, 1193, 704, 15730, 15388, 11617, 11607,
              520, 576, 11622, 572, 15462, 11618, 519, 15389, 773, 1348, 15447,
              15452, 11587, 15454, 574, 573, 706, 11758, 1347, 15384, 11854,
              9814, 15385,
            ],
            "Neurodevelopmental Disorders": [
              11796, 15482, 15283, 11810, 15286, 11592, 15282, 11784, 11828,
              11814, 20300, 11732, 11737, 11874, 15285, 11809, 15602,
            ],
            "Personality Disorders": [
              7752, 11606, 11593, 1431, 15357, 15358, 11594,
            ],
            "Psychotic Disorders": [
              512, 513, 15399, 11605, 515, 15328, 11743, 261, 516, 510, 2045,
              11848, 15326, 2046, 15253, 106670, 15252, 15416, 222, 15410,
              15397, 15254, 2047, 511, 2063, 15327,
            ],
            "Substance Use Disorders": [
              1021, 15609, 774, 15613, 870, 1289, 15738, 11787, 11829, 15615,
              11577, 18668, 11746, 1353, 2001, 1287, 106226, 1288, 15616, 20736,
              1165, 350, 1256, 13907, 106307,
            ],
            "Eating Disorders": [
              11807, 1843, 15500, 8893, 2050, 21433, 15501, 1346,
            ],
            "Somatoform Disorders": [11824, 11792],
            Miscellaneous: [
              11899, 15608, 20920, 13994, 15520, 1433, 15486, 15521, 15443,
              114868, 575, 2122, 15522, 15641, 20474, 15499, 15733, 15442,
            ],
          },
          "Social Sciences (Ethics/Legal/Professional)": {
            "Communication and Interpersonal Skills": [
              21742, 21215, 18783, 10659, 21168, 18808, 21165, 11531, 18964,
              10289, 21678, 18636, 18798, 21178, 2059, 1126, 19253, 10488,
              18760, 106757, 11518, 21717, 10458, 21246, 10398, 21176, 18762,
              21735, 1123, 7487, 21977, 8943, 21625, 1144, 21737, 107451, 10452,
              21736, 18695, 10468, 21697, 22308, 18836, 107420, 11629, 11536,
              19842, 2054, 21708, 21171, 10449, 21177, 21973, 10975, 21167,
              21423, 18874, 1145, 19317, 21978, 21466, 1432,
            ],
            "Healthcare Policy and Economics": [
              11668, 10290, 10510, 8456, 11602, 1129, 784, 7733, 10509,
            ],
            "Medical Ethics and Jurisprudence": [
              10533, 14111, 1237, 19055, 10464, 106484, 2058, 1235, 10534,
              19664, 19387, 10542, 10532, 106486, 10399, 2057, 19044, 7767,
              1182, 1124,
            ],
            "Patient Safety": [
              11537, 106288, 970, 11847, 11533, 11532, 10507, 10508, 11757,
              11535,
            ],
            "System-Based Practice and Quality Improvement": [
              20527, 11515, 11550, 21425, 11549,
            ],
            Miscellaneous: [1107, 8457, 10463],
          },
          "Miscellaneous (Multisystem)": {
            Miscellaneous: [
              311, 108013, 11830, 12024, 19259, 1587, 6, 1822, 775, 295, 107955,
              107719, 1709, 1823, 19187, 20774, 7656, 7605, 7583, 107781, 34,
              1700, 228,
            ],
          },
          "Allergy & Immunology": {
            "Anaphylaxis and Allergic Reactions": [
              174, 20701, 1612, 949, 14793, 20696, 556, 1366, 20715, 21470,
              2068, 2069, 20767, 20697, 20720, 11667, 19115, 15544, 20747,
            ],
            "Autoimmune Diseases": [
              21294, 761, 21258, 18704, 15557, 18802, 15331, 458, 459, 549,
              18803, 875, 741,
            ],
            "Immune Deficiencies": [
              20297, 8532, 541, 1995, 561, 1441, 1763, 22579, 557, 1132, 2078,
              2079, 537, 15293, 732, 571, 739, 22331, 538, 19629, 21342, 8384,
              21499,
            ],
            "Transplant Medicine": [11786, 1613, 18706, 534, 744, 1155, 546],
            "Principles of Immunology": [
              11677, 1614, 20781, 1799, 21420, 569, 20817, 558, 17448, 7609,
              8261, 762, 965, 8539, 12048, 11525, 17853, 750, 20698, 21091,
              17600, 20818, 1598, 759, 544,
            ],
            Miscellaneous: [
              1468, 18613, 8523, 1467, 17447, 17446, 8480, 1133, 12299, 540,
              559, 298, 18609, 1800, 539, 106668, 18764, 745, 542, 15251, 746,
            ],
          },
          "Cardiovascular System": {
            "Normal Structure and Function of the Cardiovascular System": [
              179, 551, 2124, 751, 2023, 1947, 1513, 19568, 19518, 1884, 11837,
              1750, 11780, 11730, 183, 19531, 1625, 2009, 11831, 19567, 1510,
              1529, 8332, 8333, 1516, 18536, 19533, 1833, 1557, 1871, 1622,
              1883, 20986, 1538, 7618, 19523, 1653, 1931, 1589, 19570, 1528,
              11956, 157, 951, 952, 108008, 19935, 1531, 11763, 180, 1974, 8563,
              19895, 1624, 1511,
            ],
            "Aortic and Peripheral Artery Diseases": [
              1518, 293, 18709, 12046, 15891, 460, 475, 2130, 15885, 1852,
              11844, 1164, 462, 451, 1118, 1805, 31, 1080, 473, 15886, 1943,
              1609, 7568, 14997, 15354, 452, 15840, 453, 6445, 463, 12151,
              14984, 15839, 878, 448, 464, 809, 11832,
            ],
            "Cardiac Arrhythmias": [
              2055, 21037, 1508, 1506, 147, 7646, 84, 21472, 11842, 8869, 15555,
              900, 2006, 19574, 8458, 19577, 153, 91, 7640, 15574, 1973, 898,
              11797, 1977, 86, 18889, 21156, 21457, 19560, 14743, 90, 19561,
              1505, 1509, 1976, 18630, 14780, 21419, 1507, 14744, 159, 901, 625,
              15559, 15693, 21478, 1515, 155, 899, 14745,
            ],
            "Congenital Heart Disease": [
              315, 1751, 194, 19535, 19534, 188, 2117, 882, 19556, 202, 20911,
              19541, 33, 19537, 203, 19540, 19526, 19525, 8292, 2109, 19636,
              205, 187, 204, 19558, 189, 20910, 1705, 201, 19605, 19539, 35,
            ],
            "Coronary Heart Disease": [
              19674, 15868, 15197, 300, 15875, 1828, 193, 42, 38, 442, 19173,
              138, 712, 1882, 15001, 11764, 43, 10467, 823, 447, 443, 20476,
              1082, 1196, 195, 7666, 7667, 12144, 711, 15180, 15188, 11636,
              11833, 137, 781, 15250, 192, 39, 780, 1967, 14978, 444, 37, 446,
              176, 36, 40,
            ],
            "Heart Failure and Shock": [
              7616, 186, 19331, 8546, 19284, 1344, 11745, 246, 185, 8610, 18639,
              19337, 1532, 686, 7238, 7239, 15241, 1565, 15526, 6811, 18160,
              18535, 2108, 15650, 19281, 15534, 1944, 15554, 1780, 2005, 13979,
              156, 148, 1652, 19514, 15391, 1978, 15651, 15528, 1512, 1578, 843,
              149, 19280,
            ],
            Hypertension: [
              20985, 144, 1444, 689, 108081, 456, 19601, 181, 1252, 20966,
              15542, 691, 1948, 1841, 697, 154, 18860, 980, 21356, 449, 1166,
              11849, 145, 11836,
            ],
            "Myopericardial Diseases": [
              1782, 93, 76, 15269, 14993, 8711, 83, 568, 1040, 22793, 13600, 75,
              2070, 2071, 89, 15516, 20258, 7218, 7219, 15213, 15515, 20253, 92,
              20262, 141, 2099, 2100, 15214, 1047, 14989, 2107, 1014, 22698, 95,
              96, 1439, 15310, 22787, 14999, 94, 85, 14789, 97, 98, 240, 15000,
              14992, 394, 20259, 20257, 14998, 82,
            ],
            "Valvular Heart Diseases": [
              16596, 1623, 14976, 200, 234, 8294, 16532, 15196, 944, 1661, 232,
              14966, 244, 231, 939, 12187, 242, 2106, 241, 73, 74, 645, 237,
              227, 235, 14987, 238, 1591, 243, 1530, 2105, 1983, 15198, 945,
              2074, 2075, 2096, 15195, 15729, 230, 11851, 947, 1517, 14964, 233,
              943,
            ],
            "Cardiovascular Drugs": [
              108070, 136, 18618, 143, 15306, 1343, 8289, 11925, 21458, 1836,
              1367, 1342, 21524, 160, 1364, 140,
            ],
            Miscellaneous: [
              654, 14980, 142, 1699, 948, 8296, 11640, 18840, 1365,
            ],
          },
          Dermatology: {
            "Normal Structure and Function of Skin": [
              17855, 1860, 588, 17854, 20884, 20885,
            ],
            "Disorders of Epidermal Appendages": [
              15379, 15374, 15441, 20587, 1726, 1725, 1110, 18927, 22599, 7585,
              15373,
            ],
            "Inflammatory Dermatoses and Bullous Diseases": [
              876, 1117, 17062, 15411, 15408, 1214, 20586, 1114, 21462, 1111,
              1105, 21841, 15026, 15439, 16395, 15695, 1116, 11662, 11852, 2065,
              1874, 21262, 16852, 20556, 15361, 1115, 680, 8569,
            ],
            "Skin and Soft Tissue Infections": [
              836, 15431, 15550, 1042, 1898, 15363, 1314, 10168, 14488, 108461,
              15448, 1313, 17230, 1553, 973, 15579, 15364, 104, 13911,
            ],
            "Skin Tumors and Tumor-Like Lesions": [
              1960, 1761, 16862, 466, 8904, 8334, 826, 11502, 15460, 1867, 1113,
              936, 469, 20374, 7707, 1878, 11738, 1108, 22608, 7649, 1993, 467,
              874, 16895, 16865, 15425, 1937, 22603, 935, 22600, 14184, 1112,
            ],
            Miscellaneous: [18707, 21306, 21305, 21107],
          },
          "Ear, Nose & Throat (ENT)": {
            "Disorders of the Ear, Nose, and Throat": [
              8589, 21127, 1740, 107861, 1373, 1195, 18141, 20119, 1698, 1102,
              1345, 15028, 18650, 11628, 1814, 8631, 107859, 18645, 19204, 8703,
              19130, 18647, 19972, 8342, 18597, 20020, 18627, 19576, 19035,
              11783, 18598, 21438, 22476, 308, 18584, 20706, 1633, 20705, 1686,
              107970,
            ],
          },
          "Endocrine, Diabetes & Metabolism": {
            "Normal Structure and Function of Endocrine Glands": [
              19753, 1887, 2016,
            ],
            "Congenital and Developmental Anomalies": [
              217, 1335, 221, 610, 543, 1990, 2080, 2081, 19975, 763, 793, 7632,
              20168, 1502, 930, 1336, 1720, 1991, 1504,
            ],
            "Adrenal Disorders": [
              17247, 17246, 928, 17244, 454, 924, 608, 1163, 929, 932, 547,
            ],
            "Diabetes Mellitus": [
              1011, 15770, 1996, 1012, 1655, 18965, 15308, 19237, 921, 1013,
              6705, 6803, 606, 849, 994, 11040, 985, 850, 19748, 1031, 15876,
              19224, 8531, 15675, 1010, 19219, 1121, 934, 18956, 11565, 847,
              920, 18958, 14136, 1492, 607, 1984, 1540, 6692, 15881, 846, 1768,
              604, 19345, 848, 18952, 16324, 600, 1324,
            ],
            "Endocrine Tumors": [
              1921, 602, 1845, 8424, 771, 1747, 612, 15303, 1658, 601, 927, 213,
              1844, 15105, 585, 210, 17236, 218, 223, 19756, 926, 226, 988,
              1262, 1659, 15063,
            ],
            "Hypothalamus and Pituitary Disorders": [
              1561, 12512, 224, 21663, 225, 206, 20588, 220, 214, 20526, 1379,
              18546, 609,
            ],
            "Obesity and Dyslipidemia": [
              1327, 782, 11917, 15201, 191, 1889, 11634, 18595, 2064, 190, 166,
              20921, 163,
            ],
            "Reproductive Endocrinology": [
              698, 582, 208, 584, 656, 925, 215, 14952, 14920, 954, 19007, 579,
              209, 19000, 1839, 13776, 14818, 581, 216, 1901, 658,
            ],
            "Thyroid Disorders": [
              1407, 769, 14995, 622, 19745, 19750, 14985, 1213, 20146, 768,
              19752, 637, 20204, 11664, 767, 14953, 19747, 19746, 15016, 20366,
              626, 20375, 19946, 14951, 20306, 20265, 764, 772, 1945, 6797,
              19754, 770, 1615, 983,
            ],
            Miscellaneous: [
              14817, 1065, 19947, 18801, 19948, 1673, 19004, 19002, 19949, 821,
            ],
          },
          "Female Reproductive System & Breast": {
            "Normal Structure and Function of the Female Reproductive System and Breast":
              [
                11920, 11823, 20169, 11908, 11888, 1986, 1632, 299, 1739, 207,
                1560,
              ],
            "Congenital and Developmental Anomalies": [
              1809, 1810, 339, 1831, 8390, 12225, 1830, 7489, 12298, 256,
            ],
            "Breast Disorders": [1057, 1877, 1056, 11890, 21642, 1109, 1917],
            "Genital Tract Tumors and Tumor-Like Lesions": [
              18747, 19969, 20237, 11885, 578, 11929, 258, 19189, 18654, 127,
              11858, 869, 18233, 1957, 2056, 20084, 1992, 19970, 1928, 333,
              11652, 1158, 19641, 1837, 19886, 20083,
            ],
            "Genitourinary Tract Infections": [
              1027, 1015, 110, 1932, 18930, 11765, 15869, 15546, 1549, 11802,
              1929, 1008, 888,
            ],
            "Menstrual Disorders and Contraception": [1899, 879, 21791, 577],
            Miscellaneous: [
              20285, 18714, 15589, 11901, 18918, 11781, 21426, 18919,
            ],
          },
          "Gastrointestinal & Nutrition": {
            "Normal Structure and Function of the GI Tract": [
              11760, 107774, 124, 107787, 21033, 11850, 21353, 21081, 126,
              20988, 12198, 1068, 1744, 1971, 8574, 20080, 1546, 11839, 20079,
              11817, 2022, 8587,
            ],
            "Congenital and Developmental Anomalies": [
              331, 808, 107582, 9920, 107844, 19295, 329, 11803, 322, 358, 328,
              330, 318, 101, 11962, 321, 19675, 108285, 22149, 327, 1824,
            ],
            "Biliary Tract Disorders": [
              364, 1525, 16175, 317, 16116, 69, 49, 80, 87, 81, 402, 79, 21083,
              403, 401, 164, 1319,
            ],
            "Disorders of Nutrition": [
              710, 755, 18615, 1848, 1581, 21497, 1806, 1926, 7584, 8425, 1838,
              106480, 12068, 1063, 1064, 1061, 1847, 1046, 19789,
            ],
            "Gastroesophageal Disorders": [
              14894, 279, 15383, 1662, 14890, 1604, 1918, 18523, 306, 16900,
              1603, 128, 283, 15652, 130, 586, 292, 278, 291, 19343, 1605, 828,
              14891, 108087, 14872, 1778, 125, 14873, 286, 1766, 14877, 15603,
              19682, 1701, 14880, 280, 281, 14892, 20189, 1706, 282, 305, 304,
              284, 11548,
            ],
            "Hepatic Disorders": [
              372, 11661, 8578, 1927, 62, 102, 15024, 47, 21011, 367, 366, 70,
              18549, 17905, 8547, 17969, 386, 1537, 67, 165, 21115, 412, 388,
              11739, 15220, 362, 21128, 375, 21465, 400, 21019, 370, 77, 10583,
              7214, 7215, 18693, 71, 57, 368, 16117, 15144, 1423, 100, 15023,
              19554, 21085, 78, 99, 314, 54, 881, 16070, 1875, 396, 1863, 19701,
              365, 15535,
            ],
            "Intestinal and Colorectal Disorders": [
              319, 324, 1597, 17005, 105712, 11771, 20400, 11782, 405, 132,
              1072, 18541, 7642, 105665, 1398, 2028, 1396, 7573, 410, 11775,
              134, 88, 133, 17003, 129, 6510, 14947, 413, 865, 415, 408, 416,
              430, 326, 131, 255, 323, 20428, 17006, 15049, 19407, 407, 17004,
              19356, 8873, 1397, 14907, 414, 427, 1143, 14837, 19981, 1783, 426,
              18542, 404, 406, 12062, 20693, 409, 15244, 18586, 303, 20390,
              14901, 14900,
            ],
            "Pancreatic Disorders": [
              21146, 1251, 433, 838, 434, 1907, 1738, 435, 11795, 19355, 1547,
              21994, 439, 441, 438, 14939, 440,
            ],
            "Tumors of the GI Tract": [
              1938, 424, 22178, 257, 1631, 122, 15011, 411, 14879, 287, 253,
              431, 56, 309, 59, 19112, 14878, 307, 425, 436, 1832, 471, 432,
              14915, 16107, 15012, 15020,
            ],
            Miscellaneous: [
              8290, 1817, 391, 8669, 417, 53, 17682, 393, 1358, 10999, 11753,
              1400, 418, 11840,
            ],
          },
          "Hematology & Oncology": {
            "Normal Hematologic Structure and Function": [
              1385, 1413, 1387, 1029, 1456, 1338, 868, 1455, 19289, 1384,
            ],
            "Hemostasis and Thrombosis": [
              20730, 106673, 742, 18688, 18727, 20361, 1293, 14741, 18689, 26,
              1880, 2133, 1078, 11731, 16442, 15390, 709, 1903, 1298, 1784,
              1291, 7589, 1088, 2132, 1200, 1295, 1194, 1292, 1077, 1087, 1879,
              1296, 16441, 18686, 465, 1090,
            ],
            "Plasma Cell Disorders": [20631, 15467],
            "Platelet Disorders": [
              942, 1923, 15483, 11625, 1079, 219, 16705, 346, 14791, 2097, 2098,
              1954, 106238, 15120, 11624,
            ],
            "Red Blood Cell Disorders": [
              545, 890, 1416, 892, 747, 957, 1470, 1545, 12019, 1796, 1243,
              2086, 2087, 11816, 6535, 19140, 1794, 15323, 1496, 1415, 12375,
              1785, 14983, 15562, 1890, 1240, 19135, 15489, 787, 8559, 2084,
              2085, 1156, 789, 897, 894, 1339, 895, 19137, 1859, 1953, 896,
              21415, 20460, 359, 1037, 1851, 829, 1337, 106040, 1241, 1683, 889,
              1787, 19160, 1586, 15307, 891, 19138, 395, 1793, 941, 19689, 1940,
              105684, 1786, 1861, 1580, 1842, 1855, 1865, 294, 1020, 1242,
              19123, 19124, 8591, 19136, 107400, 2040, 19125, 1941, 1294, 11869,
              1297,
            ],
            "Transfusion Medicine": [17780, 1654, 16141, 21787],
            "White Blood Cell Disorders": [
              15545, 15048, 1404, 15248, 1134, 1626, 58, 19442, 1629, 1628,
              1724, 15134, 873, 20673, 1627, 11456, 1406, 1086, 106780, 1864,
              1630, 15821, 15278, 1571, 15512, 1403, 6530, 11584, 15301, 15466,
              1754, 15133, 1757, 1964, 11750, 1911, 872, 1569, 1963, 14816,
              1758, 1755, 1570, 1798, 7643, 1405, 8281, 8540,
            ],
            "Principles of Oncology": [
              1894, 1819, 112394, 19198, 1050, 1892, 18649, 11585, 20771, 22845,
              2018, 20769, 8542, 22785, 15706, 18769, 14956, 1206, 11728, 1857,
              15299, 1286,
            ],
            Miscellaneous: [
              16287, 15279, 17338, 2043, 15237, 15292, 20877, 714,
            ],
          },
          "Infectious Diseases": {
            "Antimicrobial Drugs": [
              2110, 2111, 1645, 105599, 11729, 1774, 18550, 1643, 18624, 1642,
              1104, 1959, 18521, 1488, 276, 275, 16855, 959, 1091, 105693, 1551,
              18682, 1000,
            ],
            "Bacterial Infections": [
              15578, 14921, 15075, 1228, 1226, 727, 18594, 6731, 1391, 106795,
              107139, 7581, 15543, 642, 676, 1390, 277, 1389, 1138, 1004, 1093,
              1393, 644, 1094, 1092, 972, 724, 977, 723, 14934, 15027, 1103,
              1146, 1002, 1676, 19196, 8565, 976, 733, 968, 15204, 11596, 1141,
              1026, 14923, 931, 11547, 1024, 1678, 15255, 1101, 11626, 643,
              15067, 729, 15205, 1142, 15347, 106465, 105601, 15509, 1394,
              15566, 19422, 6781, 1388, 1225, 20207, 19440, 106575, 106389,
              107368, 15407, 14895, 14883, 1136, 271, 19381, 15418, 15400, 760,
              1007, 725, 8282, 11709, 1309, 1422, 1223, 1312, 11459, 20014,
              11766, 1137, 8533, 974, 963, 1310, 8857, 18779, 6643, 22577,
              11650, 11927, 1001, 1097, 8858, 7650, 14916, 1198, 726, 15210,
            ],
            "Fungal Infections": [
              109, 11637, 106713, 119, 106, 105, 274, 112, 273, 14870, 20205,
              111,
            ],
            "HIV and Sexually Transmitted Infections": [
              11604, 1958, 15066, 15113, 651, 18620, 15069, 1675, 1952, 14855,
              1315, 1025, 2019, 1674, 1949, 472, 380, 953, 11590, 6547, 819,
              1316, 1895, 560, 15107, 1463, 1154, 1672, 1499, 8371, 15518, 60,
              1722, 20315, 483, 1409, 15169, 1550, 15565, 1723, 379, 15125,
            ],
            "Infection Control": [107967, 2082, 2083, 11514, 728, 8593],
            "Parasitic and Helminthic Infections": [
              15549, 15230, 1965, 22125, 8538, 8541, 18489, 15077, 20848,
              107248, 11670, 107525, 15588, 15243, 1574, 61, 15436, 22124,
              15457, 15438, 107521, 11540, 15076, 1908, 11524, 105676,
            ],
            "Viral Infections": [
              15490, 1648, 1469, 15375, 105489, 11822, 1670, 1668, 15419, 11377,
              1593, 378, 7228, 7229, 11859, 15034, 1594, 1466, 15177, 14903,
              1595, 15068, 11395, 21018, 1374, 45, 15362, 377, 15491, 1465,
              1647, 1045, 1592, 1572, 373, 390, 15228, 48, 46, 1497, 15215,
              1498, 1644,
            ],
            Miscellaneous: [15152, 1260, 20628, 22143, 10401, 11633, 22142],
          },
          "Male Reproductive System": {
            "Normal Structure and Function of the Male Reproductive System": [
              150, 16236, 8326, 2021,
            ],
            "Disorders of the Male Reproductive System": [
              107247, 11658, 15538, 7606, 15804, 1737, 107790, 1449, 20231,
              8930, 19695, 343, 1096, 419, 1055, 16003, 16004, 16005, 11870,
              839, 1827, 19591, 807, 19013, 19017, 8468, 1902, 707, 1870, 19020,
              11800, 19031, 19030, 11747, 19029, 11762, 16001, 19697, 16002,
              687, 664, 15800, 580, 8351, 19012, 15828, 15560, 657,
            ],
          },
          "Nervous System": {
            "Normal Structure and Function of the Nervous System": [
              20004, 1936, 21405, 20060, 1360, 1829, 1380, 2024, 20056, 1359,
              19670, 1453, 1368, 2125, 19954, 2007, 1930, 20275, 1834, 15158,
              1934, 1802, 19544, 20008, 19973, 2020, 11995, 1922, 11682, 19979,
              494, 11744, 20016, 1120, 19722, 1636, 19808, 12035, 19893, 635,
              105534, 8573, 1741, 19667, 20180, 105581, 19688, 11777,
            ],
            "Congenital and Developmental Anomalies": [
              1689, 397, 22189, 108170, 1341, 8323, 15637, 1305, 18496, 8524,
              344, 252, 673, 2067, 1307, 672, 636, 15745, 11843, 1691, 21408,
              1500, 1421, 587, 590, 1534, 2036, 496, 15594, 19964, 504, 502,
              468, 1808,
            ],
            "Cerebrovascular Disease": [
              8564, 495, 1687, 15765, 15766, 499, 4, 19618, 21212, 8592, 501,
              105530, 15866, 493, 20, 19802, 11804, 21589, 15649, 19612, 146,
              1696, 19402, 2076, 2077, 505, 11576, 19833, 1955, 913, 12007,
              12155, 11632, 497, 500, 498, 492, 105500, 105495, 21, 105558, 22,
              19, 21189, 8636, 1813, 18, 23, 105531, 2127, 871, 12029, 1846,
              18543, 19633, 12226, 1920, 12023, 11627, 12119, 15646, 105533,
            ],
            "CNS Infections": [
              1323, 14899, 14898, 738, 15580, 12084, 908, 737, 1906, 907, 906,
              1038, 11568, 1853, 1392, 113, 116, 1573, 1966, 911, 11862, 118,
              1005, 14905, 19420, 19963, 15587, 19486, 735, 8324,
            ],
            "Demyelinating Diseases": [
              1318, 915, 1735, 15600, 919, 916, 11631, 918, 917,
            ],
            "Disorders of Peripheral Nerves and Muscles": [
              1933, 1058, 1997, 1749, 2061, 2062, 8329, 14850, 15612, 19482,
              1452, 749, 108226, 1401, 11676, 19887, 1060, 1998, 6554, 1601,
              1267, 1308, 18491, 12252, 15705, 8352, 2126, 1268, 15727, 19291,
              15667, 1306, 8522, 19784, 12025, 11742, 22145, 1692, 19613, 19487,
              1552, 647, 1657, 11609, 18599, 11680, 21725, 19484, 8701, 966,
              1748, 1694, 66, 11779, 1703, 1815, 11834, 1264, 1059, 1304, 11681,
              1685, 11769, 11772, 1149, 11683, 1743, 1639, 11663,
            ],
            Headache: [
              1048, 18974, 15684, 1962, 107433, 19569, 18978, 7492, 1199, 15683,
              8476, 354,
            ],
            "Neurodegenerative Disorders and Dementias": [
              1536, 598, 591, 675, 1442, 265, 902, 18497, 2129, 15446, 106622,
              106625, 19476, 63, 262, 19218, 11462, 597, 12011, 20918, 594,
              19214, 7490, 794, 674, 15648, 18498, 1690, 632, 595, 910, 18540,
              592, 593,
            ],
            "Seizures and Epilepsy": [
              357, 12175, 21132, 15947, 15170, 351, 509, 866, 355, 353, 1197,
              356, 250, 508, 352, 249, 15728, 11665, 14044,
            ],
            "Spinal Cord Disorders": [
              21406, 21404, 65, 19274, 503, 12030, 1693, 12031, 11793, 671,
              1904, 19319, 1402, 18680,
            ],
            "Traumatic Brain Injuries": [
              15903, 20495, 347, 15678, 1493, 12227, 11574, 506,
            ],
            "Tumors of the Nervous System": [
              880, 1152, 1150, 22121, 22063, 1153, 1261, 1263, 7670, 7671,
              15591, 613, 1151, 15638, 15659, 12283, 614,
            ],
            Hydrocephalus: [17, 1854, 14, 16, 15],
            Anesthesia: [
              776, 8481, 18655, 851, 659, 856, 854, 18735, 660, 18755, 15712,
              855,
            ],
            "Sleep Disorders": [
              349, 8878, 348, 1458, 8259, 15762, 15644, 15523,
            ],
            Miscellaneous: [
              703, 8702, 8859, 1635, 634, 15702, 19639, 1946, 11685, 11755,
              2000, 21909, 19543, 11952, 566, 21833, 10362,
            ],
          },
          Ophthalmology: {
            "Normal Structure and Function of the Eye and Associated Structures":
              [173, 862, 15838],
            "Disorders of the Eye and Associated Structures": [
              107365, 398, 8557, 19126, 18804, 11551, 799, 8594, 106633, 106294,
              18951, 11675, 1363, 11841, 7721, 13554, 16172, 18896, 12257, 863,
              15668, 1356, 360, 1322, 1646, 18588, 12083,
            ],
          },
          "Pregnancy, Childbirth & Puerperium": {
            "Normal Pregnancy, Childbirth, and Puerperium": [
              106637, 19588, 20313, 20128, 1688, 19178, 342, 1772, 19521, 1987,
              19065, 20003, 19581, 108284, 19586,
            ],
            "Disorders of Pregnancy, Childbirth, and Puerperium": [
              20319, 312, 106231, 11961, 1464, 19436, 337, 8293, 16525, 1825,
              22144, 12262, 1575, 19901, 1255, 15704, 955, 8325, 19885, 334,
              19902, 68, 19435, 11926, 11891, 19437, 20372, 1062, 791, 1568,
              8330, 8406, 507, 1490, 1914, 583, 19392, 19438, 1440, 335, 792,
              20380, 16021, 19389,
            ],
          },
          "Pulmonary & Critical Care": {
            "Normal Pulmonary Structure and Function": [
              19571, 1563, 1745, 480, 1548, 1494, 16285, 478, 14949, 1414, 1541,
              1522, 19062, 1386, 21036, 536, 21034, 12100, 481, 1542, 19635,
              1980, 1519, 1590, 15106,
            ],
            "Congenital and Developmental Anomalies": [
              802, 806, 19341, 805, 1939, 19780, 803, 1514, 804,
            ],
            "Critical Care Medicine": [
              19339, 19335, 18666, 19614, 1357, 490, 105670, 550, 21505, 1212,
              15429, 1131, 1695, 19625, 800, 1527, 2101, 2102, 7614, 19075, 485,
              19624, 15240, 844, 16899, 479, 11741, 1579, 528, 19617, 18928,
              1130, 486, 1582, 15430, 18938, 15420, 19626, 19332, 19919,
            ],
            "Interstitial Lung Disease": [
              797, 15126, 669, 666, 19244, 670, 15370, 7648, 19926, 1147, 1543,
              798, 20303, 15181, 984, 1650, 15335, 668, 877, 649, 15485, 553,
              653, 8260, 795, 796,
            ],
            "Lung Cancer": [
              564, 555, 648, 552, 565, 107931, 1041, 650, 12293, 554,
            ],
            "Obstructive Lung Disease": [
              1460, 7558, 15155, 1521, 522, 1583, 1925, 526, 8262, 535, 169,
              18809, 1249, 489, 19379, 168, 18805, 491, 19382, 1942, 484, 15206,
              15233, 487, 15164, 524, 15212, 1523, 19380, 11845, 521, 171,
              11752, 170, 523, 12082, 12141, 13402, 7601, 15156, 1919, 2128,
              525, 488, 1985, 663, 661, 527,
            ],
            "Pulmonary Infections": [
              1535, 20108, 960, 961, 731, 114, 1217, 108, 531, 1222, 121, 21124,
              14927, 15040, 1910, 1219, 532, 665, 11638, 15061, 10993, 20235,
              14925, 1667, 120, 1767, 1218, 302, 1649, 967, 1446, 730, 9989,
              533, 14840, 1220, 962, 964, 268, 11630, 301, 14922, 1221, 19657,
              103, 1677, 820, 1679, 1216, 1666, 14926, 999, 117, 1576, 734, 266,
              958, 8257, 269, 267, 1215,
            ],
            "Pulmonary Vascular Disease": [
              14847, 107526, 15199, 903, 196, 7660, 7661, 975, 14959, 1981, 476,
              19820, 825, 1585, 15070, 12184, 529, 1584, 1881, 530, 11774,
              14958, 198,
            ],
            "Sleep Disorders": [21965],
            Miscellaneous: [
              18656, 20176, 20175, 1876, 8754, 15611, 18669, 20173, 19809, 197,
              2116, 310, 20177, 1526, 18733, 19294, 11900, 18732, 19916, 19287,
              20174,
            ],
          },
          "Renal, Urinary Systems & Electrolytes": {
            "Normal Structure and Function of the Kidneys and Urinary System": [
              1680, 1354, 1804, 18861, 1988, 19292, 15324, 1555, 20178, 1617,
              20243, 1554, 1017, 19177, 1651, 6772, 11708, 2010, 1618, 1982,
              1608, 1607, 2011, 690,
            ],
            "Congenital and Developmental Anomalies": [
              15273, 2, 15246, 832, 107718, 107624, 7626, 695, 106085, 15247,
              833, 7569, 652, 107720, 18560, 815, 814, 1736, 107625, 1752,
              107756,
            ],
            "Acute Kidney Injury": [
              15172, 15218, 15207, 15217, 810, 15208, 887, 886, 15227, 1053,
              15209, 18667, 15221, 15225, 1016, 835, 7624, 15229, 106935, 19446,
              885, 1054,
            ],
            "Bone Metabolism": [1656, 22188, 981, 631, 641, 11660, 978, 12101],
            "Chronic Kidney Disease": [
              8881, 15312, 16300, 7571, 7570, 15289, 979, 455, 15291, 15280,
              11977, 18950, 1049, 1663,
            ],
            "Cystic Kidney Diseases": [1052, 3, 1915],
            "Fluid, Electrolytes, and Acid-Base": [
              18948, 18871, 1533, 18807, 1425, 2072, 2073, 18841, 107616, 2113,
              106038, 688, 1148, 15276, 18924, 18872, 18933, 18940, 21828, 2008,
              18878, 18937, 18867, 18879, 2014, 682, 6792, 11939, 19634, 1524,
              681, 685, 18941, 7557, 16978, 956, 684, 15290,
            ],
            "Glomerular Diseases": [
              151, 567, 15239, 9, 229, 108701, 1913, 11, 25, 27, 24, 2131, 385,
              15353, 11608, 884, 383, 1849, 7625, 12, 7, 1577, 28, 15346, 7628,
              16598, 384, 1850, 15619, 13, 7611, 22081, 1, 8, 10, 382, 19550,
              15355, 758,
            ],
            "Neoplasms of the Kidneys and Urinary Tract": [
              904, 336, 11806, 7226, 7227, 15176, 818, 1862, 2013, 905, 15186,
              152,
            ],
            "Nephrolithiasis and Urinary Tract Obstruction": [
              837, 6739, 817, 15259, 813, 15270, 1916, 15271, 811, 15193, 7631,
              12081, 816, 14798, 15200, 2003,
            ],
            "Diabetes Insipidus": [
              18547, 211, 2012, 18553, 212, 18548, 1043, 1161,
            ],
            "Urinary Incontinence": [11464, 8249, 11820, 11038, 10962],
            Miscellaneous: [
              17307, 1362, 15288, 11516, 696, 694, 834, 683, 692, 18863, 8884,
              1211, 18866, 11945,
            ],
          },
          "Rheumatology/Orthopedics & Sports": {
            "Normal Structure and Function of the Musculoskeletal System": [
              1732, 11635, 108761, 20101, 1159, 19491, 1640, 1885, 1638, 19565,
              7592, 7621, 8266, 1858, 1558, 1733, 8671, 20099, 1664, 11679,
              1812, 19719, 19828, 18765, 11776, 1734, 1730, 1665, 11727, 19823,
              824,
            ],
            "Congenital and Developmental Anomalies": [
              700, 108033, 1935, 1250, 11819, 1265, 702, 1266, 11778,
            ],
            "Arthritis and Spondyloarthropathies": [
              20092, 1503, 7556, 1896, 1600, 1450, 2090, 2091, 14967, 15629,
              11821, 860, 752, 8802, 1771, 861, 15663, 14677, 7792, 754, 15627,
              716, 753, 167, 719, 19494, 19443, 858, 19493, 14917, 1451, 720,
              19492, 1897, 859, 1168, 743, 718,
            ],
            "Autoimmune Disorders and Vasculitides": [
              11749, 11646, 1900, 740, 1253, 14805, 914, 940, 18475, 457, 450,
              18703, 748, 15564, 11770, 340, 15563, 239, 11805, 18996, 15597,
              361, 461, 15596, 667,
            ],
            "Bone/Joint Injuries and Infections": [
              14930, 1634, 1968, 15666, 1803, 8670, 646, 20010, 1682, 15660,
              316, 1395, 1835, 1702, 1697, 11653, 1491, 11684, 11855, 11818,
              18583, 16922, 16595, 990, 11799, 1969, 11868, 991, 11659, 8579,
              1704, 1956, 1924, 721,
            ],
            "Bone Tumors and Tumor-like Lesions": [
              15665, 15636, 18661, 19775, 15635,
            ],
            "Spinal Disorders and Back Pain": [341, 20013, 12073, 15553],
            "Metabolic Bone Disorders": [
              987, 993, 1795, 1773, 7615, 639, 629, 638, 10930, 630, 11564,
              15677, 640, 15696,
            ],
            Miscellaneous: [19958, 270, 21216, 19911, 867],
          },
        };

        // Make topics available globally
        window.topics = topics;
        console.log('‚úÖ Embedded topics loaded:', Object.keys(topics).length, 'systems');
    </script>

    <!-- Main Script -->
    <script>
        // Global state
        let currentTopics = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let currentSubtopic = null;
        let questionData = {};

        // Initialize
        function init() {
            try {
                console.log('Init called');
                console.log('Topics available:', typeof window.topics, window.topics ? Object.keys(window.topics).length : 0);
                loadQuestionData();
                migrateQuestionData(); // Ensure all data has required fields
                renderTopics();
                updateStats();

                // Restore last session if available
                restoreLastSession();
            } catch (error) {
                console.error('Error in init():', error);
                alert('Error initializing app: ' + error.message);
            }
        }

        // Restore last session after page reload
        function restoreLastSession() {
            const lastSession = localStorage.getItem('lastSession');
            if (!lastSession) return;

            try {
                const session = JSON.parse(lastSession);
                if (!session.system || !session.category) return;

                // Check if the topic still exists
                if (!topics[session.system] || !topics[session.system][session.category]) {
                    localStorage.removeItem('lastSession');
                    return;
                }

                // Restore the session
                console.log('Restoring last session:', session);
                const questions = topics[session.system][session.category];

                // Validate question index
                const questionIndex = Math.min(session.questionIndex || 0, questions.length - 1);

                currentSubtopic = { system: session.system, category: session.category };
                currentQuestions = questions;
                currentQuestionIndex = questionIndex;

                loadQuestion(questionIndex);
                switchView('question');
            } catch (error) {
                console.error('Error restoring session:', error);
                localStorage.removeItem('lastSession');
            }
        }

        // Load question data from localStorage
        function loadQuestionData() {
            const saved = localStorage.getItem('questionData');
            if (saved) {
                try {
                    questionData = JSON.parse(saved);
                } catch (e) {
                    questionData = {};
                }
            }
        }

        // Data Migration - Ensure all questions have required fields
        function migrateQuestionData() {
            try {
                let migrated = false;

                // Ensure all questions have lastAttempted and testId
                for (const qId in questionData) {
                    const data = questionData[qId];

                    // Ensure lastAttempted is in YYYY-MM-DD format
                    if (data.lastAttempted) {
                        // Convert ISO string to YYYY-MM-DD if needed
                        if (data.lastAttempted.includes('T')) {
                            data.lastAttempted = data.lastAttempted.split('T')[0];
                            migrated = true;
                        }
                    } else if (data.isCorrect || data.isIncorrect || data.attempts > 0) {
                        // Question was attempted but no date - use a generic old date
                        data.lastAttempted = '2024-01-01';
                        migrated = true;
                    } else {
                        // Not yet attempted - set empty string
                        data.lastAttempted = '';
                    }

                    // Ensure testId exists for attempted questions
                    if (!data.testId && data.lastAttempted && (data.isCorrect || data.isIncorrect || data.attempts > 0)) {
                        // Create a generic testId based on date
                        data.testId = 'legacy_' + data.lastAttempted;
                        migrated = true;
                    } else if (!data.testId) {
                        data.testId = '';
                    }

                    // Ensure selectedAnswer exists
                    if (data.selectedAnswer === undefined) {
                        data.selectedAnswer = '';
                        migrated = true;
                    }
                }

                // Save if any migrations occurred
                if (migrated) {
                    saveQuestionData();
                    console.log('Question data migration completed (mobile)');
                }
            } catch (error) {
                console.error('Error during data migration:', error);
            }
        }

        // Save question data to localStorage
        function saveQuestionData() {
            localStorage.setItem('questionData', JSON.stringify(questionData));
            updateStats();
        }

        // Render topics list
        function renderTopics(searchTerm = '') {
            try {
                console.log('renderTopics called, searchTerm:', searchTerm);
                const container = document.getElementById('topicsList');
                console.log('Container:', container);

                if (!container) {
                    console.error('Container #topicsList not found!');
                    return;
                }

                if (!window.topics || typeof window.topics !== 'object') {
                    console.error('Topics data not available!', typeof window.topics);
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">‚ö†Ô∏è</div>
                            <div class="empty-text">Topics Data Error</div>
                            <p style="font-size: 14px; color: #666; margin-top: 12px; text-align: center; padding: 0 20px;">
                                Topics data failed to load. Please reload the page.
                            </p>
                            <button onclick="location.reload()" style="margin-top: 16px; padding: 10px 20px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                Reload Page
                            </button>
                        </div>
                    `;
                    return;
                }

            console.log('Topics found:', Object.keys(window.topics).length, 'systems');

            // Convert topics object to array format
            const topicsArray = Object.keys(window.topics).map(system => ({
                title: system,
                categories: window.topics[system]
            }));
            console.log('Topics array:', topicsArray.length);

            // Filter by search term
            let filteredTopics = topicsArray;
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredTopics = topicsArray.filter(topic => {
                    if (topic.title.toLowerCase().includes(term)) return true;
                    return Object.keys(topic.categories).some(cat =>
                        cat.toLowerCase().includes(term)
                    );
                });
            }

            if (filteredTopics.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üîç</div><div class="empty-text">No topics found</div></div>';
                return;
            }

            const html = filteredTopics.map(topic => {
                const safeId = topic.title.replace(/[^a-zA-Z0-9]/g, '-');

                // Calculate system progress
                let systemTotal = 0;
                let systemDone = 0;
                Object.keys(topic.categories).forEach(category => {
                    const questions = topic.categories[category];
                    if (Array.isArray(questions)) {
                        systemTotal += questions.length;
                        questions.forEach(qid => {
                            if (questionData[qid] && (questionData[qid].isCorrect || questionData[qid].isIncorrect)) {
                                systemDone++;
                            }
                        });
                    }
                });

                return `
                    <div class="topic-group">
                        <button class="topic-header" onclick="toggleTopic('${safeId}')">
                            <div style="flex: 1;">
                                <div>${topic.title}</div>
                                <div style="font-size: 12px; color: #666; margin-top: 2px;">${systemDone} / ${systemTotal}</div>
                            </div>
                            <span class="topic-arrow">‚ñº</span>
                        </button>
                        <div class="subtopics" id="subtopics-${safeId}">
                            ${Object.keys(topic.categories).map(category => {
                                const questions = topic.categories[category];
                                const questionCount = Array.isArray(questions) ? questions.length : 0;

                                // Calculate category progress
                                let categoryDone = 0;
                                if (Array.isArray(questions)) {
                                    questions.forEach(qid => {
                                        if (questionData[qid] && (questionData[qid].isCorrect || questionData[qid].isIncorrect)) {
                                            categoryDone++;
                                        }
                                    });
                                }

                                return `
                                    <button class="subtopic-item" onclick='startTest(${JSON.stringify(topic.title)}, ${JSON.stringify(category)})'>
                                        <span>${category}</span>
                                        <span class="question-count">${categoryDone} / ${questionCount}</span>
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');

                console.log('Generated HTML length:', html.length);
                console.log('First 500 chars:', html.substring(0, 500));
                container.innerHTML = html;
                console.log('Topics rendered successfully');
            } catch (error) {
                console.error('Error in renderTopics():', error);
                const container = document.getElementById('topicsList');
                if (container) {
                    container.innerHTML = `<div class="empty-state"><div class="empty-icon">‚ùå</div><div class="empty-text">Error loading topics: ${error.message}</div></div>`;
                }
            }
        }

        // Toggle topic expansion
        function toggleTopic(safeId) {
            const id = 'subtopics-' + safeId;
            const subtopics = document.getElementById(id);
            const header = subtopics.previousElementSibling;

            if (subtopics.classList.contains('expanded')) {
                subtopics.classList.remove('expanded');
                header.classList.remove('expanded');
            } else {
                subtopics.classList.add('expanded');
                header.classList.add('expanded');
            }
        }

        // Start test with subtopic
        function startTest(systemName, categoryName) {
            if (!window.topics || !window.topics[systemName]) {
                alert('System not found: ' + systemName);
                return;
            }

            const questions = window.topics[systemName][categoryName];
            if (!questions || !Array.isArray(questions) || questions.length === 0) {
                alert('No questions found for: ' + categoryName);
                return;
            }

            currentSubtopic = { system: systemName, category: categoryName };
            currentQuestions = questions;
            currentQuestionIndex = 0;

            loadQuestion(0);
            switchView('question');
        }

        // Load question by index
        function loadQuestion(index) {
            if (!currentQuestions || currentQuestions.length === 0) return;

            currentQuestionIndex = index;
            const questionId = currentQuestions[index];

            document.getElementById('questionNumber').textContent = `Question #${questionId}`;
            document.getElementById('questionIframe').src = `questions/${questionId}.html`;

            // Update flag button
            const flagBtn = document.getElementById('flagBtn');
            if (questionData[questionId]?.isFlagged) {
                flagBtn.classList.add('flagged');
            } else {
                flagBtn.classList.remove('flagged');
            }

            // Update correct/incorrect buttons
            const correctBtn = document.getElementById('correctBtn');
            const incorrectBtn = document.getElementById('incorrectBtn');
            if (questionData[questionId]?.isCorrect) {
                correctBtn.classList.add('correct');
            } else {
                correctBtn.classList.remove('correct');
            }
            if (questionData[questionId]?.isIncorrect) {
                incorrectBtn.classList.add('incorrect');
            } else {
                incorrectBtn.classList.remove('incorrect');
            }

            // Update answer dropdown
            const answerSelect = document.getElementById('answer-select');
            if (answerSelect) {
                answerSelect.value = questionData[questionId]?.selectedAnswer || '';
                // Reset the last checked choice for the polling function
                lastCheckedChoice = questionData[questionId]?.selectedAnswer || '';
            }

            // Reset the last checked result for validation polling
            // Set to empty string so next validation will be detected
            lastCheckedResult = '';

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === currentQuestions.length - 1;

            // Track as attempted
            if (!questionData[questionId]) {
                const currentDate = new Date().toISOString().split('T')[0];
                questionData[questionId] = {
                    isFlagged: false,
                    isCorrect: false,
                    isIncorrect: false,
                    attempts: 0,
                    lastAttempted: currentDate,
                    selectedAnswer: '',
                    testId: 'session_' + currentDate
                };
            }
            questionData[questionId].attempts++;
            const currentDate = new Date().toISOString().split('T')[0];
            questionData[questionId].lastAttempted = currentDate;
            if (!questionData[questionId].testId) {
                questionData[questionId].testId = 'session_' + currentDate;
            }
            saveQuestionData();

            // Save current position for page reload recovery
            if (currentSubtopic && currentSubtopic.system && currentSubtopic.category) {
                localStorage.setItem('lastSession', JSON.stringify({
                    system: currentSubtopic.system,
                    category: currentSubtopic.category,
                    questionIndex: currentQuestionIndex
                }));
            }

            // Update sidebar if it's open
            const sidebar = document.getElementById('questionsSidebar');
            if (sidebar && sidebar.classList.contains('open')) {
                renderQuestionsList();
            }
        }

        // Navigation
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        // Toggle flag
        function toggleFlag() {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const questionId = currentQuestions[currentQuestionIndex];
            const currentDate = new Date().toISOString().split('T')[0];
            if (!questionData[questionId]) {
                questionData[questionId] = {
                    isFlagged: false,
                    isCorrect: false,
                    isIncorrect: false,
                    attempts: 0,
                    lastAttempted: currentDate,
                    selectedAnswer: '',
                    testId: 'session_' + currentDate
                };
            }

            questionData[questionId].isFlagged = !questionData[questionId].isFlagged;

            // Ensure lastAttempted and testId are set
            if (!questionData[questionId].lastAttempted) {
                questionData[questionId].lastAttempted = currentDate;
            }
            if (!questionData[questionId].testId) {
                questionData[questionId].testId = 'session_' + currentDate;
            }

            const flagBtn = document.getElementById('flagBtn');
            if (questionData[questionId].isFlagged) {
                flagBtn.classList.add('flagged');
            } else {
                flagBtn.classList.remove('flagged');
            }

            saveQuestionData();

            // Update sidebar if it's open
            const sidebar = document.getElementById('questionsSidebar');
            if (sidebar && sidebar.classList.contains('open')) {
                renderQuestionsList();
            }
        }

        // Mark question as correct or incorrect
        function markQuestion(status) {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const questionId = currentQuestions[currentQuestionIndex];
            const currentDate = new Date().toISOString().split('T')[0];
            if (!questionData[questionId]) {
                questionData[questionId] = {
                    isFlagged: false,
                    isCorrect: false,
                    isIncorrect: false,
                    attempts: 0,
                    lastAttempted: currentDate,
                    selectedAnswer: '',
                    testId: 'session_' + currentDate
                };
            }

            // Ensure lastAttempted and testId are set
            if (!questionData[questionId].lastAttempted) {
                questionData[questionId].lastAttempted = currentDate;
            }
            if (!questionData[questionId].testId) {
                questionData[questionId].testId = 'session_' + currentDate;
            }

            const correctBtn = document.getElementById('correctBtn');
            const incorrectBtn = document.getElementById('incorrectBtn');

            if (status === 'correct') {
                questionData[questionId].isCorrect = !questionData[questionId].isCorrect;
                questionData[questionId].isIncorrect = false;

                if (questionData[questionId].isCorrect) {
                    correctBtn.classList.add('correct');
                    incorrectBtn.classList.remove('incorrect');
                } else {
                    correctBtn.classList.remove('correct');
                }
            } else if (status === 'incorrect') {
                questionData[questionId].isIncorrect = !questionData[questionId].isIncorrect;
                questionData[questionId].isCorrect = false;

                if (questionData[questionId].isIncorrect) {
                    incorrectBtn.classList.add('incorrect');
                    correctBtn.classList.remove('correct');
                } else {
                    incorrectBtn.classList.remove('incorrect');
                }
            }

            saveQuestionData();

            // Update sidebar if it's open
            const sidebar = document.getElementById('questionsSidebar');
            if (sidebar && sidebar.classList.contains('open')) {
                renderQuestionsList();
            }
        }

        // Save selected answer from dropdown
        function saveSelectedAnswer() {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const questionId = currentQuestions[currentQuestionIndex];
            const answerSelect = document.getElementById('answer-select');

            if (!questionData[questionId]) {
                questionData[questionId] = {
                    isFlagged: false,
                    isCorrect: false,
                    isIncorrect: false,
                    attempts: 0,
                    lastAttempted: new Date().toISOString(),
                    selectedAnswer: ''
                };
            }

            questionData[questionId].selectedAnswer = answerSelect.value;
            saveQuestionData();

            // Also save to the choice_q format that iframe uses
            const choiceKey = 'choice_q' + questionId;
            if (answerSelect.value) {
                localStorage.setItem(choiceKey, answerSelect.value);
            } else {
                localStorage.removeItem(choiceKey);
            }

            // Update lastCheckedChoice to prevent loop
            lastCheckedChoice = answerSelect.value;
        }

        // Check for choice changes in iframe (using localStorage polling)
        let lastCheckedChoice = '';

        function checkIframeChoice() {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const questionId = currentQuestions[currentQuestionIndex];
            const choiceKey = 'choice_q' + questionId;
            const currentChoice = localStorage.getItem(choiceKey) || '';

            if (currentChoice && currentChoice !== lastCheckedChoice) {
                lastCheckedChoice = currentChoice;

                const answerSelect = document.getElementById('answer-select');
                if (answerSelect && answerSelect.value !== currentChoice) {
                    answerSelect.value = currentChoice;

                    // Save to questionData
                    if (!questionData[questionId]) {
                        questionData[questionId] = {
                            isFlagged: false,
                            isCorrect: false,
                            isIncorrect: false,
                            attempts: 0,
                            lastAttempted: new Date().toISOString(),
                            selectedAnswer: ''
                        };
                    }
                    questionData[questionId].selectedAnswer = currentChoice;
                    saveQuestionData();
                }
            }
        }

        // Check every 500ms for changes
        setInterval(checkIframeChoice, 500);

        // Check for answer validation from iframe
        let lastCheckedResult = '';

        function checkAnswerValidation() {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const questionId = currentQuestions[currentQuestionIndex];
            const resultKey = 'result_q' + questionId;
            const currentResult = localStorage.getItem(resultKey) || '';

            if (currentResult && currentResult !== lastCheckedResult) {
                lastCheckedResult = currentResult;

                // Auto-mark correct or incorrect button
                if (!questionData[questionId]) {
                    questionData[questionId] = {
                        isFlagged: false,
                        isCorrect: false,
                        isIncorrect: false,
                        attempts: 0,
                        lastAttempted: new Date().toISOString(),
                        selectedAnswer: ''
                    };
                }

                if (currentResult === 'correct') {
                    questionData[questionId].isCorrect = true;
                    questionData[questionId].isIncorrect = false;
                } else if (currentResult === 'incorrect') {
                    questionData[questionId].isCorrect = false;
                    questionData[questionId].isIncorrect = true;
                }

                saveQuestionData();

                // Update button UI
                const correctBtn = document.getElementById('correctBtn');
                const incorrectBtn = document.getElementById('incorrectBtn');

                if (currentResult === 'correct') {
                    correctBtn.classList.add('correct');
                    incorrectBtn.classList.remove('incorrect');
                } else {
                    correctBtn.classList.remove('correct');
                    incorrectBtn.classList.add('incorrect');
                }

                // Update sidebar (always update, not just when open)
                renderQuestionsList();

                console.log(`Auto-marked as ${currentResult} for question ${questionId}`);
            }
        }

        // Check every 500ms for answer validation
        setInterval(checkAnswerValidation, 500);

        // Get all valid question IDs from topics
        function getAllValidQuestionIds() {
            const validIds = new Set();

            // Iterate through all systems in topics
            Object.values(window.topics || topics).forEach(system => {
                // Iterate through all categories in each system
                Object.values(system).forEach(questionArray => {
                    // Add all question IDs to the set
                    if (Array.isArray(questionArray)) {
                        questionArray.forEach(id => validIds.add(String(id)));
                    }
                });
            });

            return validIds;
        }

        // Search question by ID (supports single ID or comma-separated IDs)
        function searchQuestionById() {
            const input = document.getElementById('questionIdInput');
            const inputValue = input.value.trim();

            if (!inputValue) {
                alert('Please enter a question ID');
                return;
            }

            // Check if input contains comma (multiple IDs)
            if (inputValue.includes(',')) {
                // Parse comma-separated IDs
                const questionIds = inputValue
                    .split(',')
                    .map(id => id.trim())
                    .filter(id => id !== '');

                if (questionIds.length === 0) {
                    alert('Please enter valid question IDs');
                    return;
                }

                // Get all valid question IDs from topics
                const validIds = getAllValidQuestionIds();

                // Filter to only include valid question IDs
                const originalCount = questionIds.length;
                const validQuestionIds = questionIds.filter(id => validIds.has(id));
                const removedCount = originalCount - validQuestionIds.length;

                if (validQuestionIds.length === 0) {
                    alert('None of the entered question IDs exist in the topics database');
                    return;
                }

                // Start test with valid IDs only
                currentQuestions = validQuestionIds;
                currentQuestionIndex = 0;
                loadQuestion(0);
                switchView('question');
                input.value = '';

                // Show toast notification with filtering info
                let message = `Starting test with ${validQuestionIds.length} question${validQuestionIds.length !== 1 ? 's' : ''}`;
                if (removedCount > 0) {
                    message += ` (${removedCount} invalid ID${removedCount !== 1 ? 's' : ''} removed)`;
                }
                showToast(message);
                return;
            }

            // Single ID search
            const questionId = inputValue;
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><div>Loading question...</div></div>';

            // Load the question
            currentQuestions = [questionId];
            currentQuestionIndex = 0;
            loadQuestion(0);
            switchView('question');
            input.value = '';
        }

        // Download backup
        function downloadBackup() {
            const backup = {
                version: '1.0',
                backupDate: new Date().toISOString(),
                questionData: questionData,
                device: 'mobile'
            };

            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `usmle-mobile-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('Backup downloaded successfully!');
        }

        // Upload backup
        function uploadBackup(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const backup = JSON.parse(e.target.result);

                    // Check if it's new format (has backupDate) or old format
                    let dataToMerge = null;
                    let isOldFormat = false;

                    if (backup.backupDate && backup.questionData) {
                        // New format backup
                        dataToMerge = backup.questionData;
                    } else if (backup.questionData && !backup.backupDate) {
                        // Old USMLE Environment format - needs migration
                        const migrated = migrateOldBackup(backup.questionData);
                        dataToMerge = migrated.data;
                        isOldFormat = true;
                    } else {
                        throw new Error('Invalid backup format');
                    }

                    // Merge with existing data
                    if (dataToMerge) {
                        Object.keys(dataToMerge).forEach(qid => {
                            if (!questionData[qid]) {
                                questionData[qid] = dataToMerge[qid];
                            } else {
                                // Merge data (keep most attempts, most recent date, etc.)
                                const existing = questionData[qid];
                                const incoming = dataToMerge[qid];

                                questionData[qid] = {
                                    isFlagged: existing.isFlagged || incoming.isFlagged,
                                    isCorrect: existing.isCorrect || incoming.isCorrect,
                                    isIncorrect: existing.isIncorrect || incoming.isIncorrect,
                                    attempts: Math.max(existing.attempts || 0, incoming.attempts || 0),
                                    lastAttempted: new Date(existing.lastAttempted) > new Date(incoming.lastAttempted) ? existing.lastAttempted : incoming.lastAttempted,
                                    selectedAnswer: incoming.selectedAnswer || existing.selectedAnswer || ''
                                };
                            }
                        });

                        saveQuestionData();
                        updateStats();

                        if (isOldFormat) {
                            showToast('‚úÖ Old USMLE Environment backup migrated successfully!');
                        } else {
                            showToast('Backup uploaded and merged successfully!');
                        }
                    } else {
                        throw new Error('Invalid backup format');
                    }
                } catch (error) {
                    alert('Error loading backup: ' + error.message);
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        // Migrate old backup format to new format
        function migrateOldBackup(oldData) {
            const newData = {};
            const stats = {
                total: 0,
                correct: 0,
                incorrect: 0,
                flagged: 0
            };

            for (const [qId, oldQuestion] of Object.entries(oldData)) {
                // Convert old format to new format
                // Old format: {mark, correct, incorrect, choice, date}
                const isFlagged = oldQuestion.mark === true;
                const isCorrect = oldQuestion.correct === true;
                const isIncorrect = oldQuestion.incorrect === true;
                const selectedAnswer = oldQuestion.choice || '';

                // Only add question if it has any data
                if (oldQuestion.date || isCorrect || isIncorrect || isFlagged || selectedAnswer) {
                    newData[qId] = {
                        isFlagged: isFlagged,
                        isCorrect: isCorrect,
                        isIncorrect: isIncorrect,
                        attempts: (isCorrect || isIncorrect) ? 1 : 0,
                        lastAttempted: oldQuestion.date || new Date().toISOString().split('T')[0],
                        selectedAnswer: selectedAnswer
                    };

                    // Count statistics
                    if (isCorrect) stats.correct++;
                    if (isIncorrect) stats.incorrect++;
                    if (isFlagged) stats.flagged++;
                }
            }

            stats.total = stats.correct + stats.incorrect;

            return {
                data: newData,
                stats: stats
            };
        }

        // Clear all data
        function confirmClearData() {
            showModal(
                'Clear All Data?',
                'This will permanently delete all your progress. This action cannot be undone.',
                () => {
                    questionData = {};
                    saveQuestionData();
                    showToast('All data cleared');
                    closeModal();
                }
            );
        }

        // Update statistics
        function updateStats() {
            const total = Object.keys(questionData).length;
            let correct = 0;
            let incorrect = 0;
            let flagged = 0;

            Object.values(questionData).forEach(q => {
                if (q.isCorrect) correct++;
                if (q.isIncorrect) incorrect++;
                if (q.isFlagged) flagged++;
            });

            // Calculate accuracy based on questions that have been marked (correct or incorrect)
            const marked = correct + incorrect;
            const accuracy = marked > 0 ? Math.round((correct / marked) * 100) : 0;

            document.getElementById('totalAnswered').textContent = total;
            document.getElementById('totalCorrect').textContent = correct;
            document.getElementById('totalIncorrect').textContent = incorrect;
            document.getElementById('totalFlagged').textContent = flagged;
            document.getElementById('accuracyRate').textContent = accuracy + '%';
        }

        // Switch view
        function switchView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            // Show selected view
            document.getElementById(viewName + 'View').classList.add('active');
            document.querySelector(`[data-view="${viewName}"]`).classList.add('active');

            // Update specific views
            if (viewName === 'backup') {
                updateStats();
            }
        }

        // Show modal
        function showModal(title, text, onConfirm) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').innerHTML = text; // Changed to innerHTML to support HTML tags
            document.getElementById('modalConfirmBtn').onclick = onConfirm;
            document.getElementById('confirmModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        // Show toast (simple feedback)
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 12px 24px;
                border-radius: 24px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('questionsSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const isOpen = sidebar.classList.contains('open');

            if (isOpen) {
                closeSidebar();
            } else {
                openSidebar();
            }
        }

        function openSidebar() {
            const sidebar = document.getElementById('questionsSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.add('open');
            overlay.classList.add('open');
            renderQuestionsList();

            // Restore scroll position after a brief delay to allow rendering
            setTimeout(() => {
                const savedScroll = localStorage.getItem('sidebarScrollPosition');
                if (savedScroll) {
                    sidebar.scrollTop = parseInt(savedScroll);
                }
            }, 50);
        }

        function closeSidebar() {
            const sidebar = document.getElementById('questionsSidebar');
            const overlay = document.getElementById('sidebarOverlay');

            // Save scroll position before closing
            if (sidebar.scrollTop > 0) {
                localStorage.setItem('sidebarScrollPosition', sidebar.scrollTop.toString());
            }

            sidebar.classList.remove('open');
            overlay.classList.remove('open');
        }

        function renderQuestionsList() {
            const listContainer = document.getElementById('questionsList');
            if (!listContainer) return;

            if (currentQuestions.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No questions loaded</div>';
                return;
            }

            const html = currentQuestions.map((qid, index) => {
                const data = questionData[qid] || {};
                const isCurrent = index === currentQuestionIndex;
                const isFlagged = data.isFlagged;
                const isCorrect = data.isCorrect;
                const isIncorrect = data.isIncorrect;

                let statusText = [];
                if (isCorrect) statusText.push('‚úì Correct');
                if (isIncorrect) statusText.push('‚úó Incorrect');
                if (isFlagged) statusText.push('üö© Flagged');

                // Build classes array with priority order
                const classes = [
                    'question-list-item',
                    isCurrent ? 'current' : '',
                    isCorrect ? 'correct' : '',
                    isIncorrect ? 'incorrect' : '',
                    isFlagged ? 'flagged' : ''
                ].filter(Boolean).join(' ');

                return `
                    <div class="${classes}" onclick="jumpToQuestion(${index})">
                        <div class="question-list-id">Question #${qid}</div>
                        <div class="question-list-status">
                            ${statusText.join(' ‚Ä¢ ') || 'Not answered'}
                        </div>
                    </div>
                `;
            }).join('');

            listContainer.innerHTML = html;
        }

        function jumpToQuestion(index) {
            if (index >= 0 && index < currentQuestions.length) {
                loadQuestion(index);
                closeSidebar();
            }
        }

        // Topic search
        document.getElementById('topicSearch').addEventListener('input', (e) => {
            renderTopics(e.target.value);
        });

        // Question ID search on Enter
        document.getElementById('questionIdInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchQuestionById();
            }
        });

        // Backup button in header
        document.getElementById('backupBtn').addEventListener('click', () => {
            switchView('backup');
        });

        // Close modal on overlay click
        document.getElementById('confirmModal').addEventListener('click', (e) => {
            if (e.target.id === 'confirmModal') {
                closeModal();
            }
        });

        // Initialize app
        function startApp() {
            // Check authentication first
            const isAuthenticated = checkAuthentication();

            if (isAuthenticated) {
                // User is already authenticated, load content immediately
                if (typeof window.topics !== 'undefined') {
                    console.log('‚úÖ Topics ready! Starting app...');
                    init();
                } else {
                    console.error('‚ùå Topics data not found!');
                    init(); // Call anyway to show error message
                }
            }
            // If not authenticated, content will be loaded after password is entered
        }

        // Add sidebar scroll listener for persistence
        function setupSidebarScrollListener() {
            const sidebar = document.getElementById('questionsSidebar');
            if (sidebar) {
                sidebar.addEventListener('scroll', () => {
                    if (sidebar.classList.contains('open')) {
                        localStorage.setItem('sidebarScrollPosition', sidebar.scrollTop.toString());
                    }
                });
            }
        }

        // Start initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                startApp();
                setupSidebarScrollListener();
            });
        } else {
            startApp();
            setupSidebarScrollListener();
        }
    </script>
</body>
</html>
