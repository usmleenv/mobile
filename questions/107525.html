
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>107525</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="45ae5453-45b7-4b2e-a88e-65786c20925d">Researchers conduct a
                                        multinational study to evaluate factors that lead to severe manifestations of
                                        malaria.  Various clinical data of a large number of patients with malaria are
                                        obtained.  It is found that patients infected with <em>Plasmodium
                                            falciparum</em> frequently have a higher degree of parasitemia compared to
                                        age and sex-matched patients infected with other species of
                                        <em>Plasmodium</em>.  Which of the following features of <em>P falciparum</em>
                                        most likely explains the findings in this study?</p>
<table class="simple-table" id="e7c98779-dfbc-474d-ab81-246319cd38d3">
<tbody>
<tr id="12414c28-cc24-4955-9e87-ae5287e20156">
<td class="" id="Tf_Y">A.</td>
<td class="" id="ENag">Ability for anaerobic glucose metabolism</td>
<td class="" id="NxZ|"></td>
</tr>
<tr id="090d707e-9393-421e-ac1a-2a4e4569a321">
<td class="" id="Tf_Y">B.</td>
<td class="" id="ENag">Ability for proteolysis of hemoglobin</td>
<td class="" id="NxZ|"></td>
</tr>
<tr id="80a219e7-bc77-45f6-9904-75ad6f63bdbe">
<td class="" id="Tf_Y">C.</td>
<td class="" id="ENag">Ability to infect erythrocytes of all ages</td>
<td class="" id="NxZ|"></td>
</tr>
<tr id="18c28ecd-6302-4809-900a-88df96e1524f">
<td class="" id="Tf_Y">D.</td>
<td class="" id="ENag">Ability to mutate drug transporter proteins</td>
<td class="" id="NxZ|"></td>
</tr>
<tr id="f7c7723f-84f7-4c2a-aa7a-fcf3b6fecbb7">
<td class="" id="Tf_Y">E.</td>
<td class="" id="ENag">Ability to transform into a dormant form</td>
<td class="" id="NxZ|"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="7a65de61-cfb6-41cf-8ec1-d03d0c9142aa">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="d09c0d7f-23e9-4554-9ef0-624034c92da9">
<tbody>
<tr id="c76ef36e-e4d2-4638-ba04-c22a8bd7e3b2">
<td class="" id="?SK\">A.</td>
<td class="" id="fMm`">Ability for anaerobic glucose
                                                                metabolism (4%)</td>
<td class="" id="dIyq"></td>
</tr>
<tr id="66292d54-f1f5-43e0-abdf-d8b4468ac015">
<td class="" id="?SK\">B.</td>
<td class="" id="fMm`">Ability for proteolysis of hemoglobin
                                                                (7%)</td>
<td class="" id="dIyq"></td>
</tr>
<tr id="219bdc85-c7a1-4983-aa32-310fe8e687c1">
<td class="" id="?SK\">C.</td>
<td class="" id="fMm`">Ability to infect erythrocytes of all
                                                                ages (55%)</td>
<td class="" id="dIyq"></td>
</tr>
<tr id="fd44b391-d894-4762-a407-8a5e30875f26">
<td class="" id="?SK\">D.</td>
<td class="" id="fMm`">Ability to mutate drug transporter
                                                                proteins (10%)</td>
<td class="" id="dIyq"></td>
</tr>
<tr id="61867a7e-02db-48fa-9050-0396342db630">
<td class="" id="?SK\">E.</td>
<td class="" id="fMm`">Ability to transform into a dormant
                                                                form (21%)</td>
<td class="" id="dIyq"></td>
</tr>
</tbody>
</table>
<p class="" id="b809824f-aa08-411f-8ddf-f59c63aa3297">Correct</p>
<p class="" id="faa40d74-0eb0-4f08-b048-cb6fc95d91de">55%Answered
                                                    correctly</p>
<p class="" id="20dfec12-9e0f-48e7-8d02-67fc996f5b6d">10 secsTime Spent
                                                </p>
<p class="" id="7874975b-206a-4da6-a487-acc08c6ed257">2024Version</p>
<ul class="bulleted-list" id="47b7dde2-3d69-40bf-9db1-c984f806f32b">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="8113ce5b-ae1d-4782-96fa-0ae6a8d99d9b">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="086d62f1-54b4-4972-965a-1322bad07087">Malaria is
                                                    transmitted when an infected female <em>Anopheles</em> mosquito
                                                    injects <em>Plasmodium</em> sporozoites into a human during a bite. 
                                                    The sporozoites travel through the bloodstream to the liver, where
                                                    they infect hepatocytes and mature into schizonts.  Within days to a
                                                    few weeks, liver schizonts rupture the hepatocytes, releasing
                                                    thousands of merozoites into the bloodstream.</p>
<p class="" id="be0e67e2-45b0-4d06-9532-ab26c8b28a1d">Merozoites from
                                                    different species of malaria have different affinities for
                                                    erythrocytes.  <em>Plasmodium vivax</em> and <em>Plasmodium
                                                        ovale</em> primarily infect very young, large erythrocytes
                                                    recently released from the bone marrow (ie, reticulocytes), whereas
                                                    <em>Plasmodium malariae</em> primarily infects old erythrocytes that
                                                    have been in the bloodstream for months.  In contrast,
                                                    <em>Plasmodium falciparum</em> has the unique ability to infect
                                                    erythrocytes of all ages.</p>
<p class="" id="f6e39f39-926e-4e95-984a-c261c6f28038">Because <em>P
                                                        falciparum</em> can target a much larger pool of erythrocytes,
                                                    patients infected with this species typically have much greater
                                                    levels of parasitemia than those infected with other species.  In
                                                    addition, <em>P falciparum</em> has a unique ability to
                                                    significantly increase cytoadherence molecules on the surface of
                                                    infected erythrocytes, leading to increased risk for microvascular
                                                    adhesion with subsequent tissue ischemia.  The combination of a high
                                                    degree of parasitemia and a high risk for microvascular adhesion
                                                    make <em>P falciparum</em> the most severe and deadly species of
                                                    malaria.</p>
<p class="" id="9c2de145-54b7-40dc-aa29-d6c2bc169d3a">(Choice A)  All
                                                    <em>Plasmodium</em> species that cause malaria rely primarily on
                                                    anaerobic metabolism because they are unable to perform oxidative
                                                    phosphorylation in their mitochondria.  Parasite anaerobic
                                                    glycolysis likely contributes to the hypoglycemia and acidosis (eg,
                                                    lactic acidosis) typically seen in severe malaria.</p>
<p class="" id="8692b3cd-16f8-4ff5-908f-c1bb238ec347">(Choice B)  All
                                                    <em>Plasmodium</em> species that cause malaria digest hemoglobin in
                                                    vacuoles to supply the parasite with amino acids.  This generates
                                                    hemozoin, a toxic metabolite identified by macrophages in the
                                                    reticuloendothelial system, leading to erythrocyte pruning and,
                                                    often, splenomegaly.</p>
<p class="" id="8c871379-b157-45e5-afd5-aa87795697b4">(Choice D) 
                                                    Although most strains of <em>P falciparum</em> are resistant to
                                                    chloroquine due to point mutations in the chloroquine resistance
                                                    transporter protein, this does not account for the high degree of
                                                    parasitemia seen with <em>P falciparum</em> infections.</p>
<p class="" id="9920ca79-2ecc-412e-8095-9085d23f5dee">(Choice E)  <em>P
                                                        vivax</em> and <em>P ovale</em> develop a dormant form in the
                                                    liver that can reactivate months or a few years later.  This is not
                                                    a feature of <em>P falciparum</em> and does not contribute to the
                                                    high degree of parasitemia seen with this species.</p>
<p class="" id="32577818-daef-47d8-beb4-03a679f1c303">Educational
                                                    objective:</p>
<p class="" id="bd4ae548-7355-456b-9e36-2f5828865ca7"><em>Plasmodium
                                                        falciparum</em> can achieve much higher levels of parasitemia
                                                    than other species of malaria due to its ability to infect
                                                    erythrocytes of all ages.  In contrast, <em>Plasmodium ovale</em>
                                                    and <em>Plasmodium vivax</em> primarily infect reticulocytes, and
                                                    <em>Plasmodium malariae</em> primarily infects old erythrocytes.</p>
<p class="" id="6087f545-11b7-46c9-8bc6-71306ca8ce9c">Microbiology</p>
<p class="" id="b61063f6-c7a5-4e17-a947-993bd0187603">Subject</p>
<p class="" id="b84d246a-fb72-44d6-980c-a0e4f48b0da9">Infectious
                                                    Diseases</p>
<p class="" id="3b7b783b-95bc-4512-84e8-1e2169ab6088">System</p>
<p class="" id="75e0600b-4223-4f0f-9451-21d29399bced">Malaria</p>
<p class="" id="bfa966fc-f13a-4905-9328-f7c80be36d3a">Topic</p>
<p class="" id="296f5366-1b76-4a62-b780-35c2e4d1a154">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="58dc35a4-4140-4384-9ded-59c87af914cb">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
