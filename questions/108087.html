
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>108087</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="6a399a8e-0cda-444e-82b6-9826c497af23">A 60-year-old woman comes to
                                        the clinic due to worsening dyspepsia and unintentional weight loss over the
                                        past 3 months.  Vital signs are normal.  There is no cervical or inguinal
                                        lymphadenopathy.  Abdominal examination shows mild epigastric tenderness. 
                                        Complete blood count and serum chemistry results are normal.  CT scan of the
                                        abdomen reveals gastric mucosal thickening but no evidence of abdominal
                                        lymphadenopathy or hepatosplenomegaly.  Endoscopy shows nodular gastric folds,
                                        and biopsy shows proliferation of small, clonal, mucosa-associated B cells
                                        expressing the CD20 antigen.  Which of the following microbe-induced mechanisms
                                        is the most likely underlying cause of the findings seen in this patient?</p>
<table class="simple-table" id="5a509c4b-5560-4d89-86c3-7b0bcab3ee68">
<tbody>
<tr id="9854a31e-899b-4b14-b45a-e294f7e6aa4c">
<td class="" id="UWr]">A.</td>
<td class="" id="DKWG">Chronic immune stimulation</td>
<td class="" id="mdv}"></td>
</tr>
<tr id="31619516-6911-4eab-88dd-46d1d9a2e929">
<td class="" id="UWr]">B.</td>
<td class="" id="DKWG">E6 protein‚Äìmediated P53 inhibition</td>
<td class="" id="mdv}"></td>
</tr>
<tr id="c250e0ca-5830-48a4-9c9a-0ba9c9e4f9d4">
<td class="" id="UWr]">C.</td>
<td class="" id="DKWG">Evasion of immune response</td>
<td class="" id="mdv}"></td>
</tr>
<tr id="91b74455-a678-40bf-9f97-fcdf07e4262b">
<td class="" id="UWr]">D.</td>
<td class="" id="DKWG">Initiation of somatic hypermutation</td>
<td class="" id="mdv}"></td>
</tr>
<tr id="37f3bde0-fa5b-4e49-a529-551095020bd9">
<td class="" id="UWr]">E.</td>
<td class="" id="DKWG">Integration of microbial genome into host genome
                                                </td>
<td class="" id="mdv}"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="cfee0ae0-c0ed-456b-8590-772ff2c9eb07">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="68159ee6-1f11-4ed9-843c-43de6c81ee9d">
<tbody>
<tr id="00ca370c-afc7-44a8-8be9-9c171e4e9adb">
<td class="" id="_O]D">A.</td>
<td class="" id="axIn">Chronic immune stimulation (48%)</td>
<td class="" id="ftOs"></td>
</tr>
<tr id="cd44981e-ac63-43a7-9467-c2615fd35a6f">
<td class="" id="_O]D">B.</td>
<td class="" id="axIn">E6 protein‚Äìmediated P53 inhibition
                                                                (13%)</td>
<td class="" id="ftOs"></td>
</tr>
<tr id="e6daf02e-8607-423d-a663-64119eb30440">
<td class="" id="_O]D">C.</td>
<td class="" id="axIn">Evasion of immune response (17%)</td>
<td class="" id="ftOs"></td>
</tr>
<tr id="cf0eee74-4c81-4a49-921b-938aa227bfee">
<td class="" id="_O]D">D.</td>
<td class="" id="axIn">Initiation of somatic hypermutation
                                                                (10%)</td>
<td class="" id="ftOs"></td>
</tr>
<tr id="d571c428-9248-4cee-8ad0-33b54fac7a85">
<td class="" id="_O]D">E.</td>
<td class="" id="axIn">Integration of microbial genome into
                                                                host genome (9%)</td>
<td class="" id="ftOs"></td>
</tr>
</tbody>
</table>
<p class="" id="e5b80654-e7ba-42e1-9c96-70c8fc50715b">Incorrect</p>
<p class="" id="1ae16a27-4e9a-4e57-ac33-c08dd17a0e27">Correct answer A
                                                </p>
<p class="" id="2cee712d-38d4-49f8-9dab-35469656b051">48%Answered
                                                    correctly</p>
<p class="" id="de36265f-48dd-4b50-bb93-8dacb7b2b90c">17 secsTime Spent
                                                </p>
<p class="" id="df589bcb-d153-455b-8954-9631b0791f9e">2024Version</p>
<ul class="bulleted-list" id="12022238-88fb-47f5-b403-7116e4cf7ced">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="ff4ed320-1ffa-41a5-872f-49250778a779">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="d9fc4dd6-6e6b-4cf3-ba63-a175a2b47af8">This
                                                    patient's gastric nodules composed of small clonal B cells are
                                                    indicative of an extranodal marginal zone lymphoma involving
                                                    mucosa-associated lymphoid tissue (MALT lymphoma).  This form of
                                                    non-Hodgkin lymphoma arises from post‚Äìgerminal center memory B
                                                    cells, which typically express the markers found on all B cells (eg,
                                                    CD19, CD20), as well as mature B-cell markers (eg, CD22).</p>
<p class="" id="9e0e9158-2f44-4a45-9762-adfb6a9c1812">Most MALT
                                                    lymphomas are thought to arise due to chronic immune stimulation
                                                    from bacterial, viral, or autoimmune conditions.  The most common
                                                    trigger for gastric MALT lymphoma is <em>Helicobacter pylori</em>
                                                    infection, which leads to local recruitment and proliferation of
                                                    antigen-specific T and B lymphocytes.  Over time, chronic immune
                                                    stimulation results in the emergence of a monoclonal B-cell line
                                                    that proliferates excessively in the presence of <em>H pylori</em>
                                                    antigens.  This cell line eventually accumulates genetic
                                                    abnormalities that allow it to proliferate in an antigen-independent
                                                    fashion, resulting in spread away from the local site of infection.
                                                </p>
<p class="" id="622212e7-1fb3-4541-b149-b58523d2d6e8">Because most cases
                                                    of gastric MALT lymphoma are tightly linked to <em>H pylori</em>
                                                    infection, antimicrobial treatment can often result in complete
                                                    remission of early-stage disease due to elimination of the bacterial
                                                    antigens driving tumor proliferation.</p>
<p class="" id="ac249042-ef61-425b-8650-9d358a68157b">(Choices B and E) 
                                                    Certain human papillomavirus (HPV) serotypes cause epithelial
                                                    cancers of the head, neck, cervix, and anus.  Oncogenesis is
                                                    mediated via production of the viral protein E6, which degrades host
                                                    P53 protein, a promoter of cell repair after DNA damage and negative
                                                    regulator of the cell cycle.  HPV also integrates into the host
                                                    genome, resulting in DNA damage that contributes to oncogenesis.</p>
<p class="" id="c5da39e3-d3f1-4455-9075-b33060753a6c">(Choice C) 
                                                    Epstein-Barr virus (EBV) is a lymphotropic, oncogenic virus
                                                    associated with certain B- and T-cell lymphomas.  In latent EBV
                                                    infection, episomal EBV DNA generates low levels of viral proteins
                                                    that allow it to evade the host immune response.  The viral proteins
                                                    also activate proliferation-promoting and antiapoptotic host genes,
                                                    leading to oncogenesis in a minority of cases.</p>
<p class="" id="9049a2f1-4e71-4066-813d-831457bb406f">(Choice D)  Within
                                                    B cells, somatic hypermutation at the variable region of the
                                                    immunoglobulin gene allows the generation of diverse antibodies. 
                                                    Hypermutation allows for B-cell production of high-affinity
                                                    immunoglobulins against the immunizing antigen; they are not a cause
                                                    of oncogenesis in MALT lymphomas (which arise from post-germinal
                                                    center memory B cells).</p>
<p class="" id="433f2768-7f09-46f6-a7f3-0abb3e1d1ba6">Educational
                                                    objective:</p>
<p class="" id="3a421e33-fbbb-4d1d-af8e-3cca9e965aee"><em>Helicobacter
                                                        pylori</em> is associated with gastric MALT lymphoma due to
                                                    chronic stimulation of the immune response; the continuous cell
                                                    division predisposes to accumulation of mutations that result in
                                                    aberrant B-cell proliferation.  Treatment of <em>H pylori</em> can
                                                    induce remission in the majority of cases of early-stage gastric
                                                    MALT lymphomas.</p>
<p class="" id="a01c0b27-0b23-4744-94c4-d13bf9d2070f">References</p>
<ul class="bulleted-list" id="b9f2b156-68ca-467f-9814-baeb3ca19c61">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/30364585">MALT
                                                            lymphoma: epidemiology, clinical diagnosis and treatment</a>
</li>
</ul>
<p class="" id="853fc7ef-e92e-4161-b585-e1252461a160">Microbiology</p>
<p class="" id="c01afecf-8297-4397-a5c8-b9eb360ce6cb">Subject</p>
<p class="" id="ec96a13f-dfd1-4b41-8bbb-850bd00a8c99">Gastrointestinal
                                                    &amp; Nutrition</p>
<p class="" id="40c2588b-2ea9-4ee6-889a-e67fe11a94fa">System</p>
<p class="" id="783bded1-9b7d-4bec-9b75-9def278ece9f">Malt lymphoma</p>
<p class="" id="7e635fa3-b777-4714-8751-e4ef9d1d6efc">Topic</p>
<p class="" id="970338c4-2678-4e23-bb2b-8aeabf0e3fee">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="2342a3c8-6a80-4caf-ad93-d81e219437a4">‚ú®üÖ±Ô∏è1üÖ∞Ô∏è1üîç-13
                                                    ~üïí1 sec</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
