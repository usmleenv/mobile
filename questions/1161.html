
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1161</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="cec711c4-a495-4a12-9416-fc5b969da961">A 34-year-old missionary in
                                        southern Asia is traveling to a remote village and becomes stranded when his bus
                                        breaks down.  He has no access to water for 36 hours, during which his urine
                                        osmolality reaches 1100 mOsm/L.  Urine concentration depends primarily on the
                                        serum level of vasopressin, which is regulated by the neurohypophysis in
                                        response to plasma osmolality and blood volume.  Which of the following nephron
                                        segments responds to vasopressin by increasing absorption of a specific solute
                                        that is important for generating a high medullary concentration gradient?</p>
<table class="simple-table" id="7bf3c0b2-bbf1-40ad-9163-5e199c99cc7f">
<tbody>
<tr id="43d69d52-d1db-4e76-bf2a-a6246a8b4434">
<td class="" id="XDsF">A.</td>
<td class="" id="&lt;HGq">Cortical segment of the collecting duct</td>
<td class="" id="CfLt"></td>
</tr>
<tr id="8500c088-e74d-4dda-bd36-9c2e0667f561">
<td class="" id="XDsF">B.</td>
<td class="" id="&lt;HGq">Early distal tubule</td>
<td class="" id="CfLt"></td>
</tr>
<tr id="62b27011-12ae-4d06-8c34-afbe4422591e">
<td class="" id="XDsF">C.</td>
<td class="" id="&lt;HGq">Medullary segment of the collecting duct</td>
<td class="" id="CfLt"></td>
</tr>
<tr id="3e0c918a-eff3-493d-b75d-0b0b1fb48614">
<td class="" id="XDsF">D.</td>
<td class="" id="&lt;HGq">Proximal tubule</td>
<td class="" id="CfLt"></td>
</tr>
<tr id="485ce974-364b-4aa7-a7fb-4ffd7308fb77">
<td class="" id="XDsF">E.</td>
<td class="" id="&lt;HGq">Thin ascending limb of the loop of Henle</td>
<td class="" id="CfLt"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="b27392c7-3635-4958-9956-da57b909d225">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="aa3c36d7-dc4d-40c7-b2ad-98d944eff44e">
<tbody>
<tr id="f176c421-56b7-49a0-a85a-490abd0b7ab1">
<td class="" id="`pb:">A.</td>
<td class="" id="tSEV">Cortical segment of the collecting
                                                                duct (22%)</td>
<td class="" id="ZCp:"></td>
</tr>
<tr id="6c44572e-ba2a-4445-838f-81f598f3a008">
<td class="" id="`pb:">B.</td>
<td class="" id="tSEV">Early distal tubule (3%)</td>
<td class="" id="ZCp:"></td>
</tr>
<tr id="2b807b23-d9b6-4129-9bfd-b71c47a246d8">
<td class="" id="`pb:">C.</td>
<td class="" id="tSEV">Medullary segment of the collecting
                                                                duct (60%)</td>
<td class="" id="ZCp:"></td>
</tr>
<tr id="107c684e-45b4-46c0-acc8-1c8ec6b6d717">
<td class="" id="`pb:">D.</td>
<td class="" id="tSEV">Proximal tubule (4%)</td>
<td class="" id="ZCp:"></td>
</tr>
<tr id="b9b2a5d8-7536-451c-b34a-a31b901e57e1">
<td class="" id="`pb:">E.</td>
<td class="" id="tSEV">Thin ascending limb of the loop of
                                                                Henle (8%)</td>
<td class="" id="ZCp:"></td>
</tr>
</tbody>
</table>
<p class="" id="5fcfddc0-d670-47bb-98b0-9491ff81dca1">Correct</p>
<p class="" id="8ef22e63-f9e2-49a2-b031-96f158b2480a">60%Answered
                                                    correctly</p>
<p class="" id="b127edaa-6b21-41ca-beda-36617ae6d824">14 secsTime Spent
                                                </p>
<p class="" id="6ec53606-6601-4a35-9b17-1c924adf6580">2024Version</p>
<ul class="bulleted-list" id="82f5818e-8efe-4dca-a3fe-0a2896ddba22">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="e9c59b5e-d5e8-4325-ac0b-b2f8ee946e67">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="620a8d81-3d93-4f59-8eb6-3667132ad442"><a href="https://lh7-us.googleusercontent.com/EzNw8NvuG5EoYw42Mb4QYI9CLDf-issdRYIGjZAP6K8Dvt5Z66EsQ6ezBLq8R86wcbWw3Zeeqs_MGxhRA_pEgvtPwaZNj-tfKQGSzkxptEVtAUS9Hf8COC7286kaINoN8B09j3XZ7I32iXVD4kDW1M0"><img loading="lazy" src="https://lh7-us.googleusercontent.com/EzNw8NvuG5EoYw42Mb4QYI9CLDf-issdRYIGjZAP6K8Dvt5Z66EsQ6ezBLq8R86wcbWw3Zeeqs_MGxhRA_pEgvtPwaZNj-tfKQGSzkxptEVtAUS9Hf8COC7286kaINoN8B09j3XZ7I32iXVD4kDW1M0" style="width:602px"/></a>
</figure>
<p class="" id="36094983-75df-473d-b87e-ab425f9f0a10">Vasopressin, or
                                                    antidiuretic hormone (ADH), is the primary physiologic inhibitor of
                                                    free water excretion.  This hormone acts on 2 major receptors, V1
                                                    and V2.  Stimulation of the V1 receptor causes vasoconstriction and
                                                    increased prostaglandin release; stimulation of the V2 receptor
                                                    results in an antidiuretic response.  ADH is secreted in response to
                                                    plasma hyperosmolality and, to a lesser extent, depletion of the
                                                    effective circulating volume.  Water deprivation initially increases
                                                    plasma osmolality, resulting in increased ADH secretion.  This
                                                    causes the kidney to produce concentrated urine, which helps to
                                                    counteract the rise in plasma osmolality by reducing urinary free
                                                    water excretion.</p>
<p class="" id="a525c422-b149-4db2-8313-3cd07e610359">The medullary
                                                    portion of the collecting duct is of particular importance in the
                                                    production of maximally concentrated urine as the medullary
                                                    interstitium is the region of highest osmolarity in the kidney.  In
                                                    the setting of high serum ADH levels, a large osmotic gradient
                                                    drives the absorption of free water into the hypertonic medullary
                                                    interstitium.  As water leaves the tubular fluid, urea concentration
                                                    greatly increases.  ADH also increases the number of passive urea
                                                    transporters in the inner medullary collecting duct, allowing a
                                                    substantial fraction of the highly concentrated urea to diffuse down
                                                    its concentration gradient into the medullary interstitium.  When
                                                    ADH levels are high, this urea resorption contributes up to 50% of
                                                    total osmolarity of the medulla, further increasing the
                                                    water-absorbing capacity of the nephron.</p>
<p class="" id="db255405-5d1b-4d7e-891f-960d7d76695b">(Choice A)  ADH
                                                    also increases water absorption in the cortical segment of the
                                                    collecting duct, reducing the amount of free water delivered to the
                                                    medullary collecting duct.  This prevents excess water from being
                                                    absorbed into the medullary interstitium, which would otherwise
                                                    dilute the osmotic gradient and reduce the maximum achievable urine
                                                    concentration.</p>
<p class="" id="a5017314-05f6-43bd-a35d-6427c30a23ee">(Choice B)  The
                                                    early distal tubule is impermeable to both water and urea.</p>
<p class="" id="e2afc91f-7b25-4f11-8ced-39b715d48418">(Choice D)  The
                                                    proximal tubule is permeable to urea and resorbs about half of the
                                                    filtered load.  However, it does not respond to ADH.</p>
<p class="" id="bd5a42b4-3974-4d70-a736-cbc70998b49f">(Choice E)  The
                                                    thin ascending limb of the loop of Henle is permeable to urea, which
                                                    passively diffuses down its concentration gradient into the tubular
                                                    lumen.  Secretion of urea into the thin part of the loop of Henle
                                                    allows urea to recirculate and concentrate in the tubular system,
                                                    further increasing its contribution to the medullary osmotic
                                                    gradient.</p>
<p class="" id="b9a2c3a2-8d01-4585-b188-b205b308b9ae">Educational
                                                    objective:</p>
<p class="" id="cc7b773c-d44d-4d19-a5da-8149dc8d1676">Antidiuretic
                                                    hormone acts on the medullary segment of the collecting duct to
                                                    increase urea and water reabsorption, allowing for the production of
                                                    maximally concentrated urine.</p>
<p class="" id="cddfae39-a70e-4bd0-ab95-491dd58f511f">Physiology</p>
<p class="" id="75957398-0a8a-45fc-8d3e-5ad5aa8f0352">Subject</p>
<p class="" id="4f99f676-7e8e-4e81-b4ae-aaa54ed14962">Renal, Urinary
                                                    Systems &amp; Electrolytes</p>
<p class="" id="a708e7c2-f5eb-4915-a004-2da8b9f07f7f">System</p>
<p class="" id="ff921872-9ff4-4961-ab47-84394eb68fd3">Urinalysis</p>
<p class="" id="59d7aa59-1d74-420a-8fdd-d14e6c020197">Topic</p>
<p class="" id="5d2d93aa-05ac-461b-93d1-5c705e498e9c">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="390214e6-d779-4d5d-bdb5-f0df2e8595c4">‚ú®Done</p>
<p class="" id="53cac4c2-f952-4875-b3c7-32ab7e753ea1">Exhibit Display
                                                </p>
<figure class="image" id="a37f8e42-1a1e-4df1-98f7-1dc63dacdb0b"><a href="https://lh7-us.googleusercontent.com/WqvPoFytqPPP602djuyZmb0wUX_okLhXU_jfWgdVmxibM92fHe0y3O6F0aQfM-AZEfnGeb8tl2CpY_B9jVB3tAdEEqEFm-7BNvBrDk6KxHSm0Sb-VMlNCtCAXxhLvYKeylTlxWtEiGJFJXQgbgpAIwg"><img loading="lazy" src="https://lh7-us.googleusercontent.com/WqvPoFytqPPP602djuyZmb0wUX_okLhXU_jfWgdVmxibM92fHe0y3O6F0aQfM-AZEfnGeb8tl2CpY_B9jVB3tAdEEqEFm-7BNvBrDk6KxHSm0Sb-VMlNCtCAXxhLvYKeylTlxWtEiGJFJXQgbgpAIwg" style="width:560px"/></a>
</figure>
<p class="" id="ae97cdde-d376-4e0c-89c4-527ae848bb78">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="98bbbb80-3c2e-4b8c-a060-43ad0c01f13e">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
