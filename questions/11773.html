
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>11773</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="b344f442-b102-4848-aa6c-c3ede74474cd">A 62-year-old woman comes to
                                        the office for a checkup.  Her husband died 5 months ago in a biking accident,
                                        which she witnessed.  She has little appetite, resulting in weight loss of 3.17
                                        kg (7 lb), and tends to wake up two hours before her alarm clock rings.  The
                                        patient feels overwhelmed at having to manage the household finances, saying,
                                        "My husband always took care of the bills so I wouldn't have to
                                        worry."  She avoids cycling, a hobby she shared with her husband, but
                                        continues to volunteer at a children's hospital.  The patient has no
                                        nightmares or suicidal thoughts.  During the visit, she tears up intermittently
                                        but smiles when sharing a memory of a vacation she took with her husband.  Which
                                        of the following is the best explanation for this patient's condition?</p>
<table class="simple-table" id="b3bd1dd2-af3c-472a-803b-9fa684d4e74c">
<tbody>
<tr id="c1112014-4d9d-4395-8ff8-8c3bc687d709">
<td class="" id="i:ft">A.</td>
<td class="" id="EH&lt;g">Dependent personality disorder</td>
<td class="" id="l\_["></td>
</tr>
<tr id="4a2ccde2-fce4-4b52-8737-fcad8b5f9ba8">
<td class="" id="i:ft">B.</td>
<td class="" id="EH&lt;g">Major depressive disorder</td>
<td class="" id="l\_["></td>
</tr>
<tr id="fb9fdcf4-39b1-4f07-a2c8-1243b7e87187">
<td class="" id="i:ft">C.</td>
<td class="" id="EH&lt;g">Normal grief</td>
<td class="" id="l\_["></td>
</tr>
<tr id="02535ded-8e4c-4177-93e6-2d8db1af09fa">
<td class="" id="i:ft">D.</td>
<td class="" id="EH&lt;g">Persistent complex bereavement disorder</td>
<td class="" id="l\_["></td>
</tr>
<tr id="09044d25-ebdd-41d6-8f36-e4d4847eab7d">
<td class="" id="i:ft">E.</td>
<td class="" id="EH&lt;g">Persistent depressive disorder</td>
<td class="" id="l\_["></td>
</tr>
<tr id="c9423f1f-c628-4d58-ae05-a7aeb76dc8b7">
<td class="" id="i:ft">F.</td>
<td class="" id="EH&lt;g">Post-traumatic stress disorder</td>
<td class="" id="l\_["></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="cd9fc0a9-8e2c-4813-b760-7878f5c33175">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="6bd4492c-a671-4de8-9ef7-dbc558ff0198">
<tbody>
<tr id="be80c8db-0679-4322-a122-20a74c29baf9">
<td class="" id="w?Qk">A.</td>
<td class="" id="MIkI">Dependent personality disorder (1%)
                                                            </td>
<td class="" id="onA="></td>
</tr>
<tr id="3ee1cb7a-542f-41ff-94a1-a96ae5d19422">
<td class="" id="w?Qk">B.</td>
<td class="" id="MIkI">Major depressive disorder (2%)</td>
<td class="" id="onA="></td>
</tr>
<tr id="813b0807-2f96-473a-99b3-09623b26ec59">
<td class="" id="w?Qk">C.</td>
<td class="" id="MIkI">Normal grief (87%)</td>
<td class="" id="onA="></td>
</tr>
<tr id="8058cddb-4949-4d50-aa3a-54f79c290403">
<td class="" id="w?Qk">D.</td>
<td class="" id="MIkI">Persistent complex bereavement
                                                                disorder (4%)</td>
<td class="" id="onA="></td>
</tr>
<tr id="efd26e92-3281-46c9-b52b-12f8c1cdc6fc">
<td class="" id="w?Qk">E.</td>
<td class="" id="MIkI">Persistent depressive disorder (0%)
                                                            </td>
<td class="" id="onA="></td>
</tr>
<tr id="a67a0452-93cf-4630-84a4-36b5710cf075">
<td class="" id="w?Qk">F.</td>
<td class="" id="MIkI">Post-traumatic stress disorder (3%)
                                                            </td>
<td class="" id="onA="></td>
</tr>
</tbody>
</table>
<p class="" id="313f4806-fee2-4e33-b247-3b49053f0906">Correct</p>
<p class="" id="c30e31b0-3b8a-4294-a5b2-5a15d445a162">87%Answered
                                                    correctly</p>
<p class="" id="6c5eec7e-21bf-4c12-9d5c-296a67572bca">32 secsTime Spent
                                                </p>
<p class="" id="2e7046e7-e034-46e1-ba5a-2dd1152b2f2f">2024Version</p>
<ul class="bulleted-list" id="1954b56b-abb2-45bf-aa20-556eabb7fd3d">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="da7126ba-fa38-40ac-8971-3dc68a759df6">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="78780db4-df85-40c0-9ae6-12a75e9a6205">
<tbody>
<tr id="2a93a05c-71fa-410c-bd32-72cbf10ddf70">
<td class="" id="p\PI">Major depressive episode &amp; grief
                                                                reaction</td>
<td class="" id="O[Id"></td>
</tr>
<tr id="43d35afc-29aa-48aa-8be0-cdc67b482022">
<td class="" id="p\PI">Major depressive episode</td>
<td class="" id="O[Id">Grief reaction</td>
</tr>
<tr id="91d1a573-3ed8-4639-8843-46f5d294b066">
<td class="" id="p\PI">‚Ä¢ ‚â•2 weeks; ‚â•5 of 9 symptoms: low
                                                                mood, anhedonia, sleep disturbance, appetite change, low
                                                                energy, psychomotor changes, guilt/worthlessness,
                                                                concentration difficulty, suicidal ideation<br/>‚Ä¢ May
                                                                occur in response to a variety of stressors, including
                                                                loss of a loved one<br/>‚Ä¢ Marked social &amp;
                                                                occupational dysfunction<br/>‚Ä¢ Suicidality related to
                                                                hopelessness &amp; worthlessness<br/></td>
<td class="" id="O[Id">‚Ä¢ Normal reaction to loss
                                                                (bereavement)<br/>‚Ä¢ Sadness more specific to thoughts
                                                                of the deceased <br/>‚Ä¢ "Waves" of grief at
                                                                reminders<br/>‚Ä¢ Self-esteem usually preserved<br/>‚Ä¢
                                                                Functional decline less severe<br/>‚Ä¢ Thoughts of dying
                                                                involve wish to join the deceased; active suicidality
                                                                uncommon<br/>‚Ä¢ Intensity decreases over time<br/></td>
</tr>
</tbody>
</table>
<p class="" id="e3ccd503-0517-4ce1-94b4-b488d729b24c">This
                                                    patient's sadness, insomnia, and decreased appetite are
                                                    consistent with a normal grief reaction precipitated by the loss of
                                                    a loved one (bereavement).  In a normal grief reaction, the sadness
                                                    revolves around feelings of loss and typically occurs in
                                                    "waves" intermixed with positive memories of the
                                                    deceased.  For most, the natural mourning process lasts 6-12 months
                                                    and is followed by the integration of grief, in which the individual
                                                    continues to feel transient but less pronounced sadness, and life
                                                    plans/routines have adapted to living without the deceased.</p>
<p class="" id="30bf13fb-5ebd-492b-938c-fedfa8bb6cf8">Normal grief can
                                                    resemble a major depressive episode as both may include intense
                                                    sadness, rumination about the loss, insomnia, poor appetite, and
                                                    weight loss.  However, this woman's positive memories about her
                                                    husband, ability to continue volunteering, and lack of other
                                                    depressive symptoms (eg, hopelessness, feelings of low self-worth,
                                                    guilt, suicidal ideation) make major depression less likely (Choice
                                                    B).  A major depressive disorder can be diagnosed during a grief
                                                    reaction if a sufficient number and severity of depressive symptoms
                                                    are present.</p>
<p class="" id="b62c9bae-e8ef-43fd-93f0-08f502fb0b70">(Choice A) 
                                                    Dependent personality disorder is diagnosed when there is a lifelong
                                                    pattern of excessive need to be taken care of, leading to
                                                    submissive, clingy behavior and fears of separation.</p>
<p class="" id="30eeb009-ea11-470b-a823-71e1d4191aae">(Choice D) 
                                                    Persistent complex bereavement disorder (also known as complicated
                                                    grief) is characterized by prolonged grief for &gt;12 months,
                                                    difficulty accepting the death, persistent yearning for the
                                                    deceased, and inability to reengage with life.  This patient's
                                                    symptom duration is within the range seen in normal grief and she is
                                                    showing signs of adapting to living without the deceased.</p>
<p class="" id="2d6c4182-77ae-4e99-b171-197ba42c1ea4">(Choice E) 
                                                    Persistent depressive disorder is a chronic depression that persists
                                                    for at least 2 years.</p>
<p class="" id="64f10d69-a348-42b9-bbd8-f6986e241532">(Choice F) 
                                                    Although this patient witnessed her husband's accident and
                                                    avoids cycling, her symptoms are not consistent with post-traumatic
                                                    stress disorder as she is not re-experiencing the event (eg,
                                                    nightmares, flashbacks) or having symptoms of trauma-related
                                                    reactivity (eg, hypervigilance, heightened startle response).</p>
<p class="" id="c57e8a4e-370e-49f2-8d8c-26184ea7b62d">Educational
                                                    objective:</p>
<p class="" id="a5f110ad-62ab-484d-b5b4-eaa4580dee8f">Normal grief
                                                    presents with symptoms similar to those of a major depressive
                                                    episode.  However, in normal grief, pervasive anhedonia,
                                                    worthlessness, and suicidality are not present.</p>
<p class="" id="66629616-e295-44c6-b54b-9917da78b6da">References</p>
<ul class="bulleted-list" id="1583cc8a-c082-455b-bb24-fdfc8f093ba8">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/25135781">Bereavement:
                                                            course, consequences, and care.</a></li>
</ul>
<ul class="bulleted-list" id="9cd4ec85-a212-4773-ae1b-81a784bfe1b1">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/24136623">The
                                                            removal of the bereavement exclusion in the DSM-5: exploring
                                                            the evidence.</a></li>
</ul>
<p class="" id="6a25f775-9680-4f9d-8f36-a8c8e749722f">Behavioral science
                                                </p>
<p class="" id="23f237a8-cdce-4913-965c-4d22b286bfe8">Subject</p>
<p class="" id="08c2af02-67da-4569-9d8e-b2ba755cb758">
                                                    Psychiatric/Behavioral &amp; Substance Use Disorder</p>
<p class="" id="ff143dc4-349d-471d-b956-5d7d34ef07ac">System</p>
<p class="" id="9fca486c-2855-4e5b-b224-9951a1c96fb6">Grief</p>
<p class="" id="88e06df2-a5b9-4df7-b870-4133d745f922">Topic</p>
<p class="" id="d5273543-2e0b-4396-9c7e-8925e996f31f">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
