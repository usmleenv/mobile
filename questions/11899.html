
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>11899</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="ed39452f-7838-4942-bfcb-2fb34b4efde1">An 83-year-old woman is sent
                                        to the emergency department from the nursing home where she resides for
                                        evaluation of mental status changes.  At baseline, she has mild memory
                                        impairment but is otherwise cognitively intact, calm, and cooperative with the
                                        nursing home staff.  Over the past 24 hours, she has become increasingly
                                        combative and agitated and stayed up all night.  Behavioral interventions and
                                        environmental modifications have not been helpful.  The patient's medical
                                        conditions include hypertension and a history of anxiety and depression. 
                                        Temperature is 37.2 C (99 F), blood pressure is 110/80 mm Hg, pulse is 84/min,
                                        and respirations are 18/min.  Neurological examination is normal, but the
                                        patient is unable to attend to the conversation, is mildly disoriented, and
                                        cannot state the days of the week backwards.  Without provocation, she strikes
                                        out at a nurse's aide standing next to her.  Laboratory results are normal
                                        except for urinalysis, which shows an increased presence of white blood cells
                                        and is positive for nitrites.  Head CT scan is negative.  In addition to
                                        starting antibiotic therapy, which of the following medications is most
                                        appropriate to treat this patient's behavioral symptoms?</p>
<table class="simple-table" id="e77d26c2-c986-48c5-91d7-09349bec1091">
<tbody>
<tr id="8564f857-fa53-470c-b6fd-f21dcc683707">
<td class="" id="@wsE">A.</td>
<td class="" id="?ioO">Clozapine</td>
<td class="" id="L@l;"></td>
</tr>
<tr id="249c56fe-299e-4f05-933c-a79b13a1a036">
<td class="" id="@wsE">B.</td>
<td class="" id="?ioO">Doxepin</td>
<td class="" id="L@l;"></td>
</tr>
<tr id="49177b87-01ad-43f9-a2fe-a7b62955de8f">
<td class="" id="@wsE">C.</td>
<td class="" id="?ioO">Haloperidol</td>
<td class="" id="L@l;"></td>
</tr>
<tr id="11c06f46-4b86-4ab9-91aa-bbd673e46f41">
<td class="" id="@wsE">D.</td>
<td class="" id="?ioO">Lithium</td>
<td class="" id="L@l;"></td>
</tr>
<tr id="072acf9c-5e49-43db-a493-ff06744847ed">
<td class="" id="@wsE">E.</td>
<td class="" id="?ioO">Lorazepam</td>
<td class="" id="L@l;"></td>
</tr>
<tr id="384df950-4e13-4edd-9dc1-b09a7e82a4ef">
<td class="" id="@wsE">F.</td>
<td class="" id="?ioO">Temazepam</td>
<td class="" id="L@l;"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="4aab3d35-c7c4-4221-ba96-ac6ef493731c">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="79fe1103-6f94-4bf7-917f-2afb48b971aa">
<tbody>
<tr id="627d4c0d-030f-47a5-8435-a869b6f40a7f">
<td class="" id=";lWZ">A.</td>
<td class="" id="DaWz">Clozapine (9%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
<tr id="a8af3f79-f3c7-45be-9e1b-ad07ab754075">
<td class="" id=";lWZ">B.</td>
<td class="" id="DaWz">Doxepin (5%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
<tr id="50fc5d7a-a689-4ea8-b58d-100b0a972b8e">
<td class="" id=";lWZ">C.</td>
<td class="" id="DaWz">Haloperidol (43%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
<tr id="893da2eb-b357-4b2c-af31-b50a2790198a">
<td class="" id=";lWZ">D.</td>
<td class="" id="DaWz">Lithium (7%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
<tr id="ec259698-3cb5-4387-b614-00489f02ca99">
<td class="" id=";lWZ">E.</td>
<td class="" id="DaWz">Lorazepam (29%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
<tr id="d96e0614-8d04-4902-8bfc-676268a0cbe8">
<td class="" id=";lWZ">F.</td>
<td class="" id="DaWz">Temazepam (3%)</td>
<td class="" id="&gt;G;b"></td>
</tr>
</tbody>
</table>
<p class="" id="79e08795-e266-4393-80cd-f7c46593dd56">Correct</p>
<p class="" id="541349de-db28-4374-923c-cb6ee05c37d0">43%Answered
                                                    correctly</p>
<p class="" id="b5cb4d5c-9a39-4832-9acf-ecef9ea3da7b">16 secsTime Spent
                                                </p>
<p class="" id="23564d89-f189-4ce1-adcb-dbca43977b77">2024Version</p>
<ul class="bulleted-list" id="d96346bf-2a67-4dc9-82ec-9b29e1c7be7a">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="b763bcb9-348a-424d-b972-9cee27ccfd0f">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="e74062ae-8e80-487f-a2ea-fe54f85925cb">Delirium is an
                                                    acute-onset "confusional state" characterized primarily by
                                                    waxing and waning mental status changes and impaired attention. 
                                                    Disorientation, agitation, psychosis, and sleep disturbances may
                                                    also occur.  Delirium occurs secondary to an underlying medical
                                                    condition, such as a urinary tract infection, and therefore the
                                                    primary management is treating the underlying cause.  The elderly
                                                    and those with preexisting cognitive disorders are at a higher risk
                                                    for delirium and may present with varying degrees of agitation.</p>
<p class="" id="0a3431c7-2383-40ea-929b-ba104be2cfcf">High-potency,
                                                    first-generation antipsychotics (eg, haloperidol) and some
                                                    second-generation antipsychotics (eg, quetiapine) can be used for
                                                    the acute treatment of agitation and psychosis associated with
                                                    delirium.  Antipsychotic use is appropriate in the treatment of
                                                    delirium in the elderly if the patient is at risk of acute harm to
                                                    self or others and behavioral interventions have failed.  Under
                                                    these conditions, the benefits of antipsychotics (ie, the provision
                                                    of safety) outweigh the potential risks when used at low doses and
                                                    short durations.</p>
<p class="" id="c2ea0512-484b-4b1a-9f3f-fa8f43e0af75">(Choice A) 
                                                    Clozapine is a second-generation antipsychotic that is reserved for
                                                    patients with treatment-refractory schizophrenia.  It is not used
                                                    for the short-term treatment of agitation in delirium due to the
                                                    risk of agranulocytosis.</p>
<p class="" id="852f3afc-9674-42ae-893a-2e4c6a3393a5">(Choice B) 
                                                    Doxepin is a tricyclic antidepressant with anticholinergic effects
                                                    that can worsen delirium.  It may be used for the treatment of
                                                    insomnia in other settings.</p>
<p class="" id="398639cf-0500-499d-b301-a000d912bd23">(Choice D) 
                                                    Lithium is a mood stabilizer.  It is not used for the short-term
                                                    treatment of behavioral dyscontrol in nonmanic patients.</p>
<p class="" id="1a887023-4d92-4fb4-9144-ce918030f793">(Choices E and F) 
                                                    Benzodiazepines (eg, lorazepam, temazepam) can worsen confusional
                                                    states, particularly in the elderly.  Benzodiazepines are
                                                    appropriate only for the treatment of delirium due to alcohol or
                                                    benzodiazepine withdrawal.</p>
<p class="" id="bc362990-7967-461f-ac24-6de539279c6a">Educational
                                                    objective:</p>
<p class="" id="12325f13-4f93-440c-a086-f5c8440b7db4">Delirium may
                                                    manifest as acute changes in cognition and behavior.  When
                                                    nonpharmacological interventions are ineffective, low-dose
                                                    antipsychotics (eg, haloperidol) are the medications of choice to
                                                    treat the behavioral (eg, severe agitation) and psychotic
                                                    manifestations of delirium.</p>
<p class="" id="915c7783-5d4a-4a65-81d2-c1ff6d683cd6">References</p>
<ul class="bulleted-list" id="b505bb6a-aa12-48d0-8028-dd6ad8736ae9">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/18601302">Delirium
                                                            and its treatment.</a></li>
</ul>
<ul class="bulleted-list" id="11b13d76-6d31-4de7-9f26-a65b50d27775">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/21441282">Atypical
                                                            antipsychotics for the treatment of ICU delirium.</a></li>
</ul>
<p class="" id="c4432dbe-de8a-4c8f-ade9-5f93e3b91ac9">Pharmacology</p>
<p class="" id="6f6a40e5-2a68-4267-9df1-b8c83297a7c4">Subject</p>
<p class="" id="2c735494-2a4e-490f-9652-91a835a718cd">
                                                    Psychiatric/Behavioral &amp; Substance Use Disorder</p>
<p class="" id="77b32239-da61-4878-8aa9-8bef27642193">System</p>
<p class="" id="070080bf-cd7b-41b2-aa1a-c0753740eb74">Delirium</p>
<p class="" id="e84fcd1c-7af1-4a19-adfd-aa099936168e">Topic</p>
<p class="" id="dbb57a81-0268-4819-8750-d0e76bd127c0">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
