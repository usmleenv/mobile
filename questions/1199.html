
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1199</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="67d08159-966f-474d-afe2-dbbe5212d872">A 64-year-old man comes to the
                                        office with 2 months of episodic facial pain.  He describes sudden-onset,
                                        severe, electric shock-like pain over the right cheek and ear lasting several
                                        seconds.  The patient reports that activities like shaving and washing his face
                                        can trigger the pain and it is becoming more frequent.  He is a retired veteran
                                        and has a history of posttraumatic stress disorder.  Physical examination,
                                        including neurologic examination, is normal.  Laboratory studies for blood cell
                                        counts, electrolytes, and hepatic and renal function are normal.  The patient is
                                        started on a single drug therapy.  On a follow-up visit 3 months later, he
                                        reports symptom improvement but is found to have the following blood counts:</p>
<table class="simple-table" id="b271abfe-117d-48e7-8701-b99ea999ab12">
<tbody>
<tr id="5d668647-36d0-4c95-91ac-3f75aa435492">
<td class="" id="YVd=">Hemoglobin</td>
<td class="" id="MhAV">9.0 g/dL</td>
</tr>
<tr id="3e378bcd-d191-4bbe-925c-72f6eb898bc1">
<td class="" id="YVd=">Reticulocytes</td>
<td class="" id="MhAV">0.1%</td>
</tr>
<tr id="7376adf7-4040-49a1-9251-ee9b6118aac0">
<td class="" id="YVd=">Platelets</td>
<td class="" id="MhAV">80,000/mm3</td>
</tr>
<tr id="57bcedb0-03e3-4daa-89da-522519393d0a">
<td class="" id="YVd=">Leukocytes</td>
<td class="" id="MhAV">2,500/mm3</td>
</tr>
</tbody>
</table>
<p class="" id="dd874e8e-4d54-4083-9ffe-e18e61358eb9">Which of the following is the
                                        most likely mechanism of action of the drug used in this patient?</p>
<table class="simple-table" id="2e48a539-932d-4b23-a4c4-7e42643482e5">
<tbody>
<tr id="b80d777b-4f72-42cc-be7d-8471231957fb">
<td class="" id="vbBo">A.</td>
<td class="" id="&gt;{Lu">Blocks NMDA receptors in hippocampal neurons
                                                </td>
<td class="" id="^HTW"></td>
</tr>
<tr id="a55441b5-a664-4d3b-9709-efb00fb81a2c">
<td class="" id="vbBo">B.</td>
<td class="" id="&gt;{Lu">Blocks serotonin reuptake on multiple levels
                                                </td>
<td class="" id="^HTW"></td>
</tr>
<tr id="f4f339a7-21a1-4633-8bf8-849a8b65b522">
<td class="" id="vbBo">C.</td>
<td class="" id="&gt;{Lu">Decreases calcium current in thalamic neurons
                                                </td>
<td class="" id="^HTW"></td>
</tr>
<tr id="6022c7bd-e4b6-4806-86d0-7dbe50b2525a">
<td class="" id="vbBo">D.</td>
<td class="" id="&gt;{Lu">Decreases sodium current on multiple levels
                                                </td>
<td class="" id="^HTW"></td>
</tr>
<tr id="63923a6d-cf00-44d9-85ed-1b2e7d6f4a82">
<td class="" id="vbBo">E.</td>
<td class="" id="&gt;{Lu">Increases chloride current on multiple levels
                                                </td>
<td class="" id="^HTW"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="9ebd6a80-99d8-4657-8358-877e6ab7b515">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="96777dd4-63b0-4771-9e1e-17bef4027ed1">
<tbody>
<tr id="df64283a-20c6-4c8a-accf-5cd674c781b6">
<td class="" id="^`KB">A.</td>
<td class="" id="&lt;xCi">Blocks NMDA receptors in
                                                                hippocampal neurons (5%)</td>
<td class="" id="vjU&lt;"></td>
</tr>
<tr id="eb8e982a-8cd6-4402-b3cb-b9eec1183e67">
<td class="" id="^`KB">B.</td>
<td class="" id="&lt;xCi">Blocks serotonin reuptake on
                                                                multiple levels (8%)</td>
<td class="" id="vjU&lt;"></td>
</tr>
<tr id="d47fe640-b325-49e8-a39d-65b3c9fe0a54">
<td class="" id="^`KB">C.</td>
<td class="" id="&lt;xCi">Decreases calcium current in
                                                                thalamic neurons (10%)</td>
<td class="" id="vjU&lt;"></td>
</tr>
<tr id="ef602107-02ab-4557-bc49-80e213491641">
<td class="" id="^`KB">D.</td>
<td class="" id="&lt;xCi">Decreases sodium current on
                                                                multiple levels (68%)</td>
<td class="" id="vjU&lt;"></td>
</tr>
<tr id="93ce0a55-13d6-417b-a243-5f00f97a0cfa">
<td class="" id="^`KB">E.</td>
<td class="" id="&lt;xCi">Increases chloride current on
                                                                multiple levels (6%)</td>
<td class="" id="vjU&lt;"></td>
</tr>
</tbody>
</table>
<p class="" id="cc39dc1c-e1d4-43aa-93fd-cc52f698cfea">Incorrect</p>
<p class="" id="9b8303f9-2498-44df-b6de-eb4970464ae3">Correct answer D
                                                </p>
<p class="" id="bc0f61dd-19b8-4070-9cdd-d42cfdd4228d">68%Answered
                                                    correctly</p>
<p class="" id="10397d35-b02d-4d88-accd-dfaa3b3ce4d1">20 secsTime Spent
                                                </p>
<p class="" id="cb8e3b60-c073-4594-90a6-1249d8e3e571">2024Version</p>
<ul class="bulleted-list" id="95ad6b55-5984-45ae-ae6f-46b5876e4ad3">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="d981ea13-53e1-45d7-828c-e6ac7aa1b027">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="8d276dd5-c715-413e-8161-f169e58aa0be">This patient has
                                                    trigeminal neuralgia (tic douloureux), a neuropathic disorder that
                                                    typically presents with episodic, severe, unilateral, electric
                                                    shock-like pain in the distribution of CN V.  Symptoms are often
                                                    triggered by innocuous stimuli such as shaving or washing the face. 
                                                    The first-line treatment of trigeminal neuralgia is carbamazepine, a
                                                    medication that inhibits neuronal high-frequency firing by reducing
                                                    the ability of sodium channels to recover from inactivation (ie,
                                                    sodium channel blockade).</p>
<p class="" id="a3daef33-ab27-418d-b5be-c83d3bc1c03c">Carbamazepine may
                                                    cause the following important adverse effects:</p>
<ol class="numbered-list" id="bd32ab92-8d81-427a-b4fd-b24d6ddcd49c" start="1" type="1">
<li>Bone marrow suppression, which may lead to anemia,
                                                        agranulocytosis, and thrombocytopenia (complete blood cell
                                                        counts should be monitored periodically)</li>
</ol>
<ol class="numbered-list" id="ab486950-0d45-42a7-935d-669c617615c4" start="2" type="1">
<li>Hyponatremia, due to increased sensitivity to antidiuretic
                                                        hormone</li>
</ol>
<p class="" id="fd940f9e-e8c7-4913-81d0-eb71f7ef5464">(Choice A) 
                                                    Ketamine, felbamate, and memantine are examples of medications that
                                                    block NMDA receptors.  Ketamine is used as a general anesthetic
                                                    agent, felbamate is an anticonvulsant, and memantine may be
                                                    effective in the treatment of Alzheimer dementia.</p>
<p class="" id="c0abb35c-194b-474c-82db-d843ba0de536">(Choice B) 
                                                    Selective serotonin reuptake inhibitors (eg, fluoxetine, sertraline)
                                                    are typically used to treat depression, anxiety, and posttraumatic
                                                    stress disorder.  Side effects may include headache, worsening
                                                    anxiety/agitation, and insomnia.</p>
<p class="" id="581262f1-fc21-4a17-8f48-5fe72b5f43cb">(Choice C) 
                                                    Ethosuximide blocks T-type Ca2+ channels and decreases calcium
                                                    current in thalamic neurons.  This anticonvulsant is the agent of
                                                    choice for absence seizures.  Major side effects include
                                                    gastrointestinal symptoms and drowsiness.</p>
<p class="" id="5dc55030-cf28-4285-aa93-7c3f99012c62">(Choice E) 
                                                    Various antiseizure medications (eg, benzodiazepines, barbiturates)
                                                    act on the GABA-A receptor to increase chloride conductance;
                                                    however, carbamazepine does not significantly affect chloride
                                                    channels.</p>
<p class="" id="057edb16-be28-4670-866d-63f37c490ec0">Educational
                                                    objective:</p>
<p class="" id="15acbdbf-cac4-4ba4-8919-bf1872a75bd5">The first-line
                                                    treatment for trigeminal neuralgia is carbamazepine, a medication
                                                    that inhibits neuronal high-frequency firing by blocking sodium
                                                    channels.  Carbamazepine can cause bone marrow suppression;
                                                    therefore, complete blood cell counts should be monitored
                                                    periodically.</p>
<p class="" id="054de5e4-8788-401e-aa16-291354a7193c">Pharmacology</p>
<p class="" id="9db13d24-44f0-4ffd-aa70-a59080cb0ae4">Subject</p>
<p class="" id="744d5e58-dc94-4992-b5ce-ac2c4485a526">Nervous System</p>
<p class="" id="15e9f523-9f94-4239-a90e-466d9998a099">System</p>
<p class="" id="758f5d78-91be-4655-b94a-bdba9d1535b6">Trigeminal
                                                    neuralgia</p>
<p class="" id="a8f9b6e9-2995-419b-a54d-0538a6b12e51">Topic</p>
<p class="" id="79ae6ca9-994e-4ad5-aec4-bae6e2454914">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="52929214-5ced-41e8-82d5-9252d891a6b5">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
