
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1360</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="6d81fdcb-474a-41fe-be3d-ade983f5e813">A medical research center is
                                        studying therapeutic options for the treatment of neuromuscular disorders. 
                                        During experimentation, scientists develop a new drug that seems to have partial
                                        agonist/antagonist activity against receptor X.  When the experimental drug is
                                        applied to cells expressing receptor X, there is an immediate change in
                                        transmembrane calcium, sodium, and potassium flow secondary to the opening of
                                        the receptor channel.  Receptor X is most likely which type of receptor?</p>
<table class="simple-table" id="5089e2a4-c688-4242-b87f-033a5cd70abb">
<tbody>
<tr id="35d67067-e8aa-4926-8913-c6f0b74d6263">
<td class="" id="|bCA">A.</td>
<td class="" id="E\kz">Œ±1 adrenoreceptor</td>
<td class="" id="By{:"></td>
</tr>
<tr id="4847625c-53aa-4af1-9815-1a15c1713d13">
<td class="" id="|bCA">B.</td>
<td class="" id="E\kz">Œ≤1 adrenoreceptor</td>
<td class="" id="By{:"></td>
</tr>
<tr id="1486e0d4-125d-4cb7-b3d6-b3531ad380fb">
<td class="" id="|bCA">C.</td>
<td class="" id="E\kz">Œ≤2 adrenoreceptor</td>
<td class="" id="By{:"></td>
</tr>
<tr id="6f8ca8c1-4785-444e-a98d-5379ebb74eb3">
<td class="" id="|bCA">D.</td>
<td class="" id="E\kz">Muscarinic cholinergic receptor</td>
<td class="" id="By{:"></td>
</tr>
<tr id="2b4f701e-c03a-4fcd-99e4-b0808cf11bca">
<td class="" id="|bCA">E.</td>
<td class="" id="E\kz">Nicotinic cholinergic receptor</td>
<td class="" id="By{:"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="ad2ca84f-c049-492a-a314-20b4bc59888a">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="86eb2d40-ec81-452a-aab9-fc19d8afbe4c">
<tbody>
<tr id="d64c1102-fc60-4eda-a52c-be74ce14c21d">
<td class="" id="\~He">A.</td>
<td class="" id="h~]w">Œ±1 adrenoreceptor (5%)</td>
<td class="" id="vQoa"></td>
</tr>
<tr id="fb35d0f2-0a8c-4f1b-a0bf-6259447b5fd7">
<td class="" id="\~He">B.</td>
<td class="" id="h~]w">Œ≤1 adrenoreceptor (13%)</td>
<td class="" id="vQoa"></td>
</tr>
<tr id="eb21cd88-c209-442a-89ca-2951796bab56">
<td class="" id="\~He">C.</td>
<td class="" id="h~]w">Œ≤2 adrenoreceptor (4%)</td>
<td class="" id="vQoa"></td>
</tr>
<tr id="8b21fe27-f1d9-4504-8e37-ad51c72b10d7">
<td class="" id="\~He">D.</td>
<td class="" id="h~]w">Muscarinic cholinergic receptor (19%)
                                                            </td>
<td class="" id="vQoa"></td>
</tr>
<tr id="eb3eb947-91b9-45ef-ad5d-4a8b879f9eaa">
<td class="" id="\~He">E.</td>
<td class="" id="h~]w">Nicotinic cholinergic receptor (56%)
                                                            </td>
<td class="" id="vQoa"></td>
</tr>
</tbody>
</table>
<p class="" id="e6b5f388-49c5-417d-8f02-acdad6ed99ca">Incorrect</p>
<p class="" id="0ea71fdc-ea2e-4c9e-b739-ee75ec3baf77">Correct answer E
                                                </p>
<p class="" id="626f84ae-6958-4684-a031-6d35b3d942fb">56%Answered
                                                    correctly</p>
<p class="" id="34b9f980-9a21-4671-8113-a5dee8953cdc">13 secsTime Spent
                                                </p>
<p class="" id="61b9325e-dab4-4d7f-90d6-e811b08adbb2">2024Version</p>
<ul class="bulleted-list" id="724e2d61-e2d5-4358-abc7-8d3c06316c4c">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="84187537-af77-4086-bf05-bc306c78b209">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="f99b7160-a1b6-4aa1-8c3f-eff132eda0cf">Cell membrane
                                                    receptors can be divided into two broad categories: ionotropic
                                                    receptors  (ion channels that open directly upon ligand binding) and
                                                    metabotropic receptors (these receptors utilize second messengers to
                                                    indirectly influence their corresponding ion channels).  Nicotinic
                                                    cholinergic receptors of the neuromuscular junction are an example
                                                    of a ligand-gated ion channel receptor (ionotropic receptor).  As an
                                                    action potential progresses to the presynaptic terminal,
                                                    voltage-gated calcium channels open and allow entry of calcium into
                                                    the nerve cytoplasm.  This triggers the fusion of storage vesicles
                                                    with the membrane, allowing a release of acetylcholine (ACh).  This
                                                    ACh diffuses across the synaptic cleft and ultimately interacts with
                                                    nicotinic cholinergic receptors present on the motor end-plate. 
                                                    These receptors are ion channels that are comprised of five subunits
                                                    with two ACh binding sites.  If, and only if, both binding sites are
                                                    filled, the ion channel will open.  There is subsequent sodium and
                                                    calcium influx and potassium outflux that results in the generation
                                                    of an end-plate potential.</p>
<p class="" id="209ed51a-b3b4-4e06-924d-0fd7760951a1">Nicotinic
                                                    cholinergic receptors are also found in the CNS and on
                                                    postganglionic neurons of autonomic ganglia.  The description in the
                                                    question stem most likely represents a nicotinic cholinergic
                                                    receptor given the immediate flux of sodium, calcium, and potassium
                                                    demonstrated by the scientists.</p>
<p class="" id="918a947e-fb8c-44a2-8693-5d9394329567">(Choice A) 
                                                    Binding of epinephrine to Œ±1 adrenoceptors results in the activation
                                                    of the inositol triphosphate (IP3) pathway.  This pathway results in
                                                    increased intracellular calcium via release of Ca2+ from storage
                                                    organelles.</p>
<p class="" id="5043f30d-d5e4-41a9-9918-f44c8ef79896">(Choices B &amp;
                                                    C)  Œ≤1 and Œ≤2 adrenoceptors are associated with the cAMP signal
                                                    transduction pathway.  Stimulation of  these receptors causes
                                                    protein kinase A activation.</p>
<p class="" id="bb5c5662-6129-43e0-83c5-e86211c308f3">(Choice D)  M1 and
                                                    M3 muscarinic receptors utilize the inositol triphosphate pathway to
                                                    increase intracellular calcium concentration and activate protein
                                                    kinase C.  M2 muscarinic receptors act via the cAMP second messenger
                                                    system, and when activated decrease intracellular cAMP
                                                    concentrations.</p>
<p class="" id="cf365e62-8e4b-4019-ba87-458c9fbeedca">Educational
                                                    objective:</p>
<p class="" id="f1b5f9da-d239-49c6-bea7-2e5aa66bc120">The autonomic
                                                    nervous system utilizes three types of signal pathways: cAMP, IP3,
                                                    and ion channels.  Nicotinic receptors are ligand-gated ion channels
                                                    that open after binding acetylcholine.  This results in an immediate
                                                    influx of Na+ and Ca2+ into the cell and an outflux of K+ from the
                                                    cell.</p>
<p class="" id="0ae93cb2-83f6-4a09-a369-4f4414ab54e9">References</p>
<ul class="bulleted-list" id="1dc826cd-c7a8-48e1-a897-822d87f39db8">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/17573397">Neuromuscular
                                                            junction in health and disease.</a></li>
</ul>
<p class="" id="2dbe26fa-2cad-48b7-b33e-f6b2b807d950">Pharmacology</p>
<p class="" id="4ea8b7a4-8144-442d-b4c5-2ee0d837a0f7">Subject</p>
<p class="" id="58a159fa-2faa-4901-a648-3dcb5313307d">Nervous System</p>
<p class="" id="66563155-0c2a-4f8f-aa60-b400a79100db">System</p>
<p class="" id="1e555978-d2b5-4c24-bb64-c02c6f4926a5">Autonomic nervous
                                                    system</p>
<p class="" id="1b57200d-23b6-4afb-b26e-c0396e9992d1">Topic</p>
<p class="" id="f35f657d-3880-44fc-b9ea-ea753ec1dc18">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="bb5848ca-3f14-4945-8699-8d3d887f692b">My Notebook</p>
<p class="" id="f1f20a18-40e9-4363-a5db-af9c29da37d4">0</p>
<p class="" id="735542d6-2348-4244-a843-a4f4d9ee0838">Flashcards</p>
<p class="" id="8a826d49-7e7c-49a3-a7ec-d1b521423b8e">Feedback</p>
<p class="" id="4c23dd9e-2088-43a7-9ff9-e200362e2a69">Suspend</p>
<p class="" id="2cac910d-f598-453b-9059-cb301bc4bd7b">End Block</p>
<p class="" id="107026ba-fd91-40f5-8147-ff41d4769b54">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
