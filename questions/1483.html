
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1483</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="c955e5b1-0ddb-4da0-aa89-ec39e8c59330">An autopsy is performed on a
                                        9-month-old boy who died due to refractory seizures.  The patient's family
                                        had recently immigrated to the United States, and he had a history of severe
                                        developmental delay and seizures.  Examination shows microcephaly and skin with
                                        diffuse hypopigmentation.  Further work-up reveals deficiency of a cofactor
                                        required for the formation of neurotransmitters found predominantly in the
                                        substantia nigra and locus caeruleus.  The absence of this cofactor is most
                                        likely to directly affect the function of which of the following enzymes?</p>
<table class="simple-table" id="fcc98494-3632-4f16-a820-d8b24c802918">
<tbody>
<tr id="86c96bc9-ce7b-43f7-9c33-1ba21e60a326">
<td class="" id="jdt=">A.</td>
<td class="" id="?GO|">Branched-chain alpha-ketoacid dehydrogenase</td>
<td class="" id="KVOC"></td>
</tr>
<tr id="e205e963-4a24-4833-9f37-7a93320d7dc3">
<td class="" id="jdt=">B.</td>
<td class="" id="?GO|">Dopamine hydroxylase</td>
<td class="" id="KVOC"></td>
</tr>
<tr id="635fa9eb-05d5-4ad8-904a-7a8b6884f49e">
<td class="" id="jdt=">C.</td>
<td class="" id="?GO|">Homogentisic acid oxidase</td>
<td class="" id="KVOC"></td>
</tr>
<tr id="4b47d623-eb7e-4a6d-ab3e-d075c43c6c3e">
<td class="" id="jdt=">D.</td>
<td class="" id="?GO|">Phenylalanine hydroxylase</td>
<td class="" id="KVOC"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="b609f59d-55ad-4eaf-b2e1-dd11205f8b0f">
<li>
<details>
<summary>Explanation</summary>
<table class="simple-table" id="87305da0-04e0-4f20-97e8-ed66cd3e3117">
<tbody>
<tr id="803279c6-8aca-4130-a784-01bd02d8dbca">
<td class="" id="{qW{">A.</td>
<td class="" id="}HiJ">Branched-chain alpha-ketoacid
                                                                dehydrogenase (7%)</td>
<td class="" id="W~R:"></td>
</tr>
<tr id="a998594a-981e-458d-9f49-8b0654c66974">
<td class="" id="{qW{">B.</td>
<td class="" id="}HiJ">Dopamine hydroxylase (40%)</td>
<td class="" id="W~R:"></td>
</tr>
<tr id="e9a11597-b592-4aff-9eea-ab70ae33a669">
<td class="" id="{qW{">C.</td>
<td class="" id="}HiJ">Homogentisic acid oxidase (5%)</td>
<td class="" id="W~R:"></td>
</tr>
<tr id="2a478f6a-d509-4a54-8aeb-ee2c3605e838">
<td class="" id="{qW{">D.</td>
<td class="" id="}HiJ">Phenylalanine hydroxylase (46%)</td>
<td class="" id="W~R:"></td>
</tr>
</tbody>
</table>
<p class="" id="961dd29e-a6fa-40e3-9949-3fdcfbb0ad61">Incorrect</p>
<p class="" id="801ab033-6b1b-4ad1-bf18-8fa2c8932a1d">Correct answer D
                                                </p>
<p class="" id="7b9b9078-1f80-4d2e-b040-fd24332d1ffa">46%Answered
                                                    correctly</p>
<p class="" id="ac0cf185-d3f6-4051-a6f1-c78868919a94">44 secsTime Spent
                                                </p>
<p class="" id="68a48d39-22bc-4c9e-9c34-b3acb6dd0840">2024Version</p>
<ul class="bulleted-list" id="be7f36a3-1976-4c54-86a5-932dc8a85298">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="1d9b3a5d-ef7c-4fb5-ae87-d00bc3ab1649">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="8fd4ed85-874f-4537-a191-76e97f6fb9a5"><a href="https://lh7-us.googleusercontent.com/PTYHLh4owy8oTXTU3Y3qJgPbgRPrtDxuHUTmL8vH8fWPe49p5kfa0QofhJeDDEeHP_P0i0h3yTLM6FRDRwiNlWt2Z2chIlExdQPihijt3KTad-nhQq-ctm_afWu4spj6QjBnpU7e0ntidm-pG00tLV4"><img loading="lazy" src="https://lh7-us.googleusercontent.com/PTYHLh4owy8oTXTU3Y3qJgPbgRPrtDxuHUTmL8vH8fWPe49p5kfa0QofhJeDDEeHP_P0i0h3yTLM6FRDRwiNlWt2Z2chIlExdQPihijt3KTad-nhQq-ctm_afWu4spj6QjBnpU7e0ntidm-pG00tLV4" style="width:602px"/></a>
</figure>
<p class="" id="8836f9ea-5576-4569-9c29-b46fcaa1d59b">This
                                                    patient's constellation of findings is consistent with impaired
                                                    tetrahydrobiopterin (BH4) synthesis, a disorder affecting
                                                    phenylalanine metabolism.  BH4 is converted from its unreduced form
                                                    (BH2) by dihydropteridine reductase; it is an essential cofactor for
                                                    the following hydroxylase enzymes:</p>
<ul class="bulleted-list" id="b60aea27-9bbf-48c5-918d-d163dca103ba">
<li style="list-style-type:disc">Phenylalanine hydroxylase: This
                                                        enzyme converts phenylalanine to tyrosine, and impaired
                                                        conversion leads to hyperphenylalaninemia; impaired BH4
                                                        synthesis causes the same findings as phenylketonuria. The
                                                        excess phenylalanine causes irreversible neurologic injury
                                                        (microcephaly, developmental delay, seizures) when untreated.
                                                        Elevated phenylalanine is also a competitive inhibitor of
                                                        tyrosinase, an enzyme essential in the production of melanin;
                                                        reduced melanin production explains this patient's
                                                        hypopigmentation.</li>
</ul>
<ul class="bulleted-list" id="785db704-8c98-461f-a19b-8e5dfc4077f0">
<li style="list-style-type:disc">Tyrosine hydroxylase: Impaired
                                                        conversion of tyrosine to L-dopa results in reduced
                                                        catecholamine production because L-dopa is the precursor for
                                                        dopamine (substantia nigra), norepinephrine (locus caeruleus),
                                                        and epinephrine. Impaired neurotransmitter production also leads
                                                        to progressive neurologic findings, including extrapyramidal
                                                        signs (eg, dystonia, truncal hypotonia) and autonomic
                                                        dysfunction.</li>
</ul>
<ul class="bulleted-list" id="cadcca57-912d-4070-9ceb-91d495f81f40">
<li style="list-style-type:disc">Tryptophan hydroxylase: Impaired
                                                        conversion of tryptophan to serotonin results in dysregulation
                                                        of mood, appetite, sleep, and muscle contraction.</li>
</ul>
<p class="" id="ac474c6e-ed61-44ae-bdfa-bcd4f468d8b9">(Choice A) 
                                                    Branched-chain alpha-ketoacid dehydrogenase is a complex of enzymes
                                                    that catalyzes the oxidative decarboxylation of the alpha-ketoacid
                                                    derivatives of the branched-chain amino acids (leucine, isoleucine,
                                                    valine).  Deficiency causes maple syrup urine disease, which can
                                                    affect neurotransmitter (eg, dopamine, serotonin) production and
                                                    cause seizures.  Diffuse hypopigmentation would not be seen.</p>
<p class="" id="6aecb132-2090-42e8-994f-c2ba62ba2d7a">(Choice B) 
                                                    Dopamine hydroxylase synthesizes norepinephrine from dopamine, and
                                                    deficiency causes a rare form of dysautonomia (eg, orthostatic
                                                    hypotension, hypothermia), not microcephaly or hypopigmentation.</p>
<p class="" id="ecf59825-55c8-4c7e-bd20-76f4a1ceffad">(Choice C) 
                                                    Homogentisic acid oxidase catalyzes a step in the degradation of
                                                    tyrosine to fumarate (involved in the tricarboxylic acid cycle). 
                                                    Deficiency causes alkaptonuria, an autosomal recessive disease that
                                                    causes homogentisic acid accumulation; findings include connective
                                                    tissue hyperpigmentation, arthropathy (in adults), and urine that
                                                    darkens after several hours.</p>
<p class="" id="f485b852-08cf-425d-a38d-e7e15325273a">Educational
                                                    objective:</p>
<p class="" id="0c2b65f2-7362-4263-a1c5-8d5262917b9a">
                                                    Tetrahydrobiopterin (BH4) is an essential cofactor for hydroxylase
                                                    enzymes involved in the metabolism of phenylalanine, tyrosine, and
                                                    tryptophan.  Impaired BH4 synthesis causes hyperphenylalaninemia and
                                                    reduced levels of neurotransmitters (eg, dopamine, serotonin),
                                                    causing progressive neurologic findings (developmental delay,
                                                    seizures, microcephaly).</p>
<p class="" id="9f42db9b-07eb-42a3-b090-a346a57761a0">References</p>
<ul class="bulleted-list" id="955c2889-7197-4300-9196-c8438a07712b">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/34017006">Phenylketonuria.</a>
</li>
</ul>
<p class="" id="c88d0036-c78a-4651-a54b-3eb3e60a2970">Biochemistry</p>
<p class="" id="93688c09-22c1-449f-866b-fd77ef6794b9">Subject</p>
<p class="" id="e3732148-7d39-4dd4-9620-07883b57022b">Biochemistry
                                                    (General Principles)</p>
<p class="" id="ec1c9d1c-d0d7-49cf-9d14-140786ef341b">System</p>
<p class="" id="18b40d8f-0ac7-4a57-a904-a92fbac7f818">Phenylketonuria
                                                </p>
<p class="" id="71f7733d-c352-4d1c-bd96-58c40afadc8f">Topic</p>
<p class="" id="58fe0cb8-5698-42e6-8e2d-682d35742e11">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
