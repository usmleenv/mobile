
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1618</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="e1f24bb7-2733-420b-a61c-9427901c2e8d">A researcher is studying the
                                        effect of various manipulations on kidney blood flow and glomerular filtration. 
                                        Which of the following is most likely to both decrease renal plasma flow and
                                        increase the filtration fraction?</p>
<table class="simple-table" id="95a92c85-fd38-4fd4-88fc-7947c39df3e5">
<tbody>
<tr id="d1933b97-d691-4d39-900f-44ebdaa12bde">
<td class="" id="cKmD">A.</td>
<td class="" id="ZRtX">Hyperproteinemia</td>
<td class="" id="YMO&lt;"></td>
</tr>
<tr id="59917b39-89c1-4615-9426-d32fe87cd6f5">
<td class="" id="cKmD">B.</td>
<td class="" id="ZRtX">Bladder neck obstruction</td>
<td class="" id="YMO&lt;"></td>
</tr>
<tr id="8c7776fc-055d-4d28-bbf2-0a7b463328a4">
<td class="" id="cKmD">C.</td>
<td class="" id="ZRtX">Constriction of the efferent arteriole</td>
<td class="" id="YMO&lt;"></td>
</tr>
<tr id="94bef568-3892-457c-b6fc-a22e38deaf11">
<td class="" id="cKmD">D.</td>
<td class="" id="ZRtX">Constriction of the afferent arteriole</td>
<td class="" id="YMO&lt;"></td>
</tr>
<tr id="e3e5550b-c21a-4a7b-b9d4-9ec2128d3a7a">
<td class="" id="cKmD">E.</td>
<td class="" id="ZRtX">Dilation of the efferent arteriole</td>
<td class="" id="YMO&lt;"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="71d431a2-bb9c-4c05-8703-39302315bebd">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="2db990ea-1a5b-4162-a695-a100de16f570">
<tbody>
<tr id="13a04ffa-94cc-4f49-a290-84757af97a3e">
<td class="" id="@M@&lt;">A.</td>
<td class="" id="_P_a">Hyperproteinemia (1%)</td>
<td class="" id="qAV["></td>
</tr>
<tr id="396298ea-5ae7-4bf9-9ff5-3837cf058f3a">
<td class="" id="@M@&lt;">B.</td>
<td class="" id="_P_a">Bladder neck obstruction (1%)</td>
<td class="" id="qAV["></td>
</tr>
<tr id="99622857-67b3-4ab7-83b5-ab1cf04a123d">
<td class="" id="@M@&lt;">C.</td>
<td class="" id="_P_a">Constriction of the efferent
                                                                arteriole (82%)</td>
<td class="" id="qAV["></td>
</tr>
<tr id="e7b852b6-5521-42ab-8e32-77532decfc80">
<td class="" id="@M@&lt;">D.</td>
<td class="" id="_P_a">Constriction of the afferent
                                                                arteriole (11%)</td>
<td class="" id="qAV["></td>
</tr>
<tr id="ac719539-1597-43f8-96e0-68a7c8f7586c">
<td class="" id="@M@&lt;">E.</td>
<td class="" id="_P_a">Dilation of the efferent arteriole
                                                                (2%)</td>
<td class="" id="qAV["></td>
</tr>
</tbody>
</table>
<p class="" id="f2b79c78-01fb-49f8-9338-3d1d4a9c33c7">Correct</p>
<p class="" id="5081c545-1356-42ba-b2d0-bd72a8cefe10">82%Answered
                                                    correctly</p>
<p class="" id="0c76ac15-efe8-400c-a600-1235220c75e8">12 secsTime Spent
                                                </p>
<p class="" id="6b3a9062-e6c4-4bed-8755-2b4437e9a487">2024Version</p>
<ul class="bulleted-list" id="95a3083f-a287-46a9-8881-ec3ee8763caf">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="402a0e34-db4e-47ed-8272-cde1f6c5148b">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="f5fbdec2-3d23-45cd-8354-8b978d9e8548">Constriction of
                                                    the efferent (outgoing) arteriole will impede blood flow through the
                                                    kidney.  This will decrease RPF, but will increase glomerular
                                                    capillary hydrostatic pressure as the fluid "backs up" in
                                                    the glomerulus, increasing hydrostatic pressure.  This increased
                                                    glomerular hydrostatic pressure will cause an increase in the
                                                    filtration fraction.</p>
<p class="" id="df1fd6de-802c-408e-88f3-ea67b0f7b05d">The renal plasma
                                                    flow (RPF) is the volume of plasma that is delivered to the kidney
                                                    per unit time.  The RPF is provided by the renal blood flow, which
                                                    delivers both erythrocytes and plasma to the kidney.  The RPF is
                                                    theoretically calculated by subtracting the amount of erythrocytes
                                                    (hematocrit) from the total renal blood flow.  Clinically, however,
                                                    RPF is generally estimated by calculating the paraaminohippuric acid
                                                    (PAH) clearance.  RPF is linked to the glomerular filtration rate
                                                    (GFR) and the filtration fraction (FF) by the following equation:
                                                </p>
<p class="" id="7ee3e5d3-b14e-47b2-b9de-bd76fdbaa532">FF = GFR / RPF</p>
<p class="" id="35dcc242-5e69-489d-96d2-c58291d7bb61">The filtration
                                                    fraction refers to the proportion of the RPF that is filtered from
                                                    the glomerular capillaries into Bowman's space and is expressed
                                                    as a percentage.  Using the equation above, one can observe that
                                                    increases in GFR or decreases in RPF will increase the FF.  The GFR
                                                    is dependent on hydrostatic and oncotic pressures in the glomerular
                                                    capillaries and Bowman‚Äôs space and can be calculated with the
                                                    following equation:</p>
<p class="" id="366cfb53-b5e0-4e02-a2e3-cf983fcffa14">GFR = Kf ((PG ‚Äì
                                                    PB) ‚Äì (<em>œÄ</em>G ‚Äì <em>œÄ</em>B))</p>
<p class="" id="dd417c2b-0373-4d87-91e4-dad96b159241">Where Kf refers to
                                                    the coefficient of filtration, PG refers to the hydrostatic pressure
                                                    in the glomerular capillaries, PB refers to the hydrostatic pressure
                                                    in Bowman's space, <em>œÄ</em>G refers to the oncotic pressure
                                                    in the glomerular capillaries and <em>œÄ</em>B refers to the oncotic
                                                    pressure in Bowman's space.  Increases in the glomerular
                                                    capillary hydrostatic pressure or the Bowman's space oncotic
                                                    pressure will increase GFR, while increases in capillary oncotic
                                                    pressure or Bowman's space hydrostatic pressure will decrease
                                                    GFR.</p>
<p class="" id="3dd4eb97-c6b1-4402-845d-d3a757ea09a2">(Choice A) 
                                                    Hyperproteinemia causes increased glomerular capillary oncotic
                                                    pressure thereby decreasing GFR.  This will have no effect on the
                                                    RPF, but will cause a decreased FF due to the decreased GFR.</p>
<p class="" id="e20196fe-df9d-4d20-8f9d-fc16c18b496a">(Choice B) 
                                                    Bladder neck obstruction causes an increase in Bowman's space
                                                    hydrostatic pressure thereby decreasing GFR.  This too will have no
                                                    effect on the RPF, but will cause a decreased FF due to the
                                                    decreased GFR.</p>
<p class="" id="71a53f28-6e72-47ed-8308-abc759effd71">(Choice D) 
                                                    Constriction of the afferent (incoming) arteriole causes a decrease
                                                    in glomerular capillary hydrostatic pressure leading to a decreased
                                                    GFR.  RPF is also decreased by this process.  The FF remains
                                                    unchanged due to decreases in both GFR and RPF.</p>
<p class="" id="328ad6f1-1617-4dc6-bece-2a4179ba2b5a">(Choice E) 
                                                    Dilation of the efferent arteriole causes decreased glomerular
                                                    capillary hydrostatic pressure leading to a decrease in GFR.  The
                                                    RPF is increased by this process, and the FF is decreased due to the
                                                    decrease in GFR and increase in RPF.</p>
<p class="" id="18b61395-dd25-4fff-b785-555cf48013bc">Educational
                                                    Objective:</p>
<p class="" id="bd69586d-2c33-4bfb-9b56-6b5d1af8ad9a">Increases in the
                                                    capillary hydrostatic pressure or the Bowman's space oncotic
                                                    pressure will increase GFR, while increases in capillary oncotic
                                                    pressure or Bowman's space hydrostatic pressure will decrease
                                                    GFR.  The filtration fraction (FF) can be calculated by dividing the
                                                    GFR by the renal plasma flow (RPF).  Increases in GFR or decreases
                                                    in RPF will increase the FF.</p>
<p class="" id="a8d64a53-1115-4d57-a3bc-6482d90b4e93">Physiology</p>
<p class="" id="c4b7414f-1ebe-41e4-91cc-2adee651ee18">Subject</p>
<p class="" id="dfca93d0-e75c-4c83-8eb4-369d7f3b0858">Renal, Urinary
                                                    Systems &amp; Electrolytes</p>
<p class="" id="e94ec3a5-8eba-4ad6-8cf6-93d8edba5fe0">System</p>
<p class="" id="132ccfa7-f1ca-4a6e-a8b4-8169594ff681">GFR</p>
<p class="" id="fed0802b-12cd-4db7-ab12-c1cdad4c8627">Topic</p>
<p class="" id="3819cc90-55af-4725-88ac-8416611877c8">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="42c27825-b430-416c-a827-1f18526ba6f2">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }


    


    

    /* Adjust table padding to make room for radio button */
    


    /* Clickable Answer Choices */
    table tr.answer-choice {
        cursor: pointer !important;
        transition: all 0.3s ease !important;
    }

    table tr.answer-choice:hover {
        background: #f8f9fa !important;
    }

    table tr.answer-choice td:first-child {
        position: relative !important;
        padding-left: 35px !important;
    }

    table tr.answer-choice td:first-child::before {
        content: '';
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        border: 2px solid #999;
        border-radius: 50%;
        background: white;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }

    table tr.answer-choice.selected td:first-child::before {
        border-color: #1a73e8;
        border-width: 5px;
    }

    table tr.answer-choice.selected {
        background: #e8f4ff !important;
    }

    table tr.answer-choice.selected td:first-child {
        color: #1a73e8 !important;
        font-weight: 600 !important;
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>





<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Communicate with parent window (if in iframe)
    function notifyParent(choice) {
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'choiceSelected',
                questionId: getQuestionId(),
                choice: choice
            }, '*');
        }
    }

    // Load saved choice from parent or localStorage
    function loadSavedChoice() {
        const questionId = getQuestionId();

        // Try to get from localStorage first
        const saved = localStorage.getItem('choice_q' + questionId);
        if (saved) {
            selectChoice(saved, false);
        }

        // Ask parent for saved choice (if in iframe)
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'getChoice',
                questionId: questionId
            }, '*');
        }
    }

    // Listen for messages from parent
    window.addEventListener('message', function(event) {
        if (event.data.type === 'setChoice' && event.data.questionId === getQuestionId()) {
            selectChoice(event.data.choice, false);
        }
    });

    // Select a choice
    function selectChoice(choice, notify = true) {
        if (!choice) return;

        const questionId = getQuestionId();

        // Remove previous selection
        document.querySelectorAll('tr.answer-choice').forEach(row => {
            row.classList.remove('selected');
        });

        // Add selection to clicked choice
        const choiceRow = document.querySelector(`tr.answer-choice[data-choice="${choice}"]`);
        if (choiceRow) {
            choiceRow.classList.add('selected');

            // Save to localStorage
            localStorage.setItem('choice_q' + questionId, choice);

            // Notify parent (if in iframe)
            if (notify) {
                notifyParent(choice);
            }
        }
    }

    // Initialize answer choices
    function initializeChoices() {
        // Find all answer choice rows (A, B, C, D, E, F, etc.)
        const choicePattern = /^[A-Z]\.$/;
        const tables = document.querySelectorAll('table.simple-table');

        tables.forEach(table => {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell && choicePattern.test(firstCell.textContent.trim())) {
                    const choice = firstCell.textContent.trim().replace('.', '');
                    row.classList.add('answer-choice');
                    row.setAttribute('data-choice', choice);
                    row.style.position = 'relative';

                    // Add click handler
                    row.addEventListener('click', function(e) {
                        // Don't trigger if clicking inside a link or button
                        if (e.target.tagName === 'A' || e.target.closest('a')) return;

                        // Toggle selection
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            const questionId = getQuestionId();
                            localStorage.removeItem('choice_q' + questionId);
                            notifyParent('');
                        } else {
                            selectChoice(choice);
                        }
                    });
                }
            });
        });

        // Load saved choice after a short delay
        setTimeout(loadSavedChoice, 100);
    }

    // Run when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChoices);
    } else {
        initializeChoices();
    }
})();
</script>
