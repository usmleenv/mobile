
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1709</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="cd8fd9c8-879d-4698-9e20-63d80d65c57f">Investigators assessing the
                                        bioavailability of a new drug administer it intravenously (IV) to a volunteer
                                        and measure plasma concentrations of the drug over time.  After the drug is
                                        completely cleared from the volunteer's circulation, the investigators
                                        administer the same dose of the drug orally (PO) and again measure plasma
                                        concentrations of the drug over time.  The data obtained are plotted on the
                                        graph shown below.</p>
<figure class="image" id="33c5f63f-b3aa-4ef0-b515-2ba4eede5ea7"><a href="https://lh7-us.googleusercontent.com/ISYFzHp_79VFea3vXmbUMEqBUtDros4-GHj6CyD_IAa8fmFQz_xdUfPBUTWa1OlVAKSxdaVZfgWKXybwlMgg0XWVU44MWNqWhRsTaJ3neJ8cqQ-j6ehYt-nJ3WcYhWIbtJ9dKxThwLivR0B24vr8J-Y"><img loading="lazy" src="https://lh7-us.googleusercontent.com/ISYFzHp_79VFea3vXmbUMEqBUtDros4-GHj6CyD_IAa8fmFQz_xdUfPBUTWa1OlVAKSxdaVZfgWKXybwlMgg0XWVU44MWNqWhRsTaJ3neJ8cqQ-j6ehYt-nJ3WcYhWIbtJ9dKxThwLivR0B24vr8J-Y" style="width:377px"/></a>
</figure>
<p class="" id="a0da4ef2-5a00-4bf3-a9a7-1bd06a7c6244">Which of the following is the
                                        best determinant of oral bioavailability of this drug?</p>
<table class="simple-table" id="94a89c39-b3a2-4800-b59d-e88730c34dec">
<tbody>
<tr id="62ee561c-2eb1-4f52-a3cb-33f0a584d792">
<td class="" id="h_\[">A.</td>
<td class="" id="VZ|X">Area under the PO curve</td>
<td class="" id="iB}P"></td>
</tr>
<tr id="55d1cc98-fdad-496b-928f-a3e808c459f4">
<td class="" id="h_\[">B.</td>
<td class="" id="VZ|X">Area under the PO curve divided by area under the
                                                    IV curve</td>
<td class="" id="iB}P"></td>
</tr>
<tr id="c399e680-e0d0-41dd-a62c-b56fc4ad6a7f">
<td class="" id="h_\[">C.</td>
<td class="" id="VZ|X">Maximal concentration at the peak of the PO curve
                                                </td>
<td class="" id="iB}P"></td>
</tr>
<tr id="387fc695-b458-47b8-a3c7-22a5944ad30f">
<td class="" id="h_\[">D.</td>
<td class="" id="VZ|X">Maximal concentration at the peak of the PO curve
                                                    divided by maximal concentration at the peak of the IV curve</td>
<td class="" id="iB}P"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="ebc5ee9e-f849-4da0-9cd1-b69c2503e435">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="4c489ca9-e040-4a09-a191-03a46eae58f1">
<tbody>
<tr id="bef96808-8111-4c36-9725-9b1771a2a83c">
<td class="" id="x&lt;~t">A.</td>
<td class="" id="{;MQ">Area under the PO curve (37%)</td>
<td class="" id="YsD|"></td>
</tr>
<tr id="b1f4f1ae-aed5-4e57-bef2-ff3b72b609d6">
<td class="" id="x&lt;~t">B.</td>
<td class="" id="{;MQ">Area under the PO curve divided by
                                                                area under the IV curve (41%)</td>
<td class="" id="YsD|"></td>
</tr>
<tr id="426df54d-9eca-41dc-8994-dc5aa74b22b2">
<td class="" id="x&lt;~t">C.</td>
<td class="" id="{;MQ">Maximal concentration at the peak of
                                                                the PO curve (10%)</td>
<td class="" id="YsD|"></td>
</tr>
<tr id="f5e3aba7-894f-4152-8ddb-58acd2e5e928">
<td class="" id="x&lt;~t">D.</td>
<td class="" id="{;MQ">Maximal concentration at the peak of
                                                                the PO curve divided by maximal concentration at the
                                                                peak of the IV curve (10%)</td>
<td class="" id="YsD|"></td>
</tr>
</tbody>
</table>
<p class="" id="ffa1421f-123b-485a-9449-2507509465a5">Incorrect</p>
<p class="" id="517faa29-8199-4f00-9b7b-5adab7c78d9b">Correct answer B
                                                </p>
<p class="" id="21d6f484-4a26-42d6-ae40-e2d4d35fbf6a">41%Answered
                                                    correctly</p>
<p class="" id="920ebd06-b2ba-4b7c-931e-c0add2dd9e9c">17 secsTime Spent
                                                </p>
<p class="" id="d4bf290e-b26c-45e1-82ca-ab507bcf03eb">2024Version</p>
<ul class="bulleted-list" id="e3887312-a685-4f4f-b11a-4c17a340723e">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="105ad278-7fb9-41ea-acc1-9c9ee094ffe0">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="fa296373-b807-4c9e-b02c-a27864f78bb4"><a href="https://lh7-us.googleusercontent.com/zPMIYRpDTsWij371yfHfs0p9xO_kzcCdGyE_UXgJfXMaWfQ2lJcWwr3ffuVItWLELA7L6N5kcbGH3fkUlut3Naod6yprRuepxvI5R-8iBJgyK_FTxyavTaonY3Uu2LdshPdO4Yo1detY3fgJ1yARzuo"><img loading="lazy" src="https://lh7-us.googleusercontent.com/zPMIYRpDTsWij371yfHfs0p9xO_kzcCdGyE_UXgJfXMaWfQ2lJcWwr3ffuVItWLELA7L6N5kcbGH3fkUlut3Naod6yprRuepxvI5R-8iBJgyK_FTxyavTaonY3Uu2LdshPdO4Yo1detY3fgJ1yARzuo" style="width:377px"/></a>
</figure>
<p class="" id="dcbfafa3-ed28-4237-a809-4e18aeb1142c">Bioavailability
                                                    refers to the fraction of administered drug that reaches the
                                                    systemic circulation and is therefore available for eliciting the
                                                    desired pharmacologic effect.  A drug administered by the
                                                    intravenous (IV) route has 100% bioavailability by definition.  For
                                                    other modes of drug administration (eg, oral [PO], intramuscular
                                                    [IM], subcutaneous [SQ], transdermal [TD], rectal [PR]), the
                                                    bioavailability is usually less than 100%.</p>
<p class="" id="7b1a53e5-f549-4d78-a375-c491e577148e">The
                                                    bioavailability of a drug for a given route of administration can be
                                                    determined by plotting plasma drug concentrations over time for a
                                                    given dose administered by both the IV route and the other route
                                                    being studied (eg, PO).  The area under the curve (AUC) of each plot
                                                    represents the total systemic drug exposure for the given dose and
                                                    route (Choice A).  Bioavailability can then be determined by
                                                    comparing the AUCs of each curve.  In this case, PO bioavailability
                                                    can be calculated by dividing the AUC of the PO curve by the AUC of
                                                    the IV curve.</p>
<p class="" id="9934d969-d88a-4e4a-8fe3-1898361058e6">In the case of PO
                                                    administration, bioavailability depends upon the drug's ability
                                                    to cross the intestinal mucosa and can be influenced by gastric
                                                    acidity and motility, the presence of food or other drugs in the
                                                    gut, and first-pass metabolism by the intestine and liver.</p>
<p class="" id="6289d4fe-fab8-42eb-8850-c653ea92ce10">(Choice C)  The
                                                    maximal concentration at the peak of the PO curve (ie, peak plasma
                                                    level) is dose dependent and is not an indicator of drug
                                                    bioavailability.</p>
<p class="" id="a300a6e9-4fb8-404c-9916-c7bd6bfed699">(Choice D)  PO
                                                    administration of a drug usually results in lower peak serum drug
                                                    levels compared to IV administration, even when PO bioavailability
                                                    is near 100%, due to delayed absorption from the gastrointestinal
                                                    tract (versus near-instantaneous delivery of IV drugs).  As a
                                                    result, comparing peak PO to peak IV concentration levels is not an
                                                    appropriate way to determine bioavailability.</p>
<p class="" id="700f35b5-0606-48ea-a4a1-b94112bcabf2">Educational
                                                    objective:</p>
<p class="" id="86f2f794-b305-4141-9392-7900ee24ace7">Bioavailability
                                                    refers to the fraction of administered drug that reaches the
                                                    systemic circulation.  For a drug administered by any route other
                                                    than intravenous (IV), bioavailability is usually less than 100%. 
                                                    Bioavailability can be determined by graphing plasma drug
                                                    concentrations over time for a given dose administered by both the
                                                    IV route and the other route being studied.  Oral (PO)
                                                    bioavailability is calculated by dividing the area under the PO
                                                    curve by the area under the IV curve.</p>
<p class="" id="da174550-b3b0-4d5a-bdc0-110933c87fd3">Pharmacology</p>
<p class="" id="244c44b7-e51d-4129-80d2-0531a59bae85">Subject</p>
<p class="" id="7ae38b59-4228-4938-b611-c69a09161222">Miscellaneous
                                                    (Multisystem)</p>
<p class="" id="518ab67d-abf1-4b6d-95b6-7dafa72d906d">System</p>
<p class="" id="b3954e0d-6ff3-4f00-adb7-9cac50faefe5">Route of
                                                    administration &amp; bioavailability</p>
<p class="" id="fedf1d40-b7a0-45c4-b63f-baaf9a7ad995">Topic</p>
<p class="" id="799a320b-05a2-4d5b-87a9-43fb07a61883">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
