
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1713</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="96bc4e0e-5aa6-4a26-9fae-425684f8f0f8">A group of investigators is
                                        conducting a phase I clinical trial for a newly developed synthetic opioid. 
                                        After several volunteers ingest a fixed oral dose, the plasma concentrations of
                                        the active drug and its inactive metabolites are measured.  The plasma
                                        concentration of the drug is determined to be subtherapeutic.  After rectal
                                        administration of the same dose of the drug, the peak drug plasma concentration
                                        is almost double the level measured after oral administration.  Which of the
                                        following best accounts for the observed difference in the concentration of the
                                        active drug?</p>
<table class="simple-table" id="f2c50035-0db0-4f30-a1ca-1b3abd593df2">
<tbody>
<tr id="130cc361-0635-426a-8335-d7b3c51ec384">
<td class="" id="SRy|">A.</td>
<td class="" id="TOMF">Decreased drug delivery to the liver</td>
<td class="" id="@LWq"></td>
</tr>
<tr id="f4d2e1de-a89a-4c0b-808b-17a13d59ef2c">
<td class="" id="SRy|">B.</td>
<td class="" id="TOMF">Greater blood flow to the rectum</td>
<td class="" id="@LWq"></td>
</tr>
<tr id="5d24063d-4198-491e-8509-17f39550502a">
<td class="" id="SRy|">C.</td>
<td class="" id="TOMF">Increased rectal absorption rate</td>
<td class="" id="@LWq"></td>
</tr>
<tr id="b47444c7-9535-4cca-8651-adf56f71ccc6">
<td class="" id="SRy|">D.</td>
<td class="" id="TOMF">Larger rectal surface area</td>
<td class="" id="@LWq"></td>
</tr>
<tr id="b520fe4d-a8b7-4991-b30f-098c3f42dab0">
<td class="" id="SRy|">E.</td>
<td class="" id="TOMF">Reduced renal blood flow</td>
<td class="" id="@LWq"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="bcc6d16a-48d3-4d5e-902b-45f27b459ba8">
<li>
<details>
<summary>Explanation</summary>
<table class="simple-table" id="d834632e-82cf-4979-a944-312db2afe19f">
<tbody>
<tr id="4835a820-e719-4774-b1e0-54caa9c99f54">
<td class="" id="~~ks">A.</td>
<td class="" id="wOU:">Decreased drug delivery to the liver
                                                                (68%)</td>
<td class="" id="K_Q`"></td>
</tr>
<tr id="93058065-76b9-486a-a744-3f1ac5cd1512">
<td class="" id="~~ks">B.</td>
<td class="" id="wOU:">Greater blood flow to the rectum (5%)
                                                            </td>
<td class="" id="K_Q`"></td>
</tr>
<tr id="c78723ca-42ac-4c01-8c2f-7c1b2e956ea9">
<td class="" id="~~ks">C.</td>
<td class="" id="wOU:">Increased rectal absorption rate
                                                                (21%)</td>
<td class="" id="K_Q`"></td>
</tr>
<tr id="f60fffe9-3845-4a5c-81a5-e6bdcd7f34a3">
<td class="" id="~~ks">D.</td>
<td class="" id="wOU:">Larger rectal surface area (2%)</td>
<td class="" id="K_Q`"></td>
</tr>
<tr id="b7fdb79a-fa76-4c65-832d-9f4f08257032">
<td class="" id="~~ks">E.</td>
<td class="" id="wOU:">Reduced renal blood flow (1%)</td>
<td class="" id="K_Q`"></td>
</tr>
</tbody>
</table>
<p class="" id="af6a0823-0be6-4237-8b7f-1a28df748cdf">Incorrect</p>
<p class="" id="bd3b907e-d937-4dd6-ba36-d4446cfe2548">Correct answer A
                                                </p>
<p class="" id="1db08e20-4f7d-4f6a-b817-7413681bd334">68%Answered
                                                    correctly</p>
<p class="" id="84444991-5c7e-49d0-a6d6-a131f61d11ac">22 secsTime Spent
                                                </p>
<p class="" id="91879183-6aef-4e24-854c-7d36939889d3">2024Version</p>
<ul class="bulleted-list" id="9133e06b-b019-42b4-9a45-28c7f5996c7a">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="cebf8e23-6ec5-439d-866f-edd8a47fee03">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="f3f205e8-cf68-407e-9a56-cf7a0d84e5e2"><a href="https://lh7-us.googleusercontent.com/s2hVGUpMO-nF7-vPQsB0s2zcM_z9DGPkc2ik-dR23K4ViDZziRIwDpkTOhVDQmaqea1rqO4cSaHccrcnNgOOD9dXLjr14jwBuDld3OG-Pfn17Cd4RbOv7SQYN1boOye1K4W99JHWKZD9dnEy0O4qH_s"><img loading="lazy" src="https://lh7-us.googleusercontent.com/s2hVGUpMO-nF7-vPQsB0s2zcM_z9DGPkc2ik-dR23K4ViDZziRIwDpkTOhVDQmaqea1rqO4cSaHccrcnNgOOD9dXLjr14jwBuDld3OG-Pfn17Cd4RbOv7SQYN1boOye1K4W99JHWKZD9dnEy0O4qH_s" style="width:602px"/></a>
</figure>
<p class="" id="22162826-40c4-43b0-af11-2d1a28464117">Bioavailability is
                                                    the fraction of an administered drug that reaches the systemic
                                                    circulation unchanged.  Oral bioavailability depends on the
                                                    drug's intrinsic ability to be absorbed by the gastrointestinal
                                                    mucosa (eg, poor with vancomycin) and its propensity for
                                                    metabolization by intestinal and hepatic enzymes (first-pass
                                                    metabolism).</p>
<p class="" id="d4be95d9-e086-40d3-b1e1-0b1dd2ebd8e0">When a drug has
                                                    high first-pass metabolism, large amounts of its metabolites (rather
                                                    than the drug itself) enter the systemic circulation.  Drugs that
                                                    are largely inactivated by first-pass metabolism (ie, low oral
                                                    bioavailability) are often administered by a route that bypasses the
                                                    portal circulation (eg, intravenous, sublingual).</p>
<p class="" id="1e86b952-f3b0-4749-8cc2-75fe966eee67">Rectal
                                                    administration (via suppository) allows a drug to partially escape
                                                    first-pass metabolism.  Venous drainage of the anorectum above the
                                                    dentate line is to the portal venous system via the superior rectal
                                                    veins (which drain to the inferior mesenteric vein).  However, the
                                                    region below the dentate line drains into the systemic circulation
                                                    via the middle and inferior rectal veins (which drain to the
                                                    internal iliac and internal pudendal veins, respectively).  For a
                                                    drug that is inactivated by first-pass metabolism, the rectal route
                                                    allows a higher proportion of the drug to bypass portal circulation,
                                                    increasing bioavailability.</p>
<p class="" id="3d917321-cac6-4222-bad6-a1c590b59b5c">(Choices B, C, and
                                                    D)  For orally administered drugs, the small intestine is a major
                                                    site of absorption owing to its large surface area and high blood
                                                    flow rates.  In contrast, the rectum has a much smaller surface
                                                    area, lower blood flow rates, and often contains absorptive stool. 
                                                    Therefore, rectally administered drugs are typically absorbed more
                                                    slowly and erratically compared to orally administered drugs.</p>
<p class="" id="9abd9e23-238e-4a16-9011-337fd9aec2f8">(Choice E) 
                                                    Reduced renal blood flow causes a decrease in the glomerular
                                                    filtration rate (GFR), which in turn slows elimination of renally
                                                    excreted drugs (ie, increases bioavailability).  Patients with
                                                    reduced GFR may require a lower dose to prevent adverse effects. 
                                                    However, the route of administration does not impact drug clearance.
                                                </p>
<p class="" id="eb3e33b5-bd8d-4d4c-a1e5-dd2196469f4c">Educational
                                                    objective:</p>
<p class="" id="bffe8ca6-4744-4dcc-a676-922db705d282">Drugs administered
                                                    orally must pass through the portal circulation and are subject to
                                                    first-pass metabolism by intestinal and hepatic enzymes.  Rectal
                                                    administration is capable of partially bypassing first-pass
                                                    metabolism due to the portion of venous outflow that goes directly
                                                    to the systemic circulation; drugs with extensive first-pass
                                                    metabolism have increased bioavailability when administered
                                                    rectally.</p>
<p class="" id="1d90a91d-4177-4581-89db-47b9606f1901">Pharmacology</p>
<p class="" id="78ce6d80-9804-44a3-bbfb-471c004035f9">Subject</p>
<p class="" id="e41d060f-a04b-4fe0-8e95-eb180996518c">Pharmacology
                                                    (General Principles)</p>
<p class="" id="24c6de1e-76df-4a79-bfe2-b4853220edd6">System</p>
<p class="" id="38a0c4f8-bb59-4303-b3f7-54643cf00bf0">Route of
                                                    administration &amp; bioavailability</p>
<p class="" id="7d66467c-f582-4215-806a-1b1670fba209">Topic</p>
<p class="" id="69623bbc-2a15-4a7e-a45d-5ea7b529567a">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
