
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>18783</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="69baa14c-283e-449e-8e3b-ed1057a83562">A 33-year-old man comes to the
                                        office due to back pain.  He has a 2-week history of moderate pain in the lumbar
                                        area that started after a long day of yard work.  There is no associated fever,
                                        motor weakness, or urinary symptoms.  The patient has no history of acute trauma
                                        and medical history is unremarkable.  Examination shows normal lower extremity
                                        strength, sensation, and reflexes.  Straight-leg raising test is negative.  The
                                        patient says, "My brother had similar pain last year and his MRI scan
                                        showed a bulging disc.  Can you order that test for me?"  The clinician
                                        offers options for symptomatic relief but recommends against performing any
                                        imaging studies.  Which of the following is the most likely effect of this
                                        recommendation?</p>
<table class="simple-table" id="dfefc056-ff61-4e23-b31d-874a75431b0b">
<tbody>
<tr id="a8cc14fd-032d-409f-8f47-73d222d815ea">
<td class="" id="gIf=">A.</td>
<td class="" id="CqQg">Increased diagnostic uncertainty</td>
<td class="" id="CkrS"></td>
</tr>
<tr id="575c7fc0-54ec-4acd-b0eb-dadeafa4452d">
<td class="" id="gIf=">B.</td>
<td class="" id="CqQg">Increased fragmentation of care</td>
<td class="" id="CkrS"></td>
</tr>
<tr id="87e0b275-68b3-4c54-b564-7d98bcd0afa6">
<td class="" id="gIf=">C.</td>
<td class="" id="CqQg">Increased health care disparity</td>
<td class="" id="CkrS"></td>
</tr>
<tr id="4836eee4-b8be-4fd7-8178-482b73353271">
<td class="" id="gIf=">D.</td>
<td class="" id="CqQg">Increased malpractice risk</td>
<td class="" id="CkrS"></td>
</tr>
<tr id="3989bb6b-919d-4f84-924f-dcda4cdcf192">
<td class="" id="gIf=">E.</td>
<td class="" id="CqQg">Reduced clinical standardization</td>
<td class="" id="CkrS"></td>
</tr>
<tr id="119d3b9a-ff9e-48dc-bed3-b6a8dc477ac7">
<td class="" id="gIf=">F.</td>
<td class="" id="CqQg">Reduced overutilization</td>
<td class="" id="CkrS"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="4caaeba7-38dc-4098-b91a-77567d491ff8">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="d109a011-7674-4149-be87-12cf88bb0b0a">
<tbody>
<tr id="54cb22bf-a4cd-4c2f-8454-4d25c57655b7">
<td class="" id="Dqxw">A.</td>
<td class="" id="@fZ;">Increased diagnostic uncertainty (7%)
                                                            </td>
<td class="" id="`p{o"></td>
</tr>
<tr id="3fcdb01d-af73-4a13-853c-040a66c259cb">
<td class="" id="Dqxw">B.</td>
<td class="" id="@fZ;">Increased fragmentation of care (2%)
                                                            </td>
<td class="" id="`p{o"></td>
</tr>
<tr id="1105f4c2-2707-4276-977e-62285c67bc6c">
<td class="" id="Dqxw">C.</td>
<td class="" id="@fZ;">Increased health care disparity (2%)
                                                            </td>
<td class="" id="`p{o"></td>
</tr>
<tr id="3f64c996-ccd5-47ad-b61b-ed21592bdc54">
<td class="" id="Dqxw">D.</td>
<td class="" id="@fZ;">Increased malpractice risk (2%)</td>
<td class="" id="`p{o"></td>
</tr>
<tr id="b07ca302-4458-4dfc-82f3-79666fad8983">
<td class="" id="Dqxw">E.</td>
<td class="" id="@fZ;">Reduced clinical standardization (3%)
                                                            </td>
<td class="" id="`p{o"></td>
</tr>
<tr id="d26b64df-4969-40de-8921-d6631f3c75dd">
<td class="" id="Dqxw">F.</td>
<td class="" id="@fZ;">Reduced overutilization (80%)</td>
<td class="" id="`p{o"></td>
</tr>
</tbody>
</table>
<p class="" id="b41d6424-e80f-4931-a0e7-d2cbb80de53f">Incorrect</p>
<p class="" id="2772345a-97f6-4601-8396-881ade65e793">Correct answer F
                                                </p>
<p class="" id="bad283b9-23b3-4ed0-856b-24cff9275025">80%Answered
                                                    correctly</p>
<p class="" id="093ee76f-2cc3-40c2-9c3f-fe427189e979">12 secsTime Spent
                                                </p>
<p class="" id="d48da689-d1d8-483a-8a12-7349902059ba">2024Version</p>
<ul class="bulleted-list" id="4117a49e-072f-4faa-9a67-8510b431677e">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="c5ad3cd7-a738-46e8-8664-1e9664cab7f0">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="99fb877a-a604-445a-b119-c17196533cad">
<tbody>
<tr id="87d2b751-5fd8-4930-8c44-3d330b51a244">
<td class="" id="bYbN">Overutilization</td>
<td class="" id="yIzv"></td>
</tr>
<tr id="2a1954a9-d455-40e6-a769-aaabb8c7c83a">
<td class="" id="bYbN">Definition</td>
<td class="" id="yIzv">Services (tests or treatments)
                                                                that:<br/>‚Ä¢ Are not reasonably expected to benefit the
                                                                patient<br/>‚Ä¢ Are not necessary for clinical
                                                                decision-making<br/></td>
</tr>
<tr id="bf5008a8-f76d-42c5-9c2c-529c2247b81d">
<td class="" id="bYbN">Strategies to reduce overutilization
                                                            </td>
<td class="" id="yIzv">‚Ä¢ Determine how a test will affect
                                                                management before ordering<br/>‚Ä¢ Use evidence-based
                                                                practice guidelines that emphasize services with proven
                                                                benefit<br/>‚Ä¢ Avoid redundant tests &amp;
                                                                treatment<br/></td>
</tr>
</tbody>
</table>
<p class="" id="f5138829-ebaa-4aac-9b66-7055a0eb5bfe">This patient has
                                                    acute, uncomplicated low back pain (LBP) with no
                                                    "red-flag" features (eg, fever, neurologic deficits) to
                                                    suggest a serious cause.  Uncomplicated LBP usually resolves
                                                    spontaneously, and management is directed toward providing temporary
                                                    symptomatic relief.  Imaging (eg, x-ray, MRI scan) is generally not
                                                    recommended because it does not improve outcomes or provide
                                                    necessary information for optimal management.</p>
<p class="" id="b4d4b582-7f32-49be-966d-318538206dd8">Overutilization
                                                    refers to provision of unnecessary services that are not expected to
                                                    improve patient outcomes or meaningfully change management. 
                                                    Patient‚Äìcentered health care requires care to be delivered with
                                                    respect to the patients' concerns, preferences, and priorities,
                                                    but does not require unnecessary testing or treatment if patient
                                                    input is otherwise solicited and respected when appropriate.  MRI in
                                                    uncomplicated LBP increases overutilization and is therefore not
                                                    recommended for this patient.</p>
<p class="" id="c8b9b2a2-818b-41b8-8f89-75265dd999b7">(Choice A)  Spinal
                                                    MRI often identifies nonspecific abnormalities (eg, bulging
                                                    intervertebral discs) that are not relevant to management but can
                                                    lead to further unnecessary and potentially harmful diagnostic
                                                    studies and interventions.  Because of the frequency of such
                                                    abnormalities, even in asymptomatic individuals, it is often not
                                                    clear whether they are the actual cause of pain or merely an
                                                    incidental finding.  Deferring imaging therefore decreases, rather
                                                    than increases, diagnostic uncertainty.</p>
<p class="" id="35cfd7cb-0015-47c0-8c5d-df254c94973a">(Choice B) 
                                                    Fragmentation of health care refers to breaking up care across
                                                    multiple providers and facilities without adequate cross
                                                    communication.  Declining to order unnecessary tests does not lead
                                                    to fragmentation.</p>
<p class="" id="bf838b30-a3b7-4975-869d-5b67241a9722">(Choice C)  Health
                                                    care disparity refers to differences in access to care or outcomes
                                                    due to socioeconomic or demographic factors.  Careful and
                                                    appropriate use of diagnostic studies does not increase disparity.
                                                </p>
<p class="" id="118494ce-2689-43d0-b210-561e128e46db">(Choice D) 
                                                    Malpractice liability risk correlates most closely with
                                                    provider-patient communication and perceived level of concern. 
                                                    Appropriate use of diagnostic studies, especially as it conforms to
                                                    evidence-based guidelines, does not increase malpractice risk.</p>
<p class="" id="43d783b0-7474-4da3-8c36-8b44b8792214">(Choice E) 
                                                    Clinical standardization refers to consistency of management
                                                    decisions within and across provider groups.  Care that conforms to
                                                    established guidelines increases, not decreases, standardization.
                                                </p>
<p class="" id="577261eb-25e0-4157-b939-234337291db2">Educational
                                                    objective:</p>
<p class="" id="9078bfa2-c42b-4e3f-904f-5ef7f03967d6">Overutilization
                                                    refers to provision of services that are not expected to improve
                                                    patient outcomes or meaningfully change management. 
                                                    Patient‚Äìcentered health care requires care to be delivered with
                                                    respect to patients' concerns, preferences, and priorities, but
                                                    does not require unnecessary testing or treatment if patient input
                                                    is otherwise solicited and respected when appropriate.</p>
<p class="" id="3d4811c5-20c8-4629-aadd-b161e24a3732">References</p>
<ul class="bulleted-list" id="1e4de8f2-6396-4be4-9ec1-a0cebd1f2668">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/30096052">Managing
                                                            inappropriate utilization of laboratory resources.</a></li>
</ul>
<ul class="bulleted-list" id="985d17d5-2379-4de6-8991-c85fc9e15ce8">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/30252425">Mechanical
                                                            low back pain.</a></li>
</ul>
<p class="" id="cb690b18-b43b-4665-8de7-98b245b9dcb1">Behavioral science
                                                </p>
<p class="" id="14a16422-7fdc-4bff-bd87-28e0acd2d510">Subject</p>
<p class="" id="a5ad4cdd-c0b2-4f37-8eda-ae3e658eeb86">Social Sciences
                                                    (Ethics/Legal/Professional)</p>
<p class="" id="2060ade3-de33-487f-813c-eeed42d36230">System</p>
<p class="" id="3977acfc-95f0-4eeb-86c9-087cae7cb28b">Physician patient
                                                    communication</p>
<p class="" id="747005a9-1a89-48a8-8318-bf2a238338df">Topic</p>
<p class="" id="0f4190fc-3ba0-479f-ad77-7091511945f2">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
