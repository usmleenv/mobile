
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>19044</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="2ea1d885-a349-4b12-85c8-32333e09c8b9">A 60-year-old man comes to the
                                        office for surgical consultation of multivessel coronary artery disease.  After
                                        reviewing prior records and completing a thorough evaluation, the surgeon
                                        discusses the recommendation for a coronary artery bypass graft, describing its
                                        indications and providing an overview of the surgery, including risks and
                                        benefits of the operation.  The surgeon then discusses what the patient can
                                        expect during the recovery period.  Which of the following additional
                                        disclosures is a necessary component of an informed consent discussion by the
                                        surgeon?</p>
<table class="simple-table" id="49d17622-7824-4eec-9e91-edabed18939b">
<tbody>
<tr id="d75acb53-5a0b-4f99-b18e-d91eafe8161f">
<td class="" id="&gt;nP&lt;">A.</td>
<td class="" id="AUcb">Cost of surgery and estimated coverage by
                                                    insurance</td>
<td class="" id="snPa"></td>
</tr>
<tr id="b92f6d44-ff88-44aa-ac06-7b7d28146740">
<td class="" id="&gt;nP&lt;">B.</td>
<td class="" id="AUcb">Mortality rate of coronary artery bypass grafts
                                                    performed by the surgeon</td>
<td class="" id="snPa"></td>
</tr>
<tr id="71ce0459-b565-4e7d-8e1c-b2f437ebde5b">
<td class="" id="&gt;nP&lt;">C.</td>
<td class="" id="AUcb">Option for patient to obtain a second opinion
                                                </td>
<td class="" id="snPa"></td>
</tr>
<tr id="7bbfb8b3-c8da-44e6-a9e6-8b297206cec3">
<td class="" id="&gt;nP&lt;">D.</td>
<td class="" id="AUcb">Probable outcomes if surgery is not performed
                                                </td>
<td class="" id="snPa"></td>
</tr>
<tr id="8dd40d8d-033a-42a6-99e9-41e837ccbfe8">
<td class="" id="&gt;nP&lt;">E.</td>
<td class="" id="AUcb">Risks of anesthetic agents that will be used
                                                    during the procedure</td>
<td class="" id="snPa"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="868a6d07-1bb7-418f-84f1-b11fca924f10">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="465f9b8b-ecee-4634-aa35-cb0d206abcb9">
<tbody>
<tr id="5c8ebfb0-dcc3-461a-bae6-c618a1a6bf43">
<td class="" id="YBMi">A.</td>
<td class="" id="fW?A">Cost of surgery and estimated
                                                                coverage by insurance (7%)</td>
<td class="" id="=&lt;ov"></td>
</tr>
<tr id="f4408cf7-c6d4-452a-ac2d-c384a33d3f46">
<td class="" id="YBMi">B.</td>
<td class="" id="fW?A">Mortality rate of coronary artery
                                                                bypass grafts performed by the surgeon (7%)</td>
<td class="" id="=&lt;ov"></td>
</tr>
<tr id="d805c5b1-9724-4441-a2bf-0cddd0b9d280">
<td class="" id="YBMi">C.</td>
<td class="" id="fW?A">Option for patient to obtain a second
                                                                opinion (10%)</td>
<td class="" id="=&lt;ov"></td>
</tr>
<tr id="915b0aac-c939-4285-955e-39813503736f">
<td class="" id="YBMi">D.</td>
<td class="" id="fW?A">Probable outcomes if surgery is not
                                                                performed (54%)</td>
<td class="" id="=&lt;ov"></td>
</tr>
<tr id="fe27ac2f-ddef-48c7-b666-205a05d4a6e2">
<td class="" id="YBMi">E.</td>
<td class="" id="fW?A">Risks of anesthetic agents that will
                                                                be used during the procedure (20%)</td>
<td class="" id="=&lt;ov"></td>
</tr>
</tbody>
</table>
<p class="" id="4b1dbc54-7d42-419b-a9a7-e5928a3ea4f8">Incorrect</p>
<p class="" id="836f4977-a023-4b68-8a09-cf22022e38ff">Correct answer D
                                                </p>
<p class="" id="17d80618-bc9c-4b97-8872-99ee87fa46b9">54%Answered
                                                    correctly</p>
<p class="" id="a6d39a9b-4708-470a-8989-1e1d8a2b19ca">16 secsTime Spent
                                                </p>
<p class="" id="b0b877bd-e1a6-4821-9481-732c6cd5bcdb">2024Version</p>
<ul class="bulleted-list" id="c8a3bdec-5a27-4727-bd64-5f77b8ce5693">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="15607b41-7cf5-4011-ba53-1609cf69bf66">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="59cfdb16-b851-4376-8b17-fc582c7b4859">
<tbody>
<tr id="3e7a8b15-6be0-4aca-80fc-c776033a48ab">
<td class="" id="RZp@">Elements of informed consent</td>
<td class="" id="I:|{"></td>
</tr>
<tr id="e6c0fc1e-1e76-42ad-aa1a-1a1a004a0ab8">
<td class="" id="RZp@">Preconditions</td>
<td class="" id="I:|{">‚Ä¢ Competency<br/>‚Ä¢
                                                                Voluntariness<br/></td>
</tr>
<tr id="1811d1fa-28d8-4526-ab3c-696d5ec5fe59">
<td class="" id="RZp@">Disclosure of key facts</td>
<td class="" id="I:|{">‚Ä¢ Diagnosis<br/>‚Ä¢ Proposed treatment
                                                                or procedure<br/>‚Ä¢ Alternate treatment options
                                                                (medical, surgical)<br/>‚Ä¢ Risks/benefits of proposed
                                                                treatment &amp; alternatives<br/> ‚ó¶ Common
                                                                complications<br/> ‚ó¶ Rare but major
                                                                complications<br/>‚Ä¢ Risks of refusing treatment<br/>
</td>
</tr>
<tr id="2e959a18-4353-4ad5-9b6d-489f59bc1acf">
<td class="" id="RZp@">Other disclosures if applicable</td>
<td class="" id="I:|{">‚Ä¢ Role of residents &amp; medical
                                                                students<br/>‚Ä¢ Anticipated additional procedures<br/>‚Ä¢
                                                                Financial conflicts<br/></td>
</tr>
</tbody>
</table>
<p class="" id="aaa5b446-b786-498a-9150-b0562ea94e5b">The process of
                                                    informed consent requires disclosure of key information so that the
                                                    patient can make an informed medical decision.  The essential
                                                    components of an informed consent discussion include explanation of
                                                    the patient's diagnosis and proposed treatment, other treatment
                                                    options, risks and benefits of the proposed treatment, and risks of
                                                    refusing the proposed treatment.  In this case, the surgeon has not
                                                    yet addressed the risks to the patient if the surgery is not
                                                    performed (eg, increased risk of subsequent cardiovascular events).
                                                </p>
<p class="" id="d5e24f3d-fe70-4e6f-8bf8-8c6a20d8a6a2">The informed
                                                    consent discussion should be conducted by the surgeon who will
                                                    perform the procedure and should use language that is easily
                                                    comprehended.  The patient must be given an opportunity to ask
                                                    questions.  The content of the informed consent discussion should be
                                                    documented in the patient's medical record.</p>
<p class="" id="011f8f40-1811-4068-91bd-e911cbf92f61">(Choice A) 
                                                    Information regarding cost is not a required component of informed
                                                    consent.  This information likely depends on the patient's
                                                    insurance plan and is not a question the physician can accurately
                                                    answer.</p>
<p class="" id="8758bc62-33fa-4446-9fed-d92c1a2a8705">(Choice B) 
                                                    Disclosure of the mortality rate of a procedure performed by the
                                                    surgeon is not a required element of informed consent.  However, if
                                                    asked, a physician must answer truthfully and disclose this
                                                    information.</p>
<p class="" id="9f953ced-9799-478b-947b-1056b6755778">(Choice C) 
                                                    Although all patients have the right to a second opinion, explicitly
                                                    stating this option is not a requirement of the informed consent
                                                    process.</p>
<p class="" id="7cd4db65-4642-4b22-bee6-d3058ba6e564">(Choice E) 
                                                    Discussing the risks of specific anesthetic agents is outside the
                                                    surgeon's scope of practice.  This should be discussed during
                                                    the informed consent process with the anesthesiologist, which is
                                                    typically conducted as part of the preanesthesia evaluation.</p>
<p class="" id="3e0f88e5-6348-4e97-9a56-ca22d1f53f6f">Educational
                                                    objective:</p>
<p class="" id="d8910177-6834-4854-a6e1-29f7b06630d6">The essential
                                                    components of informed consent include explanation of the
                                                    patient's diagnosis and proposed treatment, other treatment
                                                    options, the risks and benefits of the proposed treatment, and the
                                                    risks of refusing the proposed treatment.</p>
<p class="" id="0f42edc4-c7f3-4720-ad3d-ff98771b2a49">References</p>
<ul class="bulleted-list" id="dd5852e7-f31f-4323-abcc-094e9f91db15">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/28234594">Informed
                                                            consent for surgery: risk discussion and documentation.</a>
</li>
</ul>
<p class="" id="cee28bd4-a9f8-40ff-b9eb-77df0a85cb02">Behavioral science
                                                </p>
<p class="" id="2b2da5c5-536f-4c54-8adc-c30b9e5c6b77">Subject</p>
<p class="" id="dbc4d269-69b4-4602-af86-651e25f841d6">Social Sciences
                                                    (Ethics/Legal/Professional)</p>
<p class="" id="a8969627-c952-4282-bc2d-87f75b0fb2e6">System</p>
<p class="" id="79dd08e9-8804-4cf0-bc4e-9dacc0518021">Informed consent
                                                </p>
<p class="" id="08a9b8f7-e24e-47a0-aa6a-f93fb04c5359">Topic</p>
<p class="" id="cb2a7087-1fcb-4942-a17f-26acf81022d4">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
