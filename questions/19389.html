
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>19389</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="ac7ae6a6-f398-4a12-8f1d-ae86d222185b">A 31-year-old woman, gravida 2
                                        para 1, at 30 weeks gestation comes to the emergency department due to increased
                                        swelling in her face and lower extremities.  She has noticed a sudden onset of
                                        swelling and a 2.72-kg (6-lb) weight gain in the last day.  The patient has not
                                        urinated in the last 12 hours despite an increase in fluid intake.  She has a
                                        twin pregnancy and no chronic medical conditions.  Blood pressure is 154/98 mm
                                        Hg, and pulse is 98/min.  Bladder catheterization yields a total of 10 mL of
                                        dark urine.  Urinalysis shows no red blood cells.  Which of the following
                                        pathologic factors is the most likely cause of this patient's decreased
                                        urine output?</p>
<table class="simple-table" id="c10f104f-701b-4e6d-990e-9984fc7204eb">
<tbody>
<tr id="56beeb9a-6759-4529-b742-bce3605df92b">
<td class="" id="D@nQ">A.</td>
<td class="" id="SFrI">Inflammation of the glomeruli</td>
<td class="" id="=x:w"></td>
</tr>
<tr id="3e904766-35a9-4b98-a2cf-c26758664c4f">
<td class="" id="D@nQ">B.</td>
<td class="" id="SFrI">Immune complex deposition within glomeruli</td>
<td class="" id="=x:w"></td>
</tr>
<tr id="ce52407b-2e4a-4c18-8841-34c8ae47a464">
<td class="" id="D@nQ">C.</td>
<td class="" id="SFrI">Inflammation of the renal interstitium</td>
<td class="" id="=x:w"></td>
</tr>
<tr id="ac37019a-73a4-4931-a979-f0b6e563d4ee">
<td class="" id="D@nQ">D.</td>
<td class="" id="SFrI">Obstructing stone within the renal calyx</td>
<td class="" id="=x:w"></td>
</tr>
<tr id="407968ec-ecce-4e47-bca3-310e11049999">
<td class="" id="D@nQ">E.</td>
<td class="" id="SFrI">Vasospasm of the intrarenal arteries</td>
<td class="" id="=x:w"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="aae93065-74ea-449b-b208-cb5a7edb6845">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="307b17da-1e31-4a3b-abe2-b2212bb8af4a">
<tbody>
<tr id="3b8d9962-6e29-42eb-8416-249fbc7a6bc0">
<td class="" id="tU?Y">A.</td>
<td class="" id="jUFI">Inflammation of the glomeruli (11%)
                                                            </td>
<td class="" id="YAFR"></td>
</tr>
<tr id="d82f6d60-38f6-41b2-88b4-fda7b621e7c4">
<td class="" id="tU?Y">B.</td>
<td class="" id="jUFI">Immune complex deposition within
                                                                glomeruli (12%)</td>
<td class="" id="YAFR"></td>
</tr>
<tr id="4b077e99-84e2-4b15-8b5e-be733f260337">
<td class="" id="tU?Y">C.</td>
<td class="" id="jUFI">Inflammation of the renal
                                                                interstitium (10%)</td>
<td class="" id="YAFR"></td>
</tr>
<tr id="d4ebb8d2-4e53-49ff-b88e-4ce5d4b9f75c">
<td class="" id="tU?Y">D.</td>
<td class="" id="jUFI">Obstructing stone within the renal
                                                                calyx (12%)</td>
<td class="" id="YAFR"></td>
</tr>
<tr id="a3147cf1-2606-4774-b4cf-b494b423680c">
<td class="" id="tU?Y">E.</td>
<td class="" id="jUFI">Vasospasm of the intrarenal arteries
                                                                (53%)</td>
<td class="" id="YAFR"></td>
</tr>
</tbody>
</table>
<p class="" id="415ed35c-4270-44d2-b827-6e72101f29d0">Incorrect</p>
<p class="" id="01d03806-8f7b-4d10-8d9c-e75cc6c9ea0b">Correct answer E
                                                </p>
<p class="" id="fe268fdf-779d-4880-8d88-435ec58a3830">53%Answered
                                                    correctly</p>
<p class="" id="5f0d6724-14a3-426b-80ef-ce4cc06a2aaa">12 secsTime Spent
                                                </p>
<p class="" id="411432ad-e0d0-42cf-bdbc-05056083798b">2024Version</p>
<ul class="bulleted-list" id="4cb4cd7c-3861-42ce-bb2d-ea6f71fa9c51">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="22d7ad84-432f-4408-8149-9a52f235cb45">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="79f5f3a6-0a84-4da6-84ba-7af4f736479b"><a href="https://lh7-us.googleusercontent.com/42J1C1r1HzmtDbDX8_f6bWdivcw1KB1fC1v94uF3XGY1akhmNQWZEXXy7kSVoYYeTeEuirfnTpn5faC3HZWuXtC5x-ubj9PqqOCjfB8ITCfMHT_niPCy5HSeJnl1tq8aIL7xJ4GQ2wteyxCvw-BY-8c"><img loading="lazy" src="https://lh7-us.googleusercontent.com/42J1C1r1HzmtDbDX8_f6bWdivcw1KB1fC1v94uF3XGY1akhmNQWZEXXy7kSVoYYeTeEuirfnTpn5faC3HZWuXtC5x-ubj9PqqOCjfB8ITCfMHT_niPCy5HSeJnl1tq8aIL7xJ4GQ2wteyxCvw-BY-8c" style="width:481px"/></a>
</figure>
<p class="" id="ed7e4ba9-41ad-4bad-b498-7b7e15765007">This patient at 30
                                                    weeks gestation has oliguria, or decreased urine output (&lt;500
                                                    mL/24 hr), likely due to preeclampsia.  Preeclampsia is defined as
                                                    new-onset hypertension (systolic ‚â•140 mm Hg or diastolic ‚â•90 mm Hg)
                                                    at ‚â•20 weeks gestation plus proteinuria and/or signs of end-organ
                                                    dysfunction (eg, renal failure).  Preeclampsia is thought to be
                                                    caused by abnormal placentation and poorly developed uterine spiral
                                                    arteries, which lead to placental ischemia.  Twin gestations are at
                                                    increased risk, likely due to increased placental mass.</p>
<p class="" id="6f806c81-1af1-40e4-b5f6-8c6c26e4ab1f">In preeclampsia,
                                                    the ischemic placenta releases antiangiogenic factors that cause
                                                    widespread maternal endothelial cell damage.  The resulting
                                                    capillary leakage is responsible for third spacing of fluid (eg,
                                                    facial edema, weight gain) and leakage of protein into the urine
                                                    (ie, proteinuria).  In addition, disrupted endothelial control of
                                                    vascular tone causes hypertension and widespread vasospasm,
                                                    resulting in end-organ hypoperfusion.  In the kidneys, vasospasm
                                                    causes decreased renal blood flow and glomerular filtration rate,
                                                    leading to minimal, concentrated urine (ie, high specific gravity)
                                                    and increased serum creatinine levels.</p>
<p class="" id="2218c2e8-aede-4dd8-94b8-46674c9538f0">Gradual recovery
                                                    of renal function typically occurs following delivery of the
                                                    placenta, which is curative for preeclampsia.</p>
<p class="" id="e4943e75-87fb-423c-b135-33e1e2b131ed">(Choices A and B) 
                                                    Inflammation of the glomeruli (ie, glomerulonephritis) can occur as
                                                    a result of glomerular immune complex deposition, such as with
                                                    anti-glomerular basement membrane (Goodpasture) disease (ie,
                                                    basement membrane IgG deposits) and IgA nephropathy (ie, mesangial
                                                    IgA deposits).  Although these conditions can cause nephritic
                                                    syndrome (eg, hypertension, mild to moderate proteinuria and edema,
                                                    oliguria), red blood cells and casts would be expected on
                                                    urinalysis.</p>
<p class="" id="ac05653d-a742-4da4-ad05-dee3e0574ef2">(Choice C) 
                                                    Inflammation of the renal interstitium (eg, acute interstitial
                                                    nephritis) can cause oliguria but is typically drug related (eg,
                                                    nonsteroidal anti-inflammatory drugs, beta-lactam antibiotics) and
                                                    associated with rash and fever, which are not seen in this patient.
                                                </p>
<p class="" id="ccdb8902-ede0-4968-82ae-4b76f3f50270">(Choice D)  A
                                                    stone within the renal calyx (eg, staghorn calculus) may decrease
                                                    the urine output of the affected kidney due to obstruction; however,
                                                    overall urine output is typically preserved due to normal
                                                    functioning of the contralateral kidney.  In addition, renal stones
                                                    typically cause hematuria.</p>
<p class="" id="615c398e-6b2c-42f9-a725-99d5fbd95ade">Educational
                                                    objective:</p>
<p class="" id="85f8e590-03c5-48de-bccb-737f6b48833c">Preeclampsia is
                                                    new-onset hypertension at ‚â•20 weeks gestation plus proteinuria
                                                    and/or signs of end-organ damage.  Preeclampsia is caused by
                                                    widespread maternal endothelial cell damage due to release of
                                                    antiangiogenic factors from an ischemic placenta.  The result is
                                                    widespread capillary leakage (proteinuria, edema) and vasospasm
                                                    (hypertension, end-organ hypoperfusion [eg, renal failure]).</p>
<p class="" id="823597b4-f801-492e-8468-da54d34ec03a">References</p>
<ul class="bulleted-list" id="8bfd01b9-7554-4d04-80b6-cd796c50ba30">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/18055511">Pathophysiology
                                                            of hypertension during preeclampsia: linking placental
                                                            ischemia with endothelial dysfunction.</a></li>
</ul>
<ul class="bulleted-list" id="b7c70011-0d6b-44f2-b854-76fc5e29ee2a">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/30090069">Preeclampsia:
                                                            novel mechanisms and potential therapeutic approaches.</a>
</li>
</ul>
<p class="" id="f7edd3f5-377a-4e95-9077-908fbc9d3a6f">Pathophysiology
                                                </p>
<p class="" id="6cacf702-36c6-4bbd-87cf-f49e1eb69768">Subject</p>
<p class="" id="40285b9e-23b2-417e-98bf-5f27bae9de71">Pregnancy,
                                                    Childbirth &amp; Puerperium</p>
<p class="" id="59618196-f75d-4ccd-b2bf-31c0f0a1dfa2">System</p>
<p class="" id="eb4dc5ec-7c41-47fe-a644-75c801307454">Preeclampsia</p>
<p class="" id="d1697644-50ce-4a40-bd7c-8ae82ad80150">Topic</p>
<p class="" id="be77536d-fefb-4859-aa42-02d9ec51066e">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="7eeeb686-0ff3-4738-966a-c5f77f39b2f6">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
