
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>19422</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="086e3ce8-7c90-48f1-a1bd-a8bbba8d53a2">A 57-year-old man comes to the
                                        office due to 2 months of progressive cough and weight loss.  He has a history
                                        of diabetes mellitus type 2 and chronic kidney disease.  He does not smoke
                                        cigarettes.  The patient traveled to Denmark 4 months ago for a 2-week
                                        vacation.  He has 2 cats and a bird.  He works in the maintenance department of
                                        a large hotel and services the hot tub and swimming pools.  Temperature is 38 C
                                        (100.4 F), blood pressure is 140/100 mm Hg, pulse is 88/min, and respirations
                                        are 16/min.  The patient is 190 cm (6 foot 3 inches) tall.  BMI is 22 kg/m2. 
                                        Examination shows cervical lymphadenopathy.  Chest imaging is shown in the
                                        exhibit.</p>
<figure class="image" id="3282548b-fc95-4e3b-a208-a9baf879d0cf"><a href="https://lh7-us.googleusercontent.com/5GVDRvRYCcNDljC6Ui2EmLqTLvSXkiRYliSJ1xT0Fv4M8GlaBhKjbuRi7bwYe7HZXiE52IF81PPmXr5V-3sXkzRae5YbnokkZHjYhT2Oclk8c6qyecF7kfccHpX64ulVlVGQLzH1Rd3htO3YyihcBW0"><img loading="lazy" src="https://lh7-us.googleusercontent.com/5GVDRvRYCcNDljC6Ui2EmLqTLvSXkiRYliSJ1xT0Fv4M8GlaBhKjbuRi7bwYe7HZXiE52IF81PPmXr5V-3sXkzRae5YbnokkZHjYhT2Oclk8c6qyecF7kfccHpX64ulVlVGQLzH1Rd3htO3YyihcBW0" style="width:602px"/></a>
</figure>
<p class="" id="7dc7f0ae-c863-4cac-8a8c-055f91049745">Hemoglobin A1c is 8.5% and
                                        serum creatinine is 3.8 mg/dL.  Which of the following risk factors most likely
                                        contributed to this patient's current condition?</p>
<table class="simple-table" id="aeada170-7eb6-43c8-95c3-0de3ce08877c">
<tbody>
<tr id="9f0f2a50-9b04-4d57-b5d5-50304f382529">
<td class="" id="rce~">A.</td>
<td class="" id="V?k&gt;">Body habitus</td>
<td class="" id="dF^d"></td>
</tr>
<tr id="86fa6057-3adf-463c-b8ec-e472d12b3c66">
<td class="" id="rce~">B.</td>
<td class="" id="V?k&gt;">Hot tub cleaning</td>
<td class="" id="dF^d"></td>
</tr>
<tr id="37c27415-0dd3-42fa-a03e-af08f6b46de4">
<td class="" id="rce~">C.</td>
<td class="" id="V?k&gt;">Living with pets</td>
<td class="" id="dF^d"></td>
</tr>
<tr id="583b8a62-6981-4846-8da3-542dda5218f6">
<td class="" id="rce~">D.</td>
<td class="" id="V?k&gt;">Travel to Denmark</td>
<td class="" id="dF^d"></td>
</tr>
<tr id="60f309cb-33b6-47bd-8e2e-6683abaff4f4">
<td class="" id="rce~">E.</td>
<td class="" id="V?k&gt;">Underlying medical conditions</td>
<td class="" id="dF^d"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="4ae25040-7cae-4c7c-b529-af597c4d368a">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="2c557514-0137-4d36-a063-8a83a572e1e9">
<tbody>
<tr id="7231fcd5-4e4c-45b7-8135-5d6e278a6ac1">
<td class="" id="CaC`">A.</td>
<td class="" id="p@QX">Body habitus (2%)</td>
<td class="" id="[aGd"></td>
</tr>
<tr id="535299c3-5c6b-4ede-bb79-0f15fb2309ff">
<td class="" id="CaC`">B.</td>
<td class="" id="p@QX">Hot tub cleaning (28%)</td>
<td class="" id="[aGd"></td>
</tr>
<tr id="ae0f8227-8817-4666-bef3-d12c6362c374">
<td class="" id="CaC`">C.</td>
<td class="" id="p@QX">Living with pets (25%)</td>
<td class="" id="[aGd"></td>
</tr>
<tr id="4b806193-1b4d-4a37-ab69-baff4d8c1ff3">
<td class="" id="CaC`">D.</td>
<td class="" id="p@QX">Travel to Denmark (7%)</td>
<td class="" id="[aGd"></td>
</tr>
<tr id="42f06097-c431-477d-9d89-8bfc03878210">
<td class="" id="CaC`">E.</td>
<td class="" id="p@QX">Underlying medical conditions (35%)
                                                            </td>
<td class="" id="[aGd"></td>
</tr>
</tbody>
</table>
<p class="" id="f6c2c239-f22a-4390-b1ee-159be7978929">Incorrect</p>
<p class="" id="58cc37ad-5e97-4659-b50b-3ccbe732bca7">Correct answer E
                                                </p>
<p class="" id="7725921a-46cb-45e5-a101-e190644004a7">35%Answered
                                                    correctly</p>
<p class="" id="d86eef43-536d-4a59-8fc7-a89a510a06e7">44 secsTime Spent
                                                </p>
<p class="" id="52974204-c93f-43e3-a92f-53337a79db5f">2024Version</p>
<ul class="bulleted-list" id="96ab4965-bf7d-46e1-8587-4d0ede01c33f">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="12e3047a-af96-48ca-8c3a-2a8a6eaff25b">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="605c2a59-5754-4027-be08-3edc8bfbb844">
<tbody>
<tr id="aa7ff96d-3e51-4085-ad67-a30c34f2f19a">
<td class="" id="Do~;">Host factors that increase the risk
                                                                of active tuberculosis</td>
<td class="" id="u;;e"></td>
</tr>
<tr id="c8dd5222-877e-4848-a650-a51963684020">
<td class="" id="Do~;">Immunosuppression</td>
<td class="" id="u;;e">‚Ä¢ HIV<br/>‚Ä¢ Glucocorticoid
                                                                use<br/>‚Ä¢ TNF-Œ± inhibitors<br/></td>
</tr>
<tr id="5f7cf17b-d17b-4247-8c63-16f3f9696da3">
<td class="" id="Do~;">Chronic diseases</td>
<td class="" id="u;;e">‚Ä¢ Diabetes mellitus<br/>‚Ä¢ Renal
                                                                disease<br/>‚Ä¢ Malignancy<br/></td>
</tr>
<tr id="ca4d92d5-c610-4faf-98e0-f6c6e2ade761">
<td class="" id="Do~;">Substance use<br/>disorder<br/>
</td>
<td class="" id="u;;e">‚Ä¢ Illicit drug use<br/>‚Ä¢ Alcohol use
                                                                disorder<br/>‚Ä¢ Tobacco use<br/></td>
</tr>
<tr id="aedba242-d0f9-4710-aae8-41fc76e1042a">
<td class="" id="Do~;">Malnutrition</td>
<td class="" id="u;;e">‚Ä¢ Underweight (BMI &lt;18.5
                                                                kg/m2)<br/>‚Ä¢ Vitamin D deficiency<br/></td>
</tr>
<tr id="42706a4c-cd5b-4c18-84a3-7488a5fa7ca6">
<td class="" id="Do~;">TNF-Œ± = tumor necrosis factor-alpha.
                                                            </td>
<td class="" id="u;;e"></td>
</tr>
</tbody>
</table>
<p class="" id="25130bc6-dd1e-4d8f-9e2a-b571e52f5518">This
                                                    patient's chronic cough, weight loss, cervical lymphadenopathy,
                                                    and cavitary pulmonary lesion suggest active pulmonary tuberculosis
                                                    (TB).  Exposure to <em>Mycobacterium tuberculosis</em> usually
                                                    results in lifelong latent infection due to the formation of
                                                    granulomas, which wall off the pathogen and limit spread.  However,
                                                    the formation and maintenance of granulomas rely on coordination
                                                    between monocytes and T lymphocytes.  Host conditions that weaken
                                                    these aspects of immune function often significantly increase the
                                                    risk of reactivation TB; these include the following:</p>
<ul class="bulleted-list" id="f8f99bb7-0f33-4e92-8f8a-db0de0d302b4">
<li style="list-style-type:disc">Chronic kidney disease is
                                                        associated with impaired function of monocytes and the
                                                        cell-mediated immune response due to uremia and hypoalbuminemia.
                                                        Risk of TB is increased 6- to 50-fold in this population and is
                                                        greatest in those with end-stage disease.</li>
</ul>
<ul class="bulleted-list" id="76de4513-5796-4248-b688-c5364a92542a">
<li style="list-style-type:disc">Poorly controlled diabetes mellitus
                                                        is associated with immune impairment and alterations to cytokine
                                                        signaling, which weaken the development and maintenance of
                                                        granulomas. Risk of TB is greatest in those with chronic
                                                        hyperglycemia (eg, this patient with hemoglobin A1c of 8.5%).
                                                    </li>
</ul>
<p class="" id="b487abfd-6ba6-4c93-adae-7e0b1c394bdb">Increased risk of
                                                    reactivation TB is also seen in those with immunosuppression (eg,
                                                    HIV, immunomodulatory/glucocorticoid medications), substance abuse,
                                                    malnutrition, and advanced age.</p>
<p class="" id="64edba42-cc50-4444-bcbe-1b10b0a9174b">(Choice A)  A tall
                                                    body habitus is often seen in Marfan syndrome.  Although these
                                                    individuals have an increased risk of spontaneous pneumothorax,
                                                    manifestations would include acute shortness of breath and imaging
                                                    evidence of air between the lung and chest wall.</p>
<p class="" id="68e748dd-c09c-42c0-b7fb-c08d15f61318">(Choice B) 
                                                    Patients who work with hot tubs and swimming pools can develop
                                                    hypersensitivity pneumonitis due to inhalation of <em>Mycobacterium
                                                        avium</em>, a nontuberculous mycobacterium.  Although most cases
                                                    are marked by acute dyspnea, chronic symptoms can occur.  However,
                                                    imaging would generally show patchy, ground-glass pulmonary
                                                    infiltrates, not a cavitary lesion.</p>
<p class="" id="fb4d43fb-ad45-4bea-ba83-e7854d6d9490">(Choice C)  Living
                                                    with pets increases the risk of asthma due to increased exposure to
                                                    allergens.  Asthma is typically marked by recurrent
                                                    bronchoconstriction with acute periods of dyspnea, wheeze, and
                                                    cough.  Chest x-ray may show hyperinflation and bronchial thickening
                                                    but not cavitary infiltration.</p>
<p class="" id="e6bf8ab8-de94-443a-ae0e-4f265a99ebc6">(Choice D)  Travel
                                                    to areas endemic for TB can increase risk of exposure and subsequent
                                                    infection.  Endemic regions include India, sub-Saharan Africa, and
                                                    Southeast Asia.  Denmark has a low incidence of TB; it is unlikely
                                                    that the patient acquired the infection during his visit to this
                                                    country.</p>
<p class="" id="d5b1bdc4-ac6e-437a-bec8-83cd811c186d">Educational
                                                    objective:</p>
<p class="" id="26438f5c-9943-44f7-b08a-09c57fe9a32b"><em>Mycobacterium
                                                        tuberculosis</em> infection is controlled by coordination
                                                    between macrophages and T lymphocytes.  Conditions that impair
                                                    immune function increase the risk of active tuberculosis; this
                                                    includes chronic kidney disease, diabetes mellitus, HIV, substance
                                                    abuse, malnutrition, and advanced age.</p>
<p class="" id="bd1c65d4-2cb6-4d48-bdf8-50116490708f">Microbiology</p>
<p class="" id="eea18e0d-f124-4097-8be0-757facaa819e">Subject</p>
<p class="" id="2f67faeb-0b06-4764-ba3d-5fe2e76e9dd8">Infectious
                                                    Diseases</p>
<p class="" id="67e0b1dc-4567-4395-9ecd-36c0a44b4ac6">System</p>
<p class="" id="853a7545-533e-4223-adf1-33cb3bf288d1">Tuberculosis</p>
<p class="" id="3ad64b79-3422-4dfa-b5bd-1aa3f733f1d9">Topic</p>
<p class="" id="6cc1c9f6-be5f-41e6-bd9f-bbf49aab4e44">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="483e12fa-c951-4b03-ad0b-6b3416cc705b">‚ú®Done</p>
<p class="" id="942d96f2-56fa-4c27-8022-62b108743b6c">Exhibit Display
                                                </p>
<figure class="image" id="a8cb9ab4-9eb2-44fb-97c8-573eeeb7a2a8"><a href="https://lh7-us.googleusercontent.com/GRUdFhHnvukym3kBkjwFVIKfGbT0i2KBnta0hmVOHo63VH1AvD0lLhiR1n_NDV_cznqDJA89ZgzevNOxL6NblHx5svxPulElt4Vorjg1TTpHEPSZvUtkvQzGYfTS4TwsekNdYaBJzWKKv4E1lf_IfgY"><img loading="lazy" src="https://lh7-us.googleusercontent.com/GRUdFhHnvukym3kBkjwFVIKfGbT0i2KBnta0hmVOHo63VH1AvD0lLhiR1n_NDV_cznqDJA89ZgzevNOxL6NblHx5svxPulElt4Vorjg1TTpHEPSZvUtkvQzGYfTS4TwsekNdYaBJzWKKv4E1lf_IfgY" style="width:602px"/></a>
</figure>
<p class="" id="298b452f-2888-4ff7-a2f9-2b9075d387d0">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="6d7797de-63b3-4f8c-bb53-73b74ea37e55">ExistingMy
                                                    Notebook</p>
<p class="" id="afd7402a-73dc-412e-a7f8-13c25500e2b3">Exhibit Display
                                                </p>
<figure class="image" id="7d78aebb-4950-487c-87b3-3d8551559698"><a href="https://lh7-us.googleusercontent.com/2Mt_2RcPp7eS1YWdDwYTqqNG73fx_RFWrSR6T4-DIwYIooe7Dq52fU4BcLadoWxHRfDJAXHC8lMQb2ILqoEEF3c7q4MUL2QqO1W2q4GImXQkh8mpPxNhc6mWCBy58i0u4fwhcOl58KMdfLzD754-rEg"><img loading="lazy" src="https://lh7-us.googleusercontent.com/2Mt_2RcPp7eS1YWdDwYTqqNG73fx_RFWrSR6T4-DIwYIooe7Dq52fU4BcLadoWxHRfDJAXHC8lMQb2ILqoEEF3c7q4MUL2QqO1W2q4GImXQkh8mpPxNhc6mWCBy58i0u4fwhcOl58KMdfLzD754-rEg" style="width:602px"/></a>
</figure>
<p class="" id="fd779b9f-b8c7-4002-9cc9-85e1a3db09bf">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="27f15ee8-9093-45f7-aee4-93eff8303f6f">ExistingMy
                                                    Notebook</p>
<p class="" id="46997aaa-c337-43e1-8e9e-ee741a151db6">Exhibit Display
                                                </p>
<figure class="image" id="d2fa4b44-f866-42f3-b24d-db29b0b3095e"><a href="https://lh7-us.googleusercontent.com/77v3K8PtRum2pzf5r1ePs3d05yfWrbtzM_9BR3UAy_C3bLZQ3OnvTBvW2kRrbmP87rohJSx11OAlHERS7VzHcP9Mc5Rk6HRpFf7QSnZ4eyNwgM_jmXpw9ipRiKGJB85bOuQel0fwtp1c2qxqGddOCqc"><img loading="lazy" src="https://lh7-us.googleusercontent.com/77v3K8PtRum2pzf5r1ePs3d05yfWrbtzM_9BR3UAy_C3bLZQ3OnvTBvW2kRrbmP87rohJSx11OAlHERS7VzHcP9Mc5Rk6HRpFf7QSnZ4eyNwgM_jmXpw9ipRiKGJB85bOuQel0fwtp1c2qxqGddOCqc" style="width:602px"/></a>
</figure>
<p class="" id="fbb50826-676f-486f-8fc8-848c4865cb21">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="514f5e96-798e-423b-80f0-c28820a8e2a8">ExistingMy
                                                    Notebook</p>
<p class="" id="19231545-e4fc-45bb-9fad-3f519f1549dc">Exhibit Display
                                                </p>
<figure class="image" id="a3f2f746-6a2d-48e7-b02a-16df0c1b3c8b"><a href="https://lh7-us.googleusercontent.com/c3dGa8cB1zAvMK4uiEJgdhN8GqqJ6FMuRM6QRNYiiIL5GP122KAcHFgKprqqXynoO1GqRrj_o4zUeXppjOgqPIAvjES-Hy_v03Rs7rlvjEe6XH5W991q-HbggU9HHMUc4TihUbZQjB9TgAStzunNywc"><img loading="lazy" src="https://lh7-us.googleusercontent.com/c3dGa8cB1zAvMK4uiEJgdhN8GqqJ6FMuRM6QRNYiiIL5GP122KAcHFgKprqqXynoO1GqRrj_o4zUeXppjOgqPIAvjES-Hy_v03Rs7rlvjEe6XH5W991q-HbggU9HHMUc4TihUbZQjB9TgAStzunNywc" style="width:602px"/></a>
</figure>
<p class="" id="9130ce47-5d99-4df6-81e1-09ee043cabcb">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="476d0db5-96c5-46c3-a055-c42e418c8b6b">ExistingMy
                                                    Notebook</p>
<p class="" id="51d51413-e93e-4471-bb48-6076ff21c77d">Exhibit Display
                                                </p>
<figure class="image" id="6e66814b-9ead-40e7-a97b-bbbd92f67342"><a href="https://lh7-us.googleusercontent.com/r9Iaih4ZZgLP6yRaJjW7R3cTwUcKtzlGnJjAGQd0Hwa966--DRTQ9U-0Ot7Q7U0Ve7wOfpfearGIe9dAnitv1eBWrowVlOWl0bU1vS8Nh-9WouvFNT7IuogdYpI_mr9kxj_ekQqn0Vt2d9FitUmVM7w"><img loading="lazy" src="https://lh7-us.googleusercontent.com/r9Iaih4ZZgLP6yRaJjW7R3cTwUcKtzlGnJjAGQd0Hwa966--DRTQ9U-0Ot7Q7U0Ve7wOfpfearGIe9dAnitv1eBWrowVlOWl0bU1vS8Nh-9WouvFNT7IuogdYpI_mr9kxj_ekQqn0Vt2d9FitUmVM7w" style="width:602px"/></a>
</figure>
<p class="" id="33b2a5c8-4391-4f35-b48c-6d4bc282d34d">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="4b87dcbc-08e8-4e89-977d-337103214381">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }


    


    

    /* Adjust table padding to make room for radio button */
    


    


    


    


    /* Clickable Answer Choices */
    table tr.answer-choice {
        cursor: pointer !important;
        transition: all 0.3s ease !important;
    }

    table tr.answer-choice:hover {
        background: #f8f9fa !important;
    }

    table tr.answer-choice td:first-child {
        position: relative !important;
        padding-left: 35px !important;
    }

    table tr.answer-choice td:first-child::before {
        content: '';
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        border: 2px solid #999;
        border-radius: 50%;
        background: white;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }

    table tr.answer-choice.selected td:first-child::before {
        border-color: #1a73e8;
        border-width: 5px;
    }

    table tr.answer-choice.selected {
        background: #e8f4ff !important;
    }

    table tr.answer-choice.selected td:first-child {
        color: #1a73e8 !important;
        font-weight: 600 !important;
    }


    


    /* Answer Validation Styles */
    tr.answer-choice.answer-correct {
        background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%) !important;
        border: 3px solid #28a745 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3) !important;
    }

    tr.answer-choice.answer-correct td {
        color: #155724 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-correct td:first-child::before {
        border-color: #28a745 !important;
        background: #28a745 !important;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2) !important;
    }

    tr.answer-choice.answer-incorrect {
        background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%) !important;
        border: 3px solid #dc3545 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3) !important;
    }

    tr.answer-choice.answer-incorrect td {
        color: #721c24 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-incorrect td:first-child::before {
        border-color: #dc3545 !important;
        background: #dc3545 !important;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2) !important;
    }


    /* Answer Validation Styles */
    tr.answer-choice.answer-correct {
        background: linear-gradient(90deg, #d4edda 0%, #c3e6cb 100%) !important;
        border: 3px solid #28a745 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3) !important;
    }

    tr.answer-choice.answer-correct td {
        color: #155724 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-correct td:first-child::before {
        border-color: #28a745 !important;
        background: #28a745 !important;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2) !important;
    }

    tr.answer-choice.answer-incorrect {
        background: linear-gradient(90deg, #f8d7da 0%, #f5c6cb 100%) !important;
        border: 3px solid #dc3545 !important;
        border-radius: 8px !important;
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3) !important;
    }

    tr.answer-choice.answer-incorrect td {
        color: #721c24 !important;
        font-weight: 600 !important;
    }

    tr.answer-choice.answer-incorrect td:first-child::before {
        border-color: #dc3545 !important;
        background: #dc3545 !important;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2) !important;
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>







<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Communicate with parent window (if in iframe)
    function notifyParent(choice) {
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'choiceSelected',
                questionId: getQuestionId(),
                choice: choice
            }, '*');
        }
    }

    // Load saved choice from parent or localStorage
    function loadSavedChoice() {
        const questionId = getQuestionId();

        // Try to get from localStorage first
        const saved = localStorage.getItem('choice_q' + questionId);
        if (saved) {
            selectChoice(saved, false);
        }

        // Ask parent for saved choice (if in iframe)
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'getChoice',
                questionId: questionId
            }, '*');
        }
    }

    // Listen for messages from parent
    window.addEventListener('message', function(event) {
        if (event.data.type === 'setChoice' && event.data.questionId === getQuestionId()) {
            selectChoice(event.data.choice, false);
        }
    });

    // Select a choice
    function selectChoice(choice, notify = true) {
        if (!choice) return;

        const questionId = getQuestionId();

        // Remove previous selection
        document.querySelectorAll('tr.answer-choice').forEach(row => {
            row.classList.remove('selected');
        });

        // Add selection to clicked choice
        const choiceRow = document.querySelector(`tr.answer-choice[data-choice="${choice}"]`);
        if (choiceRow) {
            choiceRow.classList.add('selected');

            // Save to localStorage
            localStorage.setItem('choice_q' + questionId, choice);

            // Notify parent (if in iframe)
            if (notify) {
                notifyParent(choice);
            }
        }
    }

    // Initialize answer choices
    function initializeChoices() {
        // Find all answer choice rows (A, B, C, D, E, F, etc.)
        const choicePattern = /^[A-Z]\.$/;
        const tables = document.querySelectorAll('table.simple-table');

        tables.forEach(table => {
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell && choicePattern.test(firstCell.textContent.trim())) {
                    const choice = firstCell.textContent.trim().replace('.', '');
                    row.classList.add('answer-choice');
                    row.setAttribute('data-choice', choice);
                    row.style.position = 'relative';

                    // Add click handler
                    row.addEventListener('click', function(e) {
                        // Don't trigger if clicking inside a link or button
                        if (e.target.tagName === 'A' || e.target.closest('a')) return;

                        // Toggle selection
                        if (this.classList.contains('selected')) {
                            this.classList.remove('selected');
                            const questionId = getQuestionId();
                            localStorage.removeItem('choice_q' + questionId);
                            notifyParent('');
                        } else {
                            selectChoice(choice);
                        }
                    });
                }
            });
        });

        // Load saved choice after a short delay
        setTimeout(loadSavedChoice, 100);
    }

    // Run when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChoices);
    } else {
        initializeChoices();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>

<script>
(function() {
    // Get question ID from summary
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Find the correct answer by highest percentage
    function findCorrectAnswer() {
        // Find the Submit or Explanation details element
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (!submitDetails) return null;

        // Find all answer rows with percentages inside Submit section
        const table = submitDetails.querySelector('table.simple-table');
        if (!table) return null;

        const rows = table.querySelectorAll('tr');
        let maxPercentage = -1;
        let correctChoice = null;

        rows.forEach(row => {
            const firstCell = row.querySelector('td:first-child');
            const secondCell = row.querySelector('td:nth-child(2)');

            if (firstCell && secondCell) {
                const choiceMatch = firstCell.textContent.trim().match(/^([A-Z])\./);
                const percentMatch = secondCell.textContent.match(/(\d+)%/);

                if (choiceMatch && percentMatch) {
                    const choice = choiceMatch[1];
                    const percentage = parseInt(percentMatch[1]);

                    if (percentage > maxPercentage) {
                        maxPercentage = percentage;
                        correctChoice = choice;
                    }
                }
            }
        });

        return correctChoice;
    }

    // Check user's answer when Submit is opened
    function checkAnswer() {
        const questionId = getQuestionId();
        const choiceKey = 'choice_q' + questionId;
        const userChoice = localStorage.getItem(choiceKey);

        if (!userChoice) {
            console.log('No answer selected');
            return;
        }

        const correctAnswer = findCorrectAnswer();
        if (!correctAnswer) {
            console.log('Could not determine correct answer');
            return;
        }

        const isCorrect = userChoice === correctAnswer;

        // Save result to localStorage
        const resultKey = 'result_q' + questionId;
        const resultValue = isCorrect ? 'correct' : 'incorrect';
        localStorage.setItem(resultKey, resultValue);

        // Force storage event for parent window
        try {
            window.dispatchEvent(new StorageEvent('storage', {
                key: resultKey,
                newValue: resultValue,
                storageArea: localStorage
            }));
        } catch (e) {
            console.log('Could not dispatch storage event:', e);
        }

        // Visual feedback - highlight the selected answer row
        const selectedRow = document.querySelector(`tr.answer-choice[data-choice="${userChoice}"]`);
        if (selectedRow) {
            // Remove any existing validation classes
            document.querySelectorAll('tr.answer-choice').forEach(row => {
                row.classList.remove('answer-correct', 'answer-incorrect');
            });

            // Add appropriate class
            if (isCorrect) {
                selectedRow.classList.add('answer-correct');
            } else {
                selectedRow.classList.add('answer-incorrect');

                // Also highlight the correct answer
                const correctRow = document.querySelector(`tr.answer-choice[data-choice="${correctAnswer}"]`);
                if (correctRow) {
                    correctRow.classList.add('answer-correct');
                }
            }
        }

        // Notify parent window
        if (window.parent && window.parent !== window) {
            window.parent.postMessage({
                type: 'answerValidated',
                questionId: questionId,
                userChoice: userChoice,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            }, '*');
        }

        console.log(`Answer checked: User=${userChoice}, Correct=${correctAnswer}, Result=${isCorrect ? 'Correct' : 'Incorrect'}`);
    }

    // Monitor Submit or Explanation details opening
    function setupSubmitMonitor() {
        const submitDetails = Array.from(document.querySelectorAll('details')).find(d => {
            const summary = d.querySelector('summary');
            return summary && (summary.textContent.includes('Submit') || summary.textContent.includes('Explanation'));
        });

        if (submitDetails) {
            submitDetails.addEventListener('toggle', function() {
                if (this.open) {
                    // Small delay to ensure everything is rendered
                    setTimeout(checkAnswer, 100);

                    // Notify parent that Submit/Explanation was opened
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'submitOpened',
                            questionId: getQuestionId()
                        }, '*');
                    }
                } else {
                    // Notify parent that Submit/Explanation was closed
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'submitClosed',
                            questionId: getQuestionId()
                        }, '*');
                    }
                }
            });
        }
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupSubmitMonitor);
    } else {
        setupSubmitMonitor();
    }
})();
</script>
