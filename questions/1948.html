
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>1948</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="487455a6-c349-4875-83b2-6c9ea5ed5e1e">A 34-year-old woman has
                                        recurrent throbbing headaches that occur several times a month and cause
                                        significant distress.  They are accompanied by nausea and photophobia.  She has
                                        had 5 emergency department visits for these headaches over the last 6 months. 
                                        During office visits, her blood pressure ranges from 140/90 mm Hg to 150/95 mm
                                        Hg.  Neurologic examination is unremarkable.  The patient is prescribed
                                        metoprolol and is advised that the medication is expected to decrease the
                                        frequency of headaches and also lower blood pressure in the long term.  Which of
                                        the following best explains this medication's effect on blood pressure?</p>
<table class="simple-table" id="1f595ea6-999b-46a4-9614-5cc2974dec67">
<tbody>
<tr id="2a3fc1c8-a92b-4e8a-a27a-969abd8ef45d">
<td class="" id="=?|?">A.</td>
<td class="" id="UvA&lt;">Decreased level of circulating catecholamines
                                                </td>
<td class="" id="cJOE"></td>
</tr>
<tr id="3c30931c-629a-4308-8457-906bd67ded0c">
<td class="" id="=?|?">B.</td>
<td class="" id="UvA&lt;">Decreased level of circulating renin</td>
<td class="" id="cJOE"></td>
</tr>
<tr id="0dba7dc9-ee93-4f36-88ec-26681a808c98">
<td class="" id="=?|?">C.</td>
<td class="" id="UvA&lt;">Increased atrioventricular nodal conduction
                                                    rate</td>
<td class="" id="cJOE"></td>
</tr>
<tr id="f05c4e46-408b-4ca7-9a3e-d5d61e03dace">
<td class="" id="=?|?">D.</td>
<td class="" id="UvA&lt;">Increased renal sodium and water retention
                                                </td>
<td class="" id="cJOE"></td>
</tr>
<tr id="bfa29c5c-328f-4f12-acbc-ed3a4eb0abc3">
<td class="" id="=?|?">E.</td>
<td class="" id="UvA&lt;">Long-term increase in peripheral vascular
                                                    resistance</td>
<td class="" id="cJOE"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="e5b48506-f194-47f3-a648-9413d545fd59">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="5f60fe92-bd9d-4d24-8d59-441696767fb6">
<tbody>
<tr id="ad71b7f1-3ed5-48f9-9091-b9c289be35b1">
<td class="" id="\ivu">A.</td>
<td class="" id="CC=?">Decreased level of circulating
                                                                catecholamines (15%)</td>
<td class="" id="&lt;o;k"></td>
</tr>
<tr id="f0dc6ad5-0613-4d7a-9c05-8ec82b816db1">
<td class="" id="\ivu">B.</td>
<td class="" id="CC=?">Decreased level of circulating renin
                                                                (71%)</td>
<td class="" id="&lt;o;k"></td>
</tr>
<tr id="d1847854-4b0c-4b77-9d07-815273f1817e">
<td class="" id="\ivu">C.</td>
<td class="" id="CC=?">Increased atrioventricular nodal
                                                                conduction rate (6%)</td>
<td class="" id="&lt;o;k"></td>
</tr>
<tr id="b6247500-9702-4633-a723-340615506c92">
<td class="" id="\ivu">D.</td>
<td class="" id="CC=?">Increased renal sodium and water
                                                                retention (1%)</td>
<td class="" id="&lt;o;k"></td>
</tr>
<tr id="e06e62e0-f28e-49e0-95d6-8c9a23686b71">
<td class="" id="\ivu">E.</td>
<td class="" id="CC=?">Long-term increase in peripheral
                                                                vascular resistance (4%)</td>
<td class="" id="&lt;o;k"></td>
</tr>
</tbody>
</table>
<p class="" id="500c501e-a462-4c5e-92dd-f1ea4ad1f209">Incorrect</p>
<p class="" id="a0205943-b206-4954-b9ec-f2671e5a16b9">Correct answer B
                                                </p>
<p class="" id="2b502980-d287-443a-b3c2-fd073b96fcc1">71%Answered
                                                    correctly</p>
<p class="" id="313e9744-ee9f-4542-914b-7a670a36c8d6">10 secsTime Spent
                                                </p>
<p class="" id="77dee24c-f02a-4509-91df-6eb596d156b1">2024Version</p>
<ul class="bulleted-list" id="82138b4b-69a8-4f6a-a5a7-f975b94112e0">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="cfd8fe5e-3faa-4df1-bf42-574f5834641a">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="7240c6c1-00a7-48bd-b39c-e76e79fa5ae1"><a href="https://lh7-us.googleusercontent.com/jG3xTdm6Tq_T61jFDD09VRf09rZFrrD7yEcLbPIsxhORoyrCFqIqOWUI_9axFI0NE7h70PVWmPf1zfEUrm43njT15hRfSBPSeL8vXkfiWquhR37i3I1dE993_ZHIu91pjrlMHRtp3L2pYsF4O0sggLo"><img loading="lazy" src="https://lh7-us.googleusercontent.com/jG3xTdm6Tq_T61jFDD09VRf09rZFrrD7yEcLbPIsxhORoyrCFqIqOWUI_9axFI0NE7h70PVWmPf1zfEUrm43njT15hRfSBPSeL8vXkfiWquhR37i3I1dE993_ZHIu91pjrlMHRtp3L2pYsF4O0sggLo" style="width:298px"/></a>
</figure>
<p class="" id="91c3b773-3c98-4dfc-b3c4-f684a10ea5aa">Beta blockers are
                                                    useful for treating hypertensive patients with comorbid conditions
                                                    such as migraine, essential tremor, angina pectoris/prior myocardial
                                                    infarction, and atrial fibrillation.  Beta blockers lower blood
                                                    pressure via 2 mechanisms:</p>
<ol class="numbered-list" id="6f9a8b56-d022-4cb1-b47a-589832230dab" start="1" type="1">
<li>Reducing myocardial contractility and heart rate</li>
</ol>
<ol class="numbered-list" id="1c7980dd-6cb9-4ec8-8aa5-b0e7e230bae0" start="2" type="1">
<li>Decreasing renin release by the kidney</li>
</ol>
<p class="" id="58d52d3a-c912-4165-8aac-56fa204b0c87">Renin release is
                                                    mediated in part through sympathetic stimulation of beta-1 receptors
                                                    located on juxtaglomerular cells.  Therefore, beta-adrenergic
                                                    blocking drugs (eg, metoprolol) act to inhibit renin release, which
                                                    in turn reduces the conversion of angiotensinogen to angiotensin I
                                                    and reduces the levels of angiotensin II (a potent vasoconstrictor)
                                                    and aldosterone (decreasing renal sodium and water retention)
                                                    (Choice D).</p>
<p class="" id="2f2d9202-a2b6-4533-a7f3-9fc4d013e77b">(Choice A)  Beta
                                                    blockers block the action of endogenous catecholamines on adrenergic
                                                    beta receptors but have no significant effect on circulating levels
                                                    of catecholamine.</p>
<p class="" id="af5add8d-05e8-4d9d-a598-5fb231357d77">(Choice C) 
                                                    Beta-adrenergic receptor antagonists depress conduction through the
                                                    atrioventricular (AV) node and can cause varying degrees of AV
                                                    block.</p>
<p class="" id="3a8ea08e-9f62-46e5-9f06-15c6c7ed4633">(Choice E) 
                                                    Long-term use of beta blockers will cause either no change or modest
                                                    decreases in the peripheral vascular resistance due to their effects
                                                    on the renin-angiotensin-aldosterone system.</p>
<p class="" id="a45bd419-a53d-4bdd-9372-9f8d02a0c602">Educational
                                                    objective:</p>
<p class="" id="9410b155-c0d6-42b6-a416-e6a5ad61ef1c">Beta blockers
                                                    inhibit release of renin from renal juxtaglomerular cells through
                                                    antagonism of beta-1 receptors on these cells.  Inhibition of renin
                                                    release prevents activation of the renin-angiotensin-aldosterone
                                                    pathway, which results in decreased vasoconstriction and decreased
                                                    renal sodium and water retention.</p>
<p class="" id="f5beadbb-59ec-487b-9766-e9649e814c9d">References</p>
<ul class="bulleted-list" id="efb202bb-df9a-44de-bfe3-a666d40c6f18">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/10342782">Beta-adrenergic
                                                            receptor blockade as a therapeutic approach for suppressing
                                                            the renin-angiotensin-aldosterone system in normotensive and
                                                            hypertensive subjects.</a></li>
</ul>
<p class="" id="ac2bd00b-d57d-4249-9a98-638c06661b69">Pharmacology</p>
<p class="" id="e23b4642-1588-46af-9a25-f560f86dddc5">Subject</p>
<p class="" id="ae5ee94d-6bc0-4410-9582-7bd5451baebd">Cardiovascular
                                                    System</p>
<p class="" id="f8b84627-e9e5-416a-9f4c-02695dd37841">System</p>
<p class="" id="365f106f-c829-4390-8985-0dbdb5d0a36f">Primary
                                                    hypertension</p>
<p class="" id="32fe3a34-34ec-4859-b479-adab2d1bf0a5">Topic</p>
<p class="" id="68cabb78-658d-449e-89e6-8a819bf5fee3">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
