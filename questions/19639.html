
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>19639</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="04905648-4750-4d68-954f-3eb2c314891e">A 27-year-old woman, gravida 1
                                        para 0, at 37 weeks gestation comes to the emergency department after
                                        spontaneous rupture of membranes with leakage of blood mixed with fluid. 
                                        Emergency cesarean delivery is performed due to severe fetal bradycardia.  On
                                        delivery, the neonate is apneic and hypotonic.  Resuscitation with endotracheal
                                        intubation and assisted ventilation is performed, which improves bradycardia. 
                                        Apgar scores are &lt;5 at 5 and 10 minutes.  Umbilical cord blood analysis shows
                                        high anion gap metabolic acidosis.  Controlled hypothermia to maintain body
                                        temperature at 33-35 C (91.4-95 F) is begun.  This therapy is most likely to
                                        provide benefit via which of the following mechanisms?</p>
<table class="simple-table" id="bb3a92c1-7ccf-4977-85b2-7e5907eb6681">
<tbody>
<tr id="69d4b53c-1a74-4889-a06b-4b45bfea17e0">
<td class="" id="bAjW">A.</td>
<td class="" id="]&gt;M^">Decreased activation of the coagulation
                                                    cascade</td>
<td class="" id="eQQW"></td>
</tr>
<tr id="151335a6-e089-4a47-a7f9-d5f02c800048">
<td class="" id="bAjW">B.</td>
<td class="" id="]&gt;M^">Decreased reactive oxygen species‚Äìmediated
                                                    neuronal injury</td>
<td class="" id="eQQW"></td>
</tr>
<tr id="ad5ac69f-7d63-492d-b245-c82a0fbf2288">
<td class="" id="bAjW">C.</td>
<td class="" id="]&gt;M^">Increased conversion of bilirubin to less
                                                    toxic water-soluble isomers</td>
<td class="" id="eQQW"></td>
</tr>
<tr id="313736b6-06e4-4755-b01a-13999c85d706">
<td class="" id="bAjW">D.</td>
<td class="" id="]&gt;M^">Increased hepatic clearance of lactic acid
                                                </td>
<td class="" id="eQQW"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="bf63643e-509c-47ae-a7ec-ba57b48b43e7">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="6bd235d1-11d3-43a2-84d2-2939faf3c375">
<tbody>
<tr id="97d693ae-bb60-4368-bb1e-8649b7c1ed5b">
<td class="" id="sY~@">A.</td>
<td class="" id="VU|N">Decreased activation of the
                                                                coagulation cascade (8%)</td>
<td class="" id="OFoo"></td>
</tr>
<tr id="e7772416-4a7d-40fa-bad9-3d548ff44e67">
<td class="" id="sY~@">B.</td>
<td class="" id="VU|N">Decreased reactive oxygen
                                                                species‚Äìmediated neuronal injury (67%)</td>
<td class="" id="OFoo"></td>
</tr>
<tr id="9424d887-741a-42a3-8239-3c626e6d1aef">
<td class="" id="sY~@">C.</td>
<td class="" id="VU|N">Increased conversion of bilirubin to
                                                                less toxic water-soluble isomers (3%)</td>
<td class="" id="OFoo"></td>
</tr>
<tr id="84a30aeb-91c1-451f-be95-9ce721f4508c">
<td class="" id="sY~@">D.</td>
<td class="" id="VU|N">Increased hepatic clearance of lactic
                                                                acid (21%)</td>
<td class="" id="OFoo"></td>
</tr>
</tbody>
</table>
<p class="" id="f532f54b-c24c-4384-a53b-eb014839aa4b">Incorrect</p>
<p class="" id="808af4f1-36af-4a3d-863f-f7f031ae9de6">Correct answer B
                                                </p>
<p class="" id="f127ad32-367c-4df1-8379-2c09a993baa4">67%Answered
                                                    correctly</p>
<p class="" id="ca510f7e-84e5-4848-8579-c33df676a226">13 secsTime Spent
                                                </p>
<p class="" id="8a565882-a387-4f88-a016-891391dcd50d">2024Version</p>
<ul class="bulleted-list" id="fcebcb68-de07-41e7-9c4b-ebc7ce3517f3">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="bb5737fb-bce2-4fe5-97b0-9e0202b9d24a">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="6308f9c7-79ea-4274-b414-d11d5b8578e2"><a href="https://lh7-us.googleusercontent.com/CCYe-GlEPLlrK6hbXfNPBntEIszqkJeDx1ZUqoAmcACTMQ-u6KTOQInTykR9JSEkSucz32cEGeyT9PdCOjKztCwVxstbByNSBYEhBjWUuF4sgzl62IJ1DdjDjt2hVQXkX5Ch2XKKlTr8ExS2e9MSrVM"><img loading="lazy" src="https://lh7-us.googleusercontent.com/CCYe-GlEPLlrK6hbXfNPBntEIszqkJeDx1ZUqoAmcACTMQ-u6KTOQInTykR9JSEkSucz32cEGeyT9PdCOjKztCwVxstbByNSBYEhBjWUuF4sgzl62IJ1DdjDjt2hVQXkX5Ch2XKKlTr8ExS2e9MSrVM" style="width:602px"/></a>
</figure>
<p class="" id="da70650b-f808-4da6-98db-56c0762f035e">This early-term
                                                    infant has sustained hypoxic-ischemic injury during delivery and is
                                                    at risk of worsening neonatal encephalopathy (eg, decreased
                                                    consciousness, impaired respiration, seizures).  Hypoxia can lead to
                                                    neuronal injury through multiple injury cascades, many of which lead
                                                    to the formation of reactive oxygen species (ROS).  ROS can mediate
                                                    cellular damage of DNA, cell membranes, proteins, and enzymes,
                                                    leading to widespread neuronal death.</p>
<p class="" id="8cb39b0c-c4fa-4945-be00-b7fe6e22aa9d">Therapeutic
                                                    hypothermia (maintenance of temperature at 33-35 C [91.4-95 F])
                                                    leads to improved neurologic outcomes in a variety of
                                                    hypoxia-induced injuries (eg, after cardiac arrest, seizures).  The
                                                    formation of ROS after ischemic injury is temperature dependent, so
                                                    it can be decreased by therapeutic hypothermia.  In addition,
                                                    therapeutic hypothermia decreases cerebral blood flow, oxygen
                                                    consumption, and glucose metabolism, thereby decreasing the
                                                    formation of ROS due to both cellular metabolism and reperfusion.
                                                </p>
<p class="" id="47fb532f-dc38-4be2-b16b-ccd353faf40c">Therapeutic
                                                    hypothermia has other beneficial effects, including lowering
                                                    intracranial pressure, reducing excitatory neurotransmitters, and
                                                    decreasing activation of inflammatory and apoptotic pathways (eg,
                                                    blocks tumor necrosis factor and caspase pathways).</p>
<p class="" id="d8afdd2c-d29a-4ee5-bc0f-e6f0071c7c67">(Choice A) 
                                                    Therapeutic hypothermia impairs both platelets and clotting factors,
                                                    which, rather than being neuroprotective, can lead to an increased
                                                    risk of bleeding complications (eg, intracranial hemorrhage).</p>
<p class="" id="62ba3e7e-3c76-451f-8ba0-8b23a3dc8fe5">(Choice C)  In
                                                    neonates with severe hyperbilirubinemia, unbound, lipid-soluble
                                                    bilirubin can cross the blood-brain barrier.  This neurotoxic
                                                    bilirubin preferentially deposits in the basal ganglia and brainstem
                                                    nuclei, leading to permanent neurologic damage.  The primary
                                                    treatment for hyperbilirubinemia converts bilirubin to a <em>more
                                                        water-soluble form (isomers) </em>that can be excreted. 
                                                    However, this is accomplished through <em>phototherapy </em>rather
                                                    than therapeutic hypothermia.</p>
<p class="" id="d8c2656d-3c90-44a8-a1b2-bdea98e9f1cb">(Choice D)  This
                                                    patient has anion gap metabolic acidosis due to lactic acidosis
                                                    caused by tissue hypoxia.  Although the liver is responsible
                                                    primarily for clearing lactate, its rate of clearance does not seem
                                                    to be significantly impacted by therapeutic hypothermia.  Rather,
                                                    lactic acidosis typically improves after an increase in oxygenation
                                                    and the restoration of circulation.</p>
<p class="" id="4a11a1ea-9515-48ea-8b04-2fd541d78ff8">Educational
                                                    objective:</p>
<p class="" id="e8a6e6ff-4cc5-4dcb-abda-371f59e9c603">Neuronal damage
                                                    after hypoxic-ischemic injury is often related to the formation of
                                                    reactive oxygen species, which mediate widespread cellular damage. 
                                                    Therapeutic hypothermia decreases the formation of reactive oxygen
                                                    species by decreasing cellular metabolism and slowing reperfusion.
                                                </p>
<p class="" id="aba76923-ec81-4910-8b5c-01a8a0077fb9">References</p>
<ul class="bulleted-list" id="58aa62b6-ac31-4633-ba36-6c5669ae5b9d">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/21331282">Therapeutic
                                                            hypothermia: critical review of the molecular mechanisms of
                                                            action.</a></li>
</ul>
<p class="" id="5d70b156-ff0c-40c8-b3a7-519c5cb1995f">Pathophysiology
                                                </p>
<p class="" id="5e2451df-ffa0-433e-a44b-dd8a9c90cb16">Subject</p>
<p class="" id="17944a95-2b0c-4b34-8ae2-e2dbcacefc46">Nervous System</p>
<p class="" id="aebf724e-7528-4839-aad2-fb4666efe386">System</p>
<p class="" id="630bd7a8-b788-446c-985d-7a8ae1f1b30d">Anoxic brain
                                                    injury</p>
<p class="" id="c506a64a-7e38-4e64-a013-a5c6eaec6002">Topic</p>
<p class="" id="7d78d3c0-b088-49ab-b4bb-6e7433d29239">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="48bccbd8-b545-46e5-a6e0-ecd114f0ed67">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
