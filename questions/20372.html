
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>20372</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="64a64dca-ff35-43fa-888c-61f95e3e7002">A 26-year-old woman comes to
                                        the emergency department for pelvic pain and vaginal bleeding over the past 2
                                        days.  Today, the pain has increased, but she has had no nausea, vomiting, or
                                        orthostasis.  The patient was treated for chlamydia cervicitis 3 years ago.  She
                                        takes no medications and has no known drug allergies.  On pelvic examination,
                                        the uterus is small and mobile and there is left adnexal tenderness.  Pelvic
                                        ultrasound reveals a complex, 2-cm left adnexal mass with a gestational sac and
                                        yolk sac; there is no intrauterine pregnancy or free fluid.  The patient is
                                        counseled on recommended medical treatment.  Which of the following is the
                                        mechanism of action of the agent of choice for this patient?</p>
<table class="simple-table" id="c77f6ed8-447d-41c3-b0f4-2e446b678f30">
<tbody>
<tr id="ac172de9-34cb-474c-9b91-5a866e5fdd68">
<td class="" id="OSoC">A.</td>
<td class="" id="pw_`">Blocks progesterone receptors, resulting in
                                                    uterine contractions</td>
<td class="" id="F_^k"></td>
</tr>
<tr id="92312a28-302e-4192-9c40-27cc88da67fe">
<td class="" id="OSoC">B.</td>
<td class="" id="pw_`">Decreases LH secretion, causing endometrial
                                                    thinning</td>
<td class="" id="F_^k"></td>
</tr>
<tr id="38a6e834-e50f-4d55-bbea-3bac31b6edea">
<td class="" id="OSoC">C.</td>
<td class="" id="pw_`">Induces prostaglandin-mediated uterine
                                                    contractions</td>
<td class="" id="F_^k"></td>
</tr>
<tr id="d52259da-6b50-4c44-bad9-64a3738fe41f">
<td class="" id="OSoC">D.</td>
<td class="" id="pw_`">Inhibits DNA synthesis to destroy actively
                                                    proliferating fetal cells</td>
<td class="" id="F_^k"></td>
</tr>
<tr id="6de964f7-9b5a-4a5b-ad04-12aa10b84f54">
<td class="" id="OSoC">E.</td>
<td class="" id="pw_`">Produces local inflammation to impair
                                                    implantation</td>
<td class="" id="F_^k"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="e071a968-303b-4e53-b8bb-7bf99531a15d">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="49dc0a5a-93e3-4d80-8f19-5376e0e6dc3c">
<tbody>
<tr id="6de3f7ac-8e4b-46d7-8da1-387f3a8d1e78">
<td class="" id="ew\d">A.</td>
<td class="" id="]fst">Blocks progesterone receptors,
                                                                resulting in uterine contractions (8%)</td>
<td class="" id="se&lt;H"></td>
</tr>
<tr id="eacf3023-ea71-40fb-a044-e6abbff4e89b">
<td class="" id="ew\d">B.</td>
<td class="" id="]fst">Decreases LH secretion, causing
                                                                endometrial thinning (4%)</td>
<td class="" id="se&lt;H"></td>
</tr>
<tr id="d34db7e1-8ac4-4f4d-b122-94d0784d0b9b">
<td class="" id="ew\d">C.</td>
<td class="" id="]fst">Induces prostaglandin-mediated
                                                                uterine contractions (14%)</td>
<td class="" id="se&lt;H"></td>
</tr>
<tr id="d45c4fb5-9603-407b-a6f4-ce0f56e1c4f5">
<td class="" id="ew\d">D.</td>
<td class="" id="]fst">Inhibits DNA synthesis to destroy
                                                                actively proliferating fetal cells (70%)</td>
<td class="" id="se&lt;H"></td>
</tr>
<tr id="93128de3-ff55-4c01-93e3-e527759716cd">
<td class="" id="ew\d">E.</td>
<td class="" id="]fst">Produces local inflammation to impair
                                                                implantation (2%)</td>
<td class="" id="se&lt;H"></td>
</tr>
</tbody>
</table>
<p class="" id="e3892f5c-fbd6-45d8-871f-7b96a8bac81b">Incorrect</p>
<p class="" id="da3aaff4-d119-48fd-9faa-1821a5ea13ff">Correct answer D
                                                </p>
<p class="" id="41941468-af03-4c6e-b724-7c11d706e82f">70%Answered
                                                    correctly</p>
<p class="" id="daa0fa31-cad4-48bf-93d8-dcc74914d0ac">12 secsTime Spent
                                                </p>
<p class="" id="73560d3a-a38b-4a31-81d1-c22fc92d2f3f">2024Version</p>
<ul class="bulleted-list" id="807a3409-5133-4474-be59-9d694788371a">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="28366789-f9a0-4fa1-ac19-abd51f5a372f">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="ba561200-d092-4e96-ae2b-4ba0e43a3880">
<tbody>
<tr id="7f2f3621-7c6f-4a7f-9b56-a4328ccae298">
<td class="" id="?Cyj">Medications used for pregnancy
                                                                termination</td>
<td class="" id="jHU@"></td>
</tr>
<tr id="6497e84a-e943-4ca7-9c1b-35871fb275d2">
<td class="" id="?Cyj">Methotrexate</td>
<td class="" id="jHU@">‚Ä¢ Ectopic pregnancy<br/>‚Ä¢ Folic acid
                                                                antagonist (inhibits dihydrofolate reductase)<br/>‚Ä¢
                                                                Preferentially destroys proliferating fetal cells<br/>
</td>
</tr>
<tr id="a39e9708-12b4-4d41-97cd-da61b4ea2341">
<td class="" id="?Cyj">Mifepristone</td>
<td class="" id="jHU@">‚Ä¢ Abortion<br/>‚Ä¢ Partial
                                                                progesterone agonist (acts as progesterone antagonist
                                                                during pregnancy)<br/>‚Ä¢ Promotes placental separation
                                                                &amp; uterine contractions<br/></td>
</tr>
<tr id="ed769216-2438-4237-9abb-51ceea77f8ce">
<td class="" id="?Cyj">Misoprostol</td>
<td class="" id="jHU@">‚Ä¢ Abortion<br/>‚Ä¢ Prostaglandin E1
                                                                agonist<br/>‚Ä¢ Stimulates uterine contractions<br/>
</td>
</tr>
</tbody>
</table>
<p class="" id="339a9bd1-b4fb-43f2-aced-0cb1fca54f5a">This patient with
                                                    pelvic pain, vaginal bleeding, and a tender left adnexal mass
                                                    containing a gestational sac and yolk sac has an ectopic pregnancy. 
                                                    Ectopic pregnancies occur due to pregnancy implantation in an
                                                    extrauterine location, most commonly the fallopian tube.  Risk
                                                    factors include prior sexually transmitted infection (eg,
                                                    <em>Chlamydia trachomatis</em>), prior abdominal surgery, and prior
                                                    ectopic pregnancy.</p>
<p class="" id="29e96e35-d71e-4169-8615-f98c6e191399">Medical treatment
                                                    for an early, unruptured ectopic pregnancy is with methotrexate, a
                                                    folic acid antagonist.  Methotrexate works by directly competing
                                                    with folic acid to bind dihydrofolate reductase, thereby inhibiting
                                                    the formation of tetrahydrofolate.  This decrease in
                                                    tetrahydrofolate, an integral precursor to purine and pyrimidine
                                                    synthesis, inhibits DNA synthesis and cell reproduction.  The result
                                                    is preferential destruction of actively proliferating cells, such as
                                                    fetal cells and trophoblasts.</p>
<p class="" id="5edaef85-52c7-442b-a6ef-045cd6b4ad0a">(Choice A)  During
                                                    pregnancy, the uterus increases its number of progesterone receptors
                                                    so that circulating progesterone can stimulate the endometrial and
                                                    myometrial growth required for pregnancy implantation and
                                                    development.  Mifepristone, which acts as a progesterone antagonist
                                                    when progesterone levels are high, is used for medical abortion
                                                    because it causes necrosis of the uterine decidua and stimulates
                                                    uterine contractions.</p>
<p class="" id="69a77de6-b902-4fe7-85ff-f74944b19d12">(Choice B) 
                                                    Progestins (eg, levonorgestrel) thin the endometrial lining and
                                                    decrease LH secretion, thereby inhibiting ovulation and preventing
                                                    pregnancy.  They are not used in ectopic pregnancy management.</p>
<p class="" id="d42ab6d8-121e-41ee-a610-006e105aefbe">(Choice C) 
                                                    Misoprostol is a synthetic prostaglandin E1 agonist that acts on the
                                                    uterus to induce contractions; it can be used for labor induction or
                                                    medical abortion.</p>
<p class="" id="0811f4c3-42c1-4576-9cd1-d0c66c02dbd2">(Choice E) 
                                                    Copper-containing intrauterine devices produce local inflammation to
                                                    impair intrauterine implantation.  They are not used to treat
                                                    ectopic pregnancies, which have implanted outside the uterus.</p>
<p class="" id="acd694a7-61c7-48d1-930a-c7c6b61b7bdc">Educational
                                                    objective:</p>
<p class="" id="13304485-f6b1-4546-9cfa-cce5100590a6">Ectopic pregnancy
                                                    occurs due to pregnancy implantation in an extrauterine location
                                                    (eg, fallopian tube).  Medical treatment is with methotrexate, which
                                                    inhibits DNA synthesis and cell reproduction, primarily in actively
                                                    proliferating cells such as fetal cells and trophoblasts.</p>
<p class="" id="74458206-34f4-48fe-847c-f08b5996236f">References</p>
<ul class="bulleted-list" id="4ae9517c-70b7-4ba2-9b2c-4a6140ef7376">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/22510626">Medical
                                                            management of ectopic pregnancy: a comparison of
                                                            regimens.</a></li>
</ul>
<p class="" id="27f43118-fbe3-4c60-b528-5426123f239a">Pharmacology</p>
<p class="" id="bf8bc755-2393-4c4e-b265-d11809416a65">Subject</p>
<p class="" id="2a482c38-687b-4400-ac7c-f5eb37837c34">Pregnancy,
                                                    Childbirth &amp; Puerperium</p>
<p class="" id="90d932d9-a61e-4bbe-b1f4-4cf8efb75bbf">System</p>
<p class="" id="9e6b38e9-2a74-4720-b323-81962cff6005">Ectopic pregnancy
                                                </p>
<p class="" id="9cf265d1-6c2b-47f5-a554-5aea520cb015">Topic</p>
<p class="" id="3692c200-2e4f-4aea-8599-1f856f89d5a5">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="015167b8-c1a8-41a8-91cb-9a0435bf28bc">My Notebook</p>
<p class="" id="e7f14c62-8ac2-49cf-87fb-c697c112fb7e">0</p>
<p class="" id="cd08be9a-996b-40a1-bb5a-17e2eba1a342">Flashcards</p>
<p class="" id="babee748-852a-48ae-90c3-df9081af49be">Feedback</p>
<p class="" id="e41fa870-647b-4825-8ad8-597d8da9c169">Suspend</p>
<p class="" id="c7395e8e-7374-4873-82cb-2f09052bb4cf">End Block</p>
<p class="" id="4d3a1e28-5494-498d-a647-a4287b30aca4">‚ú®Done</p>
<p class="" id="ad89a1be-51a4-4af5-8938-52833aa153ca">Exhibit Display
                                                </p>
<figure class="image" id="36ce1cec-10e5-4876-bd21-bd94533c29ab"><a href="https://lh7-us.googleusercontent.com/ia4tZUWqlt9B8cXWQ-SjKtuNzX3LY1KIHjgaQcA7NLOmrbxYX7ocKB_eErlpKOPjJnghw3On9YdxEFiFl8v7hXizWN7jTzYL4oZthPNo9svSg3D7qy3rbmfr_weQAqbgqgr7YPB_qcOWmt_gJLejytQ"><img loading="lazy" src="https://lh7-us.googleusercontent.com/ia4tZUWqlt9B8cXWQ-SjKtuNzX3LY1KIHjgaQcA7NLOmrbxYX7ocKB_eErlpKOPjJnghw3On9YdxEFiFl8v7hXizWN7jTzYL4oZthPNo9svSg3D7qy3rbmfr_weQAqbgqgr7YPB_qcOWmt_gJLejytQ" style="width:602px"/></a>
</figure>
<p class="" id="44c83a4b-6442-46a9-8853-d301a3ae804b">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="e336d059-97e7-42bb-97dc-4f9404699e85">ExistingMy
                                                    Notebook</p>
<p class="" id="c2ce29d6-2c01-4161-aee6-269de4b538a4">Exhibit Display
                                                </p>
<figure class="image" id="55cb0b12-5428-45e2-a520-175649083480"><a href="https://lh7-us.googleusercontent.com/17LfT2AO5rbULepYBLzbJuCC4kKQMbmwXT5eaEBkOo5dmHWJx5idcOJ5INTCBO1Ph87u5PbhhN5jVz3rYPWf_6_Fn1sADBoboqxp4t9ZdfHU2_NWVkQTuxEmgzRfQWrQtT1aHmBqCA0F78L9EjI1-G4"><img loading="lazy" src="https://lh7-us.googleusercontent.com/17LfT2AO5rbULepYBLzbJuCC4kKQMbmwXT5eaEBkOo5dmHWJx5idcOJ5INTCBO1Ph87u5PbhhN5jVz3rYPWf_6_Fn1sADBoboqxp4t9ZdfHU2_NWVkQTuxEmgzRfQWrQtT1aHmBqCA0F78L9EjI1-G4" style="width:602px"/></a>
</figure>
<p class="" id="48b092dd-e248-4ecd-b503-843083ae4fe5">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="f1a03cad-288d-4abe-b705-ec0841f786c6">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
