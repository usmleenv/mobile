
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>21458</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="92d97ea4-56cb-4ebb-ba26-d883b48578ca">An investigator studies the
                                        effects of 2 different medications on the heart rate of patients with persistent
                                        atrial fibrillation.  After participants receive therapeutic doses of medication
                                        for several days, their heart rates are measured for 24 hours at rest and during
                                        10 minutes of moderate exercise.  The results are compared against placebo and
                                        shown in the graphs below.  Which of the following medications is most likely
                                        represented by the red line (drug 1)?</p>
<figure class="image" id="03a136b9-aeea-46c4-9a18-50ea6fe80901"><a href="https://lh7-us.googleusercontent.com/Jx9qk4dlAZyFm5fPGgkbwkK8ufyLFw3-PC3WEAdognGsSjHE_f6bXX54Kjpsy33yRbWWqLWUv7wzViPhbZTUDW-wh_lM09wdUfxAjqJjn7vuCiqe7429yLB1ritCyhBYq_nRhNO5mDWdAJM2nrwZZXE"><img loading="lazy" src="https://lh7-us.googleusercontent.com/Jx9qk4dlAZyFm5fPGgkbwkK8ufyLFw3-PC3WEAdognGsSjHE_f6bXX54Kjpsy33yRbWWqLWUv7wzViPhbZTUDW-wh_lM09wdUfxAjqJjn7vuCiqe7429yLB1ritCyhBYq_nRhNO5mDWdAJM2nrwZZXE" style="width:602px"/></a>
</figure>
<table class="simple-table" id="46642295-9806-48da-a5ed-54c726692f03">
<tbody>
<tr id="9d4f022e-7025-44b8-9b33-36beb9ef50e8">
<td class="" id="e?H~">A.</td>
<td class="" id="zyJr">Amlodipine</td>
<td class="" id="\xO["></td>
</tr>
<tr id="d3a8f66a-91a4-4713-af01-5f854c55fdcc">
<td class="" id="e?H~">B.</td>
<td class="" id="zyJr">Atenolol</td>
<td class="" id="\xO["></td>
</tr>
<tr id="8aeaae72-6b78-4859-9c85-2f2e22dc0f3c">
<td class="" id="e?H~">C.</td>
<td class="" id="zyJr">Digoxin</td>
<td class="" id="\xO["></td>
</tr>
<tr id="241f341f-9a61-4eb3-a8ae-47ba6fff83f8">
<td class="" id="e?H~">D.</td>
<td class="" id="zyJr">Lisinopril</td>
<td class="" id="\xO["></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="e00392f1-acb8-420f-911e-a990d81a7725">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="9b170810-0427-4edf-8000-d22f26b2925a">
<tbody>
<tr id="2de8f9e9-e121-4c30-8d6e-0e0f353f8f26">
<td class="" id="Tta\">A.</td>
<td class="" id="\I?[">Amlodipine (19%)</td>
<td class="" id="r=:e"></td>
</tr>
<tr id="3f42baa8-f618-43e2-a144-5039826ccc9a">
<td class="" id="Tta\">B.</td>
<td class="" id="\I?[">Atenolol (35%)</td>
<td class="" id="r=:e"></td>
</tr>
<tr id="38d63615-5e69-40aa-96ca-a7391ff28667">
<td class="" id="Tta\">C.</td>
<td class="" id="\I?[">Digoxin (36%)</td>
<td class="" id="r=:e"></td>
</tr>
<tr id="a918e737-deed-41ab-aac3-11235c3c4d99">
<td class="" id="Tta\">D.</td>
<td class="" id="\I?[">Lisinopril (8%)</td>
<td class="" id="r=:e"></td>
</tr>
</tbody>
</table>
<p class="" id="98384fda-4154-4968-898b-6a21d3c793ea">Correct</p>
<p class="" id="374e5c40-f898-43a6-a93d-1ae0da5243d9">36%Answered
                                                    correctly</p>
<p class="" id="61e3d5d5-7b96-4bca-930f-ed1596a19d9f">15 secsTime Spent
                                                </p>
<p class="" id="c9617658-be90-49a4-bef3-f1b5cf15c4af">2024Version</p>
<ul class="bulleted-list" id="25c0e9ef-f111-4849-abd0-983c4d11cfa2">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="25c7599d-3160-4e8b-ae3f-b02630ff255d">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="575aa3ed-d985-4cf8-8685-51493d34a5f2"><a href="https://lh7-us.googleusercontent.com/z0s7PmXjvwq-zv2TQn2XF1lETx4XVFnHKxFdb6vnJrtyRdkDE7vXuSutZJFuEj0wFWy4EurtikFcFqVmhOsrRDf_D23GtAq7J9OPugi7IUzTsaFWZ6Qq-TxNfRSt6zRW5hKFmDIHRpyavMRlxqzbThQ"><img loading="lazy" src="https://lh7-us.googleusercontent.com/z0s7PmXjvwq-zv2TQn2XF1lETx4XVFnHKxFdb6vnJrtyRdkDE7vXuSutZJFuEj0wFWy4EurtikFcFqVmhOsrRDf_D23GtAq7J9OPugi7IUzTsaFWZ6Qq-TxNfRSt6zRW5hKFmDIHRpyavMRlxqzbThQ" style="width:602px"/></a>
</figure>
<p class="" id="59b4d38d-a09b-4a18-8608-31b7f71dc3be">Persistent atrial
                                                    fibrillation is usually managed with a rate-control strategy that
                                                    focuses on maintaining an acceptable ventricular contraction rate
                                                    during both rest (eg, &lt;85/min) and moderate exercise (eg,
                                                    &lt;110-120/min) despite continued rapid and disorganized conduction
                                                    of the atria.  Pharmacologic agents that allow for rate control do
                                                    so by slowing conduction through the atrioventricular (AV) node via
                                                    various mechanisms:</p>
<ul class="bulleted-list" id="4d1de025-f03e-4926-a1c7-bafda24165e7">
<li style="list-style-type:disc">Beta blockers (eg, atenolol,
                                                        metoprolol) (Choice B) slow AV node conduction via blockade of
                                                        sympathetic tone. This mechanism allows for effective rate
                                                        control both during rest and exercise. For this reason, beta
                                                        blockers are often the preferred agent for rate control of
                                                        atrial fibrillation.</li>
</ul>
<ul class="bulleted-list" id="0384937e-3821-4bdd-9658-13a2a23bc480">
<li style="list-style-type:disc">Nondihydropyridine calcium channel
                                                        blockers (eg, verapamil, diltiazem) block AV nodal calcium
                                                        channels to slow AV node conduction both at rest and during
                                                        exercise. These drugs have similar rate control efficacy to that
                                                        of beta blockers, although beta blockers are slightly superior
                                                        at controlling heart rate during exercise.</li>
</ul>
<ul class="bulleted-list" id="a6d7b415-ce55-4c44-ac62-25e68e00888c">
<li style="list-style-type:disc">Digoxin slows AV node conduction
                                                        via increased parasympathetic tone. This mechanism is effective
                                                        at rest, when sympathetic tone is low, but it poorly controls
                                                        ventricular rate during exercise, when high levels of
                                                        sympathetic tone accelerate AV node conduction. For this reason,
                                                        digoxin is often used only as an adjunctive agent for rate
                                                        control in atrial fibrillation.</li>
</ul>
<p class="" id="e1bfe856-1c4b-447c-bb12-acf58ef920e0">(Choices A and D) 
                                                    Dihydropyridine calcium channel blockers (eg, amlodipine,
                                                    nifedipine) and ACE inhibitors (eg, lisinopril) are vasodilators
                                                    with no significant effect on the AV node.  These drugs are not
                                                    expected to slow heart rate either at rest or with exercise (ie,
                                                    both resting and exercise curves are expected to closely match
                                                    placebo).</p>
<p class="" id="dee075e7-4a72-4b3a-a7b3-db92231a709a">Educational
                                                    objective:</p>
<p class="" id="a06550db-5ec3-4b7d-9a82-dcde0d7231fb">Digoxin slows
                                                    atrioventricular node conduction by increasing parasympathetic
                                                    tone.  This mechanism is effective at controlling ventricular rate
                                                    in atrial fibrillation at rest, but it poorly controls ventricular
                                                    rate during exercise, when parasympathetic output is low relative to
                                                    high levels of sympathetic tone.</p>
<p class="" id="8b36526b-b865-444c-8014-cfd8c5a3e4cc">Pharmacology</p>
<p class="" id="c7894ff8-5ae8-43bf-b422-9e3b75b44cf3">Subject</p>
<p class="" id="888f24b6-198d-443a-a651-1720c73fe507">Cardiovascular
                                                    System</p>
<p class="" id="0fda1017-188c-46d3-a5ca-7b55a1a766b3">System</p>
<p class="" id="b3116fd2-3263-4ab8-a1dd-e7cb24c851cc">Atrial
                                                    fibrillation</p>
<p class="" id="4f91640a-90c5-4822-ad1e-295c9e795184">Topic</p>
<p class="" id="a7a2fc88-871f-40e4-a402-b0128768cf4c">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
