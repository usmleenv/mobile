
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>394</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="6870d232-1ac5-4faa-8623-f0d3d8b92276">A 42-year-old man comes to the
                                        emergency department after a syncopal episode preceded by palpitations and
                                        lightheadedness.  The patient has no significant medical history and takes no
                                        medications.  He does not use tobacco, alcohol, or illicit drugs.  The patient
                                        is a computer programmer and spends most of his time indoors.  Vital signs are
                                        within normal limits with no orthostatic changes.  Heart and lung sounds are
                                        normal.  The liver span is increased with no tenderness.  The skin appears
                                        darkly tanned.  ECG demonstrates sinus node dysfunction, and echocardiography
                                        reveals abnormal diastolic relaxation of the left ventricle.  Which of the
                                        following is the most likely cause of this patient's condition?</p>
<table class="simple-table" id="40c94bc1-6502-4b27-a882-5c3627a5135e">
<tbody>
<tr id="74dba0d5-ea89-45de-9fbe-af327fbd8d2c">
<td class="" id="~KrM">A.</td>
<td class="" id="jH\`">Amyloid deposition</td>
<td class="" id="r[lY"></td>
</tr>
<tr id="49c98187-dcc3-4cf9-8557-3eeb53346c43">
<td class="" id="~KrM">B.</td>
<td class="" id="jH\`">Cortisol deficiency</td>
<td class="" id="r[lY"></td>
</tr>
<tr id="18809032-2c67-4e99-8609-860d4c9bfabc">
<td class="" id="~KrM">C.</td>
<td class="" id="jH\`">Granuloma formation</td>
<td class="" id="r[lY"></td>
</tr>
<tr id="c8e745ec-5364-479e-a302-9f4d3df8d762">
<td class="" id="~KrM">D.</td>
<td class="" id="jH\`">Human leukocyte antigen gene mutation</td>
<td class="" id="r[lY"></td>
</tr>
<tr id="3b27dde3-eff1-4299-816f-083f3d767821">
<td class="" id="~KrM">E.</td>
<td class="" id="jH\`">Iron accumulation</td>
<td class="" id="r[lY"></td>
</tr>
<tr id="6105da45-d31a-4380-998b-d72d9dbc8853">
<td class="" id="~KrM">F.</td>
<td class="" id="jH\`">Lysosomal glycogen accumulation</td>
<td class="" id="r[lY"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="c479cead-939c-444c-8e87-5542d4cc907d">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="6837cfce-1686-4fde-9274-48f14f53b59c">
<tbody>
<tr id="00c6b3b2-2896-463f-9893-f35b44e1eb3b">
<td class="" id="jm\B">A.</td>
<td class="" id="`It}">Amyloid deposition (11%)</td>
<td class="" id="jV`v"></td>
</tr>
<tr id="644de044-bd7b-4d1c-a52e-0a772b295ffb">
<td class="" id="jm\B">B.</td>
<td class="" id="`It}">Cortisol deficiency (10%)</td>
<td class="" id="jV`v"></td>
</tr>
<tr id="25f3846f-4c35-4167-a8af-8eeb64bfde6b">
<td class="" id="jm\B">C.</td>
<td class="" id="`It}">Granuloma formation (1%)</td>
<td class="" id="jV`v"></td>
</tr>
<tr id="df0e1a5a-0217-4482-8eb5-82894d37b278">
<td class="" id="jm\B">D.</td>
<td class="" id="`It}">Human leukocyte antigen gene mutation
                                                                (1%)</td>
<td class="" id="jV`v"></td>
</tr>
<tr id="7f34fd14-1d2f-4056-98bb-2e0a797ccf8d">
<td class="" id="jm\B">E.</td>
<td class="" id="`It}">Iron accumulation (71%)</td>
<td class="" id="jV`v"></td>
</tr>
<tr id="f1b47eb0-098c-469d-8410-5a93fc0e3991">
<td class="" id="jm\B">F.</td>
<td class="" id="`It}">Lysosomal glycogen accumulation (4%)
                                                            </td>
<td class="" id="jV`v"></td>
</tr>
</tbody>
</table>
<p class="" id="e873345c-b4e2-4381-8dc2-3024f8dee164">Omitted</p>
<p class="" id="ad854074-8129-4821-bda1-382358725e92">Correct answer E
                                                </p>
<p class="" id="2d34b4f8-58fa-43e8-b75d-55a84e0ecdd1">71%Answered
                                                    correctly</p>
<p class="" id="a1ebcdc6-f106-414f-8d7e-fc81b2adbf68">0 secsTime Spent
                                                </p>
<p class="" id="33605564-9945-4c68-93f5-1253f5c7bdc4">2024Version</p>
<ul class="bulleted-list" id="195dc882-c1ab-4860-abe0-949da4eb0ee4">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="7cc26c1d-9713-41ee-baad-6295a17d987c">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="b67c6e46-ce4f-4759-9c55-c331ea3d09c3">
<tbody>
<tr id="b81904f4-b79e-428c-9744-28c2f509d490">
<td class="" id="GHiV">Cardiac hemochromatosis</td>
<td class="" id="L\|Z"></td>
</tr>
<tr id="b53932a9-34c6-45ae-80ed-ac127ae7c2af">
<td class="" id="GHiV">Pathophysiology</td>
<td class="" id="L\|Z">‚Ä¢ Excess intestinal iron
                                                                absorption<br/>‚Ä¢ Deposition of iron (ferritin,
                                                                hemosiderin, free iron) in myocardium<br/>‚Ä¢ Oxidative
                                                                injury to myocytes<br/></td>
</tr>
<tr id="5d511d00-7372-483c-89e9-866d5a9a6e9f">
<td class="" id="GHiV">Cardiomyopathy</td>
<td class="" id="L\|Z">‚Ä¢ Early: diastolic left ventricular
                                                                dysfunction (restrictive pattern)<br/>‚Ä¢ Later: cardiac
                                                                remodeling &amp; dilated cardiomyopathy<br/></td>
</tr>
<tr id="7d0748e4-786f-40ca-8c99-185d087e77b7">
<td class="" id="GHiV">Conduction<br/>system disease<br/>
</td>
<td class="" id="L\|Z">‚Ä¢ Sinus node dysfunction (sick sinus
                                                                syndrome)<br/>‚Ä¢ Atrial &amp; ventricular
                                                                arrhythmias<br/>‚Ä¢ Sudden cardiac death<br/></td>
</tr>
</tbody>
</table>
<p class="" id="4e05e0db-381a-41bd-b083-6c4bc81b6fcf">This patient has
                                                    syncope associated with diastolic dysfunction, hepatomegaly, and
                                                    skin hyperpigmentation.  This presentation is suggestive of
                                                    hereditary hemochromatosis (HH), an autosomal recessive disorder
                                                    characterized by excessive intestinal iron absorption with
                                                    accumulation of the excess iron in parenchymal tissues.</p>
<p class="" id="eb2bdb06-fe43-4ad6-a19d-606367393562">Cardiac
                                                    manifestations of HH include heart failure and conduction system
                                                    disease.  In early stages, myocardial iron overload is expressed as
                                                    diastolic left ventricular (LV) dysfunction with a restrictive
                                                    filling pattern.  As the disease advances, progressive ventricular
                                                    remodeling leads to dilated cardiomyopathy and reduced LV ejection
                                                    fraction.  Iron deposition can also affect the cardiac conduction
                                                    system.  Sinus node dysfunction (ie, sick sinus syndrome) can lead
                                                    to presyncope or syncope; malignant arrhythmias with sudden cardiac
                                                    death occasionally occur.</p>
<p class="" id="fc6c8827-e35c-457b-af75-fa8f4370c1b8">On light
                                                    microscopy, cardiac hemochromatosis is visible as brown, granular
                                                    deposits (arrow) in myocytes that stain strongly with Prussian
                                                    blue.  Cardiomyopathy can be the first presenting manifestation of
                                                    HH, although careful assessment can usually find evidence of iron
                                                    deposition elsewhere (eg, elevated hepatic transaminases,
                                                    hepatomegaly).  Treatment includes therapeutic phlebotomy to remove
                                                    excess iron stores, which can lead to regression of cardiomyopathy
                                                    in some patients.</p>
<p class="" id="f69a369f-7417-46cf-be76-60cc877830ef">(Choice A) 
                                                    Amyloidosis is caused by extracellular deposition of misfolded
                                                    amyloid proteins.  Multiorgan involvement (eg, cardiomyopathy,
                                                    hepatomegaly) is common, but amyloidosis frequently involves the
                                                    kidney (eg, nephrotic syndrome), nerves (eg, neuropathy), and
                                                    muscles (eg, macroglossia).  It is not associated with
                                                    hyperpigmentation.</p>
<p class="" id="2141dcef-b280-4d1e-9d0c-a1971c15e476">(Choice B) 
                                                    Primary adrenal insufficiency (ie, cortisol deficiency) can cause
                                                    hyperpigmentation due to cosecretion of melanocyte-stimulating
                                                    hormone with ACTH (both derived from proopiomelanocortin).  However,
                                                    hepatomegaly is not seen, and although hypotension is common, sinus
                                                    node and diastolic dysfunction are not.</p>
<p class="" id="8a06904e-3dec-4926-8e47-f46a308363cf">(Choice C) 
                                                    Sarcoidosis results from widespread formation of noncaseating
                                                    granulomas.  Cardiac infiltration can cause conduction blockade, and
                                                    liver involvement may result in hepatomegaly.  However, lung
                                                    symptoms (eg, dyspnea, cough) are more common, and skin
                                                    manifestations include papules and nodules rather than
                                                    hyperpigmentation.</p>
<p class="" id="e93be627-1103-4415-a137-3dddfd5ab2ae">(Choice D)  HH is
                                                    associated with mutations in the <em>HFE</em> gene; the HFE protein
                                                    binds to the transferrin receptor and regulates intestinal and
                                                    hepatic iron uptake.  Human leukocyte antigen (HLA) mutations are
                                                    associated with autoimmune disorders (eg, celiac disease, type 1
                                                    diabetes).</p>
<p class="" id="9dcdf57d-5d48-4428-8b53-ad5f92463bae">(Choice F) 
                                                    Glycogen storage disease type II (ie, Pompe disease) is caused by a
                                                    deficiency in alpha-glucosidase (acid maltase).  It manifests
                                                    shortly after birth with hypertrophic cardiomyopathy, hepatomegaly,
                                                    muscle weakness, and failure to thrive.  Skin hyperpigmentation is
                                                    not typical.</p>
<p class="" id="fb2793b1-09b2-4cd3-ac68-3ab220a7e47b">Educational
                                                    objective:</p>
<p class="" id="80dcd7b5-5457-4cb3-a6ef-d585ef108d9b">Hereditary
                                                    hemochromatosis is characterized by excessive intestinal iron
                                                    absorption with deposition of iron in parenchymal tissues.  Cardiac
                                                    manifestations include diastolic dysfunction (initial), dilated
                                                    cardiomyopathy (later), and conduction system disease (eg, sinus
                                                    node dysfunction).</p>
<p class="" id="01b48a5b-0ad2-4d0b-9507-4dc3b1de4df3">Pathology</p>
<p class="" id="f082ff45-74f8-4ca8-a582-5c3b528e437c">Subject</p>
<p class="" id="56f64a9f-17bb-4fd6-b7f1-5670d23819cb">Cardiovascular
                                                    System</p>
<p class="" id="90506c53-ce55-4e2d-be77-684ad094385d">System</p>
<p class="" id="ae40406b-952a-41a9-8ca1-c3409bfbf489">Hemochromatosis
                                                </p>
<p class="" id="e0911fdc-af09-4055-b7f9-13039300788a">Topic</p>
<p class="" id="470995f1-c4e8-46ae-bd35-39eaafa40904">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="b8b2a0c8-2e6b-41d7-8606-a1c637b863c0">REVIEW</p>
<p class="" id="2014a8b1-fde4-4a28-9ff2-cf4e9bca0711">My Notebook</p>
<p class="" id="279ffc8e-f7b6-4980-a4b2-97babbe42e9a">0</p>
<p class="" id="ba894f87-5691-4c17-a462-21272a5e573c">Flashcards</p>
<p class="" id="1b508e70-f210-43ea-8e64-42681c811713">Feedback</p>
<p class="" id="e1e64a97-e2cd-4fb0-9f59-69384eb6c3a6">End Block</p>
<p class="" id="4eb99871-9d4e-4141-a43a-b5df710dbe43">‚ú®Done</p>
<p class="" id="9f41f70f-03ca-4f1c-a8d0-910ddb47e664">Exhibit Display
                                                </p>
<figure class="image" id="eed1749c-e7f0-4c87-bc0c-1bb20d3eef93"><a href="https://lh7-us.googleusercontent.com/cs2nZUFMX8qAnlpjQcAVWcP9rlBBpf4cTRxBdXxzgoaOVp7hjNzEkomr1L0HD6bl67URnfb4Xs-2j95vXlB1RSdjP3vqSfwzWou09zFpNJS0BN997GYNduQYniWd0Se0tqsjsofmMWiUar4f8y6Crq4"><img loading="lazy" src="https://lh7-us.googleusercontent.com/cs2nZUFMX8qAnlpjQcAVWcP9rlBBpf4cTRxBdXxzgoaOVp7hjNzEkomr1L0HD6bl67URnfb4Xs-2j95vXlB1RSdjP3vqSfwzWou09zFpNJS0BN997GYNduQYniWd0Se0tqsjsofmMWiUar4f8y6Crq4" style="width:602px"/></a>
</figure>
<p class="" id="162eca3b-a25f-42ab-b1de-c84b3f256b03">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="2b6f115e-cdf1-4a52-8163-aa34f7072761">ExistingMy
                                                    Notebook</p>
<p class="" id="01c6916e-6162-4fda-8c30-df3176c99e29">Exhibit Display
                                                </p>
<figure class="image" id="495ca259-7b4f-4079-bd2b-2daa2d2dd3b5"><a href="https://lh7-us.googleusercontent.com/TTzOACOcEm4h8q0F_HjKOFIT5FvIPMYO7cofpAXfwuGGL22nLqIRID97e-AuqB2u2JAIdvy9MSE0W2oza0LvP8TCv6GWkZ9q0bpx4AHmOkpfLEaj4Z3tul4IgMoy_YBt4iBl9-N_5OtwQw9SUOu1jvk"><img loading="lazy" src="https://lh7-us.googleusercontent.com/TTzOACOcEm4h8q0F_HjKOFIT5FvIPMYO7cofpAXfwuGGL22nLqIRID97e-AuqB2u2JAIdvy9MSE0W2oza0LvP8TCv6GWkZ9q0bpx4AHmOkpfLEaj4Z3tul4IgMoy_YBt4iBl9-N_5OtwQw9SUOu1jvk" style="width:602px"/></a>
</figure>
<p class="" id="3cc83f62-d227-4947-b07e-426fdbd40a10">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="2d8af103-b3ff-4abe-98ba-4153c4381d97">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
