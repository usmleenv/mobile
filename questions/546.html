
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>546</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="b775cb1b-496e-4187-acc5-8740ddfef340">A 44-year-old man with
                                        diabetic nephropathy undergoes a renal transplant.  One week later, he develops
                                        low-grade fever, body aches, and decreased urine output.  Temperature is 37.2 C
                                        (99 F), blood pressure is 124/76 mm Hg, and pulse is 88/min.  Physical
                                        examination shows mild tenderness over the graft on palpation.  Serum creatinine
                                        is 2.2 mg/dL, an increase from 1.2 mg/dL two days ago.  Arterial and venous
                                        Doppler studies reveal adequate graft perfusion.  Graft biopsy demonstrates
                                        dense interstitial infiltration by mononuclear cells.  Which of the following is
                                        the most likely cause of this patient's current condition?</p>
<table class="simple-table" id="0ec7ae69-6b75-452a-8e43-746b479ea2e5">
<tbody>
<tr id="c6667ac9-4612-4311-9cbc-4bad502fd1d9">
<td class="" id="veeN">A.</td>
<td class="" id="eJ&gt;I">Graft B-cell sensitization against host MHC
                                                    antigens</td>
<td class="" id="GNMq"></td>
</tr>
<tr id="ae64016d-59d5-4212-b791-f04747402cf4">
<td class="" id="veeN">B.</td>
<td class="" id="eJ&gt;I">Graft T-cell sensitization against host MHC
                                                    antigens</td>
<td class="" id="GNMq"></td>
</tr>
<tr id="9894df61-7583-4a53-b944-24781f0d8250">
<td class="" id="veeN">C.</td>
<td class="" id="eJ&gt;I">Host B-cell sensitization against graft MHC
                                                    antigens</td>
<td class="" id="GNMq"></td>
</tr>
<tr id="af849ebd-ecbc-4033-b5b3-6c5451918185">
<td class="" id="veeN">D.</td>
<td class="" id="eJ&gt;I">Host T-cell sensitization against graft MHC
                                                    antigens</td>
<td class="" id="GNMq"></td>
</tr>
<tr id="5eb36d60-a3fe-477a-95a8-2a9c5f6b14a2">
<td class="" id="veeN">E.</td>
<td class="" id="eJ&gt;I">Preformed antibodies against graft ABO
                                                    antigens</td>
<td class="" id="GNMq"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="606481e5-eaab-48cc-9049-75dfef4c6809">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="2bd9218d-c025-431c-bce7-9602354e7334">
<tbody>
<tr id="7b3a66e4-abbb-4586-8a78-e3acf5b1feda">
<td class="" id="t}Yp">A.</td>
<td class="" id="cW`=">Graft B-cell sensitization against
                                                                host MHC antigens (2%)</td>
<td class="" id="_Xm}"></td>
</tr>
<tr id="750f6dd9-5443-49be-8bd4-a0ae7e3169eb">
<td class="" id="t}Yp">B.</td>
<td class="" id="cW`=">Graft T-cell sensitization against
                                                                host MHC antigens (16%)</td>
<td class="" id="_Xm}"></td>
</tr>
<tr id="800dd43a-0775-4865-ba15-887dfc10b9f0">
<td class="" id="t}Yp">C.</td>
<td class="" id="cW`=">Host B-cell sensitization against
                                                                graft MHC antigens (12%)</td>
<td class="" id="_Xm}"></td>
</tr>
<tr id="4106e212-15d4-4cce-9d88-04d4df07a4e3">
<td class="" id="t}Yp">D.</td>
<td class="" id="cW`=">Host T-cell sensitization against
                                                                graft MHC antigens (66%)</td>
<td class="" id="_Xm}"></td>
</tr>
<tr id="4c28e286-c0a4-49eb-a596-7f4714a8e94e">
<td class="" id="t}Yp">E.</td>
<td class="" id="cW`=">Preformed antibodies against graft
                                                                ABO antigens (2%)</td>
<td class="" id="_Xm}"></td>
</tr>
</tbody>
</table>
<p class="" id="442b0453-c564-469d-a714-27a2d69775c2">Incorrect</p>
<p class="" id="78d1a168-752e-447d-b701-a4561c652300">Correct answer D
                                                </p>
<p class="" id="6b5ab23a-d03e-40a9-8a14-f740980babed">66%Answered
                                                    correctly</p>
<p class="" id="2ebc9d4b-fb69-45c6-82f3-63181e3bac88">12 secsTime Spent
                                                </p>
<p class="" id="d0730eab-e8d5-4297-bf10-695c3489e901">2024Version</p>
<ul class="bulleted-list" id="7b47d212-fe9f-4ad7-a530-01d50786a47d">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="bc4dc571-e2a2-43e1-a217-e35528a3f5f2">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="799e3b17-abf9-4024-a2c9-37b05e4080f1">
<tbody>
<tr id="63a74210-cb7a-4d5c-988c-b48a8fdfa78a">
<td class="" id="{W\N">Transplant rejection reactions</td>
<td class="" id="CKAk"></td>
<td class="" id="qm]V"></td>
<td class="" id="sMKB"></td>
</tr>
<tr id="5903feca-f1b6-4bd7-a988-b2193cc3a572">
<td class="" id="{W\N">Type of rejection</td>
<td class="" id="CKAk">Onset time</td>
<td class="" id="qm]V">Etiology</td>
<td class="" id="sMKB">Morphology</td>
</tr>
<tr id="f10e5080-0665-4f0e-8b3b-09343216123e">
<td class="" id="{W\N">Hyperacute</td>
<td class="" id="CKAk">Minutes to hours</td>
<td class="" id="qm]V">‚Ä¢ Preformed recipient antibodies
                                                                against graft antigens</td>
<td class="" id="sMKB">‚Ä¢ Gross mottling &amp;
                                                                cyanosis<br/>‚Ä¢ Arterial fibrinoid necrosis &amp;
                                                                capillary thrombotic occlusion<br/></td>
</tr>
<tr id="61d2f65f-82af-4691-bee7-3098a284992e">
<td class="" id="{W\N">Acute</td>
<td class="" id="CKAk">Usually &lt;6 months</td>
<td class="" id="qm]V">‚Ä¢ Exposure to donor antigens induces
                                                                activation of naive immune cells <br/>‚Ä¢ Predominantly
                                                                cell-mediated<br/></td>
<td class="" id="sMKB">‚Ä¢ Cellular: lymphocytic interstitial
                                                                infiltrate &amp; endotheliitis<br/>‚Ä¢ Humoral: C4d
                                                                deposition, neutrophilic infiltrate, necrotizing
                                                                vasculitis<br/></td>
</tr>
<tr id="391426f6-72fb-4c6d-aaf9-28a46c7e4199">
<td class="" id="{W\N">Chronic</td>
<td class="" id="CKAk">Months to years</td>
<td class="" id="qm]V">‚Ä¢ Chronic low-grade immune response
                                                                refractory to immunosuppression<br/>‚Ä¢ Mixed
                                                                cell-mediated and humoral<br/></td>
<td class="" id="sMKB">‚Ä¢ Vascular wall thickening &amp;
                                                                luminal narrowing<br/>‚Ä¢ Interstitial fibrosis &amp;
                                                                parenchymal atrophy<br/></td>
</tr>
</tbody>
</table>
<p class="" id="0322e53f-5aac-4387-8aa9-2adbdf4a29b9">This patient with
                                                    impaired renal function within the first few weeks following renal
                                                    transplant likely has acute rejection.  This process is mostly
                                                    cell-mediated and results from sensitization of recipient T cells to
                                                    donor graft MHC antigens (human leukocyte antigens).  Humoral
                                                    (antibody-mediated) immunity may also be involved in acute
                                                    rejection, but it typically plays a smaller role.</p>
<p class="" id="604667ae-0887-44b4-8112-112e16ddf9d5">Acute rejection
                                                    usually occurs within the first 6 months following transplantation. 
                                                    Patients often have an asymptomatic rise in serum creatinine, but
                                                    they may also have low-grade fever, malaise, joint pains, and graft
                                                    tenderness.  Histology reveals a dense lymphocytic infiltrate
                                                    sometimes accompanied by vascular inflammation.  Acute rejection is
                                                    typically reversible and usually treated with high-dose
                                                    glucocorticoids.  Chronic immunosuppression with a calcineurin
                                                    inhibitor‚Äìbased regimen (eg, tacrolimus plus mycophenolate and
                                                    low-dose prednisone) helps prevent acute rejection episodes.</p>
<p class="" id="eda59958-eaa5-49c3-9cee-0dae209e6eb8">(Choices A and B) 
                                                    Graft versus host disease (GVHD) primarily involves activation of
                                                    donor T cells within grafted tissue against recipient (host)
                                                    antigens.  B cells are also involved to a lesser extent.  GVHD
                                                    typically occurs only when the recipient lacks a competent immune
                                                    response (eg, in the setting of bone marrow transplant).</p>
<p class="" id="18bdc1ce-e4db-4038-b381-040897e6da07">(Choice C)  Host
                                                    B-cell sensitization against donor antigens results in a humoral
                                                    antibody response and is sometimes involved in acute rejection. 
                                                    Histology is expected to show deposition of complement (eg, C4d),
                                                    neutrophilic infiltrate, and necrotizing vasculitis; this
                                                    patient's mononuclear (lymphocytic) infiltrate is consistent
                                                    with a cell-mediated T-cell response.  Although it can occur
                                                    acutely, the humoral response tends to be more involved in chronic
                                                    rejection, which occurs months to years following transplant.</p>
<p class="" id="e9724fa8-91ce-4581-815b-5cb1b8cc1973">(Choice E) 
                                                    Preformed antibodies against graft ABO or other antigens can lead to
                                                    hyperacute graft rejection.  Because the antibodies are already
                                                    present in the recipient circulation, there is rapid response
                                                    against the donor graft, leading to arterial fibrinoid necrosis and
                                                    vascular thrombosis with graft mottling and cyanosis.  Thorough
                                                    crossmatching prior to transplant makes hyperacute rejection a rare
                                                    occurrence.</p>
<p class="" id="f8e05668-30ba-4e9c-ba90-225d5761e218">Educational
                                                    objective:</p>
<p class="" id="36148b22-e0fe-42c4-86c1-760e9c8c7df8">Organ rejection
                                                    can be hyperacute, acute, or chronic.  Acute rejection most often
                                                    occurs within weeks or up to 6 months after transplant and is
                                                    predominantly cell-mediated, involving sensitization of host T
                                                    lymphocytes against donor MHC antigens.  There is typically graft
                                                    dysfunction with histology showing a dense, mononuclear (ie,
                                                    lymphocytic) infiltrate.</p>
<p class="" id="14779e76-c101-4a3e-b1b0-f7c252ff41e1">Immunology</p>
<p class="" id="4247fe17-5070-40bc-be21-c742b619da94">Subject</p>
<p class="" id="da701692-5bcf-42b8-8c2f-5339a6b3a21d">Allergy &amp;
                                                    Immunology</p>
<p class="" id="47f694b5-9e2a-42d9-84a6-38ea10cb3b70">System</p>
<p class="" id="b8191223-3b8a-4e3c-bdd9-9262faa2576e">Transplant
                                                    rejection</p>
<p class="" id="8f87eb3c-6737-4b85-b7c6-d625357b7b72">Topic</p>
<p class="" id="244b0eee-cbec-4e4a-a210-5279d36bf8bc">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
