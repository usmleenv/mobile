
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>631</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="87c83aa1-8dc9-487b-b298-8bfa43c13173">A 46-year-old woman is
                                        hospitalized for recurrent renal colic.  She has passed 2 urinary stones during
                                        the last 2 years.  The most recent stone contained 80% calcium phosphate and 20%
                                        calcium oxalate.  The patient also has diffuse aches and pains and has a history
                                        of peptic ulcer disease, for which she takes famotidine daily.  Laboratory
                                        results are as follows:</p>
<table class="simple-table" id="506d1c9d-6ee3-4d16-b41a-a0edba6893f2">
<tbody>
<tr id="4d5646ac-210e-442e-98c2-3f21479fc7c4">
<td class="" id="Lej}">Serum sodium</td>
<td class="" id="Q?{u">140 mEq/L</td>
</tr>
<tr id="90fb3cae-edc0-424c-a727-1228afc8ccd1">
<td class="" id="Lej}">Serum potassium</td>
<td class="" id="Q?{u">4.0 mEq/L</td>
</tr>
<tr id="21821f31-067a-4d16-a1d5-5fb8d18b2188">
<td class="" id="Lej}">Serum chloride</td>
<td class="" id="Q?{u">103 mEq/L</td>
</tr>
<tr id="aa5c8bfe-d740-4654-bb15-428c42fd159d">
<td class="" id="Lej}">Serum creatinine</td>
<td class="" id="Q?{u">0.8 mg/dL</td>
</tr>
<tr id="45174c6c-25b0-4fca-ac45-1e8fca1f9d8d">
<td class="" id="Lej}">Serum calcium</td>
<td class="" id="Q?{u">12.0 mg/dL</td>
</tr>
<tr id="5e929d94-f763-406c-8d36-b7a77f655905">
<td class="" id="Lej}">Serum phosphorus</td>
<td class="" id="Q?{u">2.4 mg/dL</td>
</tr>
<tr id="52295b50-afa8-417a-b05e-39d9f4c98e93">
<td class="" id="Lej}">24-hour urinary calcium excretion</td>
<td class="" id="Q?{u">350 mg (normal: 100-300)</td>
</tr>
</tbody>
</table>
<p class="" id="da8b132f-5fda-4fc5-b14f-3dc713e18481">Which of the following changes
                                        in bone structure is most likely associated with this patient's condition?
                                    </p>
<table class="simple-table" id="9bfb7e8a-fed7-488e-936c-8e698fc6dec4">
<tbody>
<tr id="128bdc25-3e3f-4acb-b4df-b20d5c322424">
<td class="" id="mxpj">A.</td>
<td class="" id="A}CT">Lamellar bone structure resembling a mosaic
                                                    pattern</td>
<td class="" id="sJQe"></td>
</tr>
<tr id="1a6591d4-b271-43c5-a158-48c0d949353b">
<td class="" id="mxpj">B.</td>
<td class="" id="A}CT">Osteoid matrix accumulation around trabeculae
                                                </td>
<td class="" id="sJQe"></td>
</tr>
<tr id="3a7b46dd-c152-4f6b-8552-87e2ab4a7a5d">
<td class="" id="mxpj">C.</td>
<td class="" id="A}CT">Spongiosa filling medullary canals with no mature
                                                    trabeculae</td>
<td class="" id="sJQe"></td>
</tr>
<tr id="1b675d33-4279-485f-a79d-e7bb2e65332b">
<td class="" id="mxpj">D.</td>
<td class="" id="A}CT">Subperiosteal resorption with cortical thinning
                                                </td>
<td class="" id="sJQe"></td>
</tr>
<tr id="6d5d0bae-afed-44b3-ab1f-2e78331aee92">
<td class="" id="mxpj">E.</td>
<td class="" id="A}CT">Trabecular thinning with fewer interconnections
                                                </td>
<td class="" id="sJQe"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="2faf53a4-a33f-4290-8bfb-e0f4c985dad3">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="8b826abc-8d0d-4745-99f7-d71479d70359">
<tbody>
<tr id="626b12fb-e713-4ff1-8989-ed2d9f7e3ae4">
<td class="" id="S?|U">A.</td>
<td class="" id=":tNH">Lamellar bone structure resembling a
                                                                mosaic pattern (8%)</td>
<td class="" id="V|j:"></td>
</tr>
<tr id="9f364ca2-00ca-4e3b-8ec5-4758941f3539">
<td class="" id="S?|U">B.</td>
<td class="" id=":tNH">Osteoid matrix accumulation around
                                                                trabeculae (7%)</td>
<td class="" id="V|j:"></td>
</tr>
<tr id="531f9a01-ff6f-42ef-941a-013f734adba5">
<td class="" id="S?|U">C.</td>
<td class="" id=":tNH">Spongiosa filling medullary canals
                                                                with no mature trabeculae (4%)</td>
<td class="" id="V|j:"></td>
</tr>
<tr id="a7ec9e4a-9f27-4b8a-96b2-d5d9467d90ea">
<td class="" id="S?|U">D.</td>
<td class="" id=":tNH">Subperiosteal resorption with
                                                                cortical thinning (64%)</td>
<td class="" id="V|j:"></td>
</tr>
<tr id="a33d5c15-bab7-4f43-92fa-8fdf178bd0da">
<td class="" id="S?|U">E.</td>
<td class="" id=":tNH">Trabecular thinning with fewer
                                                                interconnections (15%)</td>
<td class="" id="V|j:"></td>
</tr>
</tbody>
</table>
<p class="" id="77b774f1-f3b4-46a7-bbc7-88dfbb702d44">Incorrect</p>
<p class="" id="27824576-a3b5-4a86-8c58-bcc691c9f6c2">Correct answer D
                                                </p>
<p class="" id="9e2203ad-13b4-4bd1-8377-50f3f1366dbc">64%Answered
                                                    correctly</p>
<p class="" id="379057ea-751a-4249-9725-8d8b29631314">14 secsTime Spent
                                                </p>
<p class="" id="915c88c7-6068-41af-a282-5293ee635120">2024Version</p>
<ul class="bulleted-list" id="fe30ddff-2b83-4c98-b769-321ea389cdfb">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="81b6c2a0-268e-4477-8906-f1097911d239">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="bc674740-c5ef-46b4-89cb-5eda30981233">This patient with
                                                    recurrent calcium nephrolithiasis and hypercalcemia most likely has
                                                    primary hyperparathyroidism (PHPT).  Besides kidney stones, classic
                                                    manifestations include bone pain, gastrointestinal disturbances (eg,
                                                    peptic ulcer disease), and psychiatric symptoms (ie, "bones,
                                                    stones, abdominal groans, and psychologic moans").  However,
                                                    asymptomatic hypercalcemia is the most common presentation.  85% of
                                                    cases are caused by a parathyroid adenoma, but PHPT can also be due
                                                    to parathyroid hyperplasia or, rarely, parathyroid cancer.</p>
<p class="" id="72174a8d-4254-4b1d-9b81-5757a345f19c">Excess parathyroid
                                                    hormone causes hypercalcemia via the following mechanisms:</p>
<ul class="bulleted-list" id="d73dcda9-50dd-4b0d-9a03-88cf6cbd0937">
<li style="list-style-type:disc">Increased renal tubular Ca2+
                                                        reabsorption (although most patients have net hypercalciuria due
                                                        to the increased filtered calcium load)</li>
</ul>
<ul class="bulleted-list" id="4e22c045-f43d-4cba-994c-ea63ee3ecf9a">
<li style="list-style-type:disc">Increased renal production of
                                                        1,25-dihydroxyvitamin D (which in turn increases
                                                        gastrointestinal Ca2+ absorption)</li>
</ul>
<ul class="bulleted-list" id="32e39da0-f3ab-4baa-bd51-11b4957a0922">
<li style="list-style-type:disc">Increased bone resorption (via
                                                        osteoclast activation)</li>
</ul>
<p class="" id="589796f7-f699-4082-92d6-0075430ac6ae">Patients usually
                                                    also have hypophosphatemia due to decreased phosphate reabsorption
                                                    in the proximal renal tubules.</p>
<p class="" id="d8872998-7255-4f7e-aa1d-cb093944bd2e">Because of the
                                                    increased bone resorption, PHPT often leads to osteoporosis. 
                                                    However, unlike the typical osteoporosis of aging, which
                                                    predominantly affects trabecular bone, osteoporosis in PHPT is most
                                                    pronounced in the cortical (compact) bone of the appendicular
                                                    skeleton (eg, pectoral girdle, pelvic girdle, limbs).  Cortical
                                                    thinning is characteristic and appears radiologically as
                                                    subperiosteal erosions.  More advanced disease can present as
                                                    osteitis fibrosa cystica, characterized by granular decalcification
                                                    of the skull ("salt-and-pepper skull"), osteolytic cysts,
                                                    and brown tumors.</p>
<p class="" id="5bd031ee-bbbb-414e-bb80-319018c30340">(Choice A) 
                                                    Disorganized lamellar bone in a mosaic pattern is a characteristic
                                                    finding in Paget disease of bone.  Serum calcium and phosphorus are
                                                    normal in these patients.</p>
<p class="" id="2c85ccf8-31f0-49dc-b88d-0ac6bfebf1af">(Choice B) 
                                                    Osteoid matrix accumulation around trabeculae is seen in vitamin D
                                                    deficiency.  Histologically, there is excessive unmineralized
                                                    osteoid with widened osteoid seams.  Patients typically have low
                                                    urinary calcium.</p>
<p class="" id="569abf14-a22f-4746-a119-b612b7fdfe1a">(Choice C) 
                                                    Osteopetrosis ("marble bone disease") is characterized by
                                                    persistence of the primary spongiosa in the medullary cavity with no
                                                    mature trabeculae.  It is caused by decreased osteoclastic bone
                                                    resorption, resulting in accumulation of woven bone and diffuse
                                                    skeletal thickening.</p>
<p class="" id="c010fc3a-baab-4e5b-b813-f16d5af1d6ed">(Choice E) 
                                                    Trabecular thinning with fewer interconnections is characteristic of
                                                    postmenopausal osteoporosis.  Although long-standing PHPT causes
                                                    thinning of cortical bone, the trabecular architecture remains
                                                    relatively preserved.</p>
<p class="" id="76949800-d4d2-4f2d-8823-05e5c5bf24fc">Educational
                                                    objective:</p>
<p class="" id="247c7f79-fb96-4718-9247-c9ca50cd3b03">Increased bone
                                                    resorption in primary hyperparathyroidism leads to osteoporosis
                                                    primarily involving the cortical bone of the appendicular skeleton. 
                                                    The cortical thinning appears radiologically as subperiosteal
                                                    erosions.  More advanced disease can present as osteitis fibrosa
                                                    cystica (ie, granular decalcification of the skull, osteolytic
                                                    cysts, and brown tumors).</p>
<p class="" id="2b8f81ce-bb47-4f44-89d9-061bf12236ba">References</p>
<ul class="bulleted-list" id="6aa1a5f1-9a6a-4413-8ada-64a785626925">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/23365170">Radiographical
                                                            appearance of osteitis fibrosa cystica in primary
                                                            hyperparathyroidism before and after parathyroidectomy.</a>
</li>
</ul>
<p class="" id="4b92354c-e93c-4f17-a838-d030113d8f43">Pathophysiology
                                                </p>
<p class="" id="85b88e6f-9a44-42d4-aab2-2c5146d25190">Subject</p>
<p class="" id="f2ffa21e-cdc5-4289-9695-fa63cc0a476a">Renal, Urinary
                                                    Systems &amp; Electrolytes</p>
<p class="" id="00312ab2-6b67-4f52-9358-f311d2f3ea85">System</p>
<p class="" id="8da80567-3895-4d31-95db-32586a17fcfb">
                                                    Hyperparathyroidism</p>
<p class="" id="793934aa-274a-442b-ab7b-a54906c0c340">Topic</p>
<p class="" id="cf0a864d-139e-4fc4-8203-87bf3823865a">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="16cd3aea-05b6-4b71-beb3-9f7f378bcf33">‚ú®Done</p>
<p class="" id="9587ff98-48bc-4bd4-b6c9-da47b1f19d92">Exhibit Display
                                                </p>
<figure class="image" id="cb3acf98-135f-4522-a34d-9cba3dfa841a"><a href="https://lh7-us.googleusercontent.com/iudkZte88YJBzAKe2cROwrxj2BAVJZvXgmsS4bZRVsxYh3DkerfVsGfd_kiSQJqcjZi0gyl_dNNNLRfh3N2V1zfWMv6ZNvtcsA7U1mSTJwGW56Zz7JVbWE5U8SiWI_5KxXu6O2UL9s5QehenORGhunY"><img loading="lazy" src="https://lh7-us.googleusercontent.com/iudkZte88YJBzAKe2cROwrxj2BAVJZvXgmsS4bZRVsxYh3DkerfVsGfd_kiSQJqcjZi0gyl_dNNNLRfh3N2V1zfWMv6ZNvtcsA7U1mSTJwGW56Zz7JVbWE5U8SiWI_5KxXu6O2UL9s5QehenORGhunY" style="width:602px"/></a>
</figure>
<p class="" id="f3492f3b-5313-4f7e-9be8-e2411446b733">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="6349c848-741e-4e7d-88c6-a049c41fb2bc">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
