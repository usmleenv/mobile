
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>657</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="b4f0fe03-f1c0-4070-8206-3f56b49d1258">A 66-year-old man comes to the
                                        office for follow-up of metastatic prostate cancer.  He was diagnosed 12 months
                                        ago, when he was found to have a single bony metastasis.  The patient declined
                                        orchiectomy and was treated with a long-acting gonadotropin-releasing hormone
                                        agonist.  While on this therapy, he developed nocturnal pain in the area of the
                                        bony metastasis and was found to have a rising level of prostate-specific
                                        antigen.  Flutamide was then added to his initial therapy and led to significant
                                        pain relief and a decrease in the size of the primary tumor.  Which of the
                                        following mechanisms is the best explanation for the effects of flutamide in
                                        this patient?</p>
<table class="simple-table" id="c0261dfa-22f9-480d-821a-700de2b80e23">
<tbody>
<tr id="739d7e27-eb21-4067-b399-63190442fa58">
<td class="" id="[drZ">A.</td>
<td class="" id="w|Jx">Decreased androgen aromatization</td>
<td class="" id="[mVL"></td>
</tr>
<tr id="7416fcaf-c5d6-4355-9707-a7507d883a41">
<td class="" id="[drZ">B.</td>
<td class="" id="w|Jx">Decreased Leydig cell stimulation</td>
<td class="" id="[mVL"></td>
</tr>
<tr id="1015e997-cb48-4ad0-8902-cd6cee7ba536">
<td class="" id="[drZ">C.</td>
<td class="" id="w|Jx">Decreased peripheral androgen conversion</td>
<td class="" id="[mVL"></td>
</tr>
<tr id="c04d44fa-da90-4b08-9163-0a04d8eb258a">
<td class="" id="[drZ">D.</td>
<td class="" id="w|Jx">Impaired androgen-receptor interaction</td>
<td class="" id="[mVL"></td>
</tr>
<tr id="84467963-8ca1-4a20-9d1f-10ff39c444a0">
<td class="" id="[drZ">E.</td>
<td class="" id="w|Jx">Inhibition of androgen synthesis</td>
<td class="" id="[mVL"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="da42ba6f-a985-42a4-ab77-d028990bde1f">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="63ab68f7-f8f9-464a-815f-3793ebf94e4a">
<tbody>
<tr id="e4691570-d079-4756-8c9c-e7ec4923b95d">
<td class="" id="q;`J">A.</td>
<td class="" id="uVjN">Decreased androgen aromatization (7%)
                                                            </td>
<td class="" id="}]o{"></td>
</tr>
<tr id="46aa9618-92e0-435c-a0ed-840793b7763a">
<td class="" id="q;`J">B.</td>
<td class="" id="uVjN">Decreased Leydig cell stimulation
                                                                (5%)</td>
<td class="" id="}]o{"></td>
</tr>
<tr id="9af1813e-5072-423f-9eb0-993543395275">
<td class="" id="q;`J">C.</td>
<td class="" id="uVjN">Decreased peripheral androgen
                                                                conversion (21%)</td>
<td class="" id="}]o{"></td>
</tr>
<tr id="2625bc45-87d1-446d-a692-f16bbf4c07c6">
<td class="" id="q;`J">D.</td>
<td class="" id="uVjN">Impaired androgen-receptor
                                                                interaction (56%)</td>
<td class="" id="}]o{"></td>
</tr>
<tr id="7538e15b-4473-45d6-b83f-49039462eabb">
<td class="" id="q;`J">E.</td>
<td class="" id="uVjN">Inhibition of androgen synthesis (9%)
                                                            </td>
<td class="" id="}]o{"></td>
</tr>
</tbody>
</table>
<p class="" id="291dc0ff-7dce-4152-9cce-30a5a6951cce">Incorrect</p>
<p class="" id="0d765a82-6813-4347-9ac0-4abb9af7d8e8">Correct answer D
                                                </p>
<p class="" id="0fb4518b-d1a9-4e0f-8977-19ce1dde7527">56%Answered
                                                    correctly</p>
<p class="" id="1c212416-ad8f-47c8-b476-4be405b59762">14 secsTime Spent
                                                </p>
<p class="" id="0d0cfdac-db6a-4730-84b2-1911b28f06e3">2024Version</p>
<ul class="bulleted-list" id="38e77cd3-328c-424e-9a38-4fd99fe52227">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="39da2f84-b573-4417-84d2-1cb4ef92b691">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="d43cac4d-aae6-408e-a83c-37f98d3fc7fa"><a href="https://lh7-us.googleusercontent.com/msfxVWYiozatwIP1HzD76QP5Ks2j9_VqjIA9N4b_HqYH-48WGocV7kF5QA7EnLoFbUwFMRIJlCTEeMsR8-zHFOH_lLB6fpgK32bQguna_ELMKB3qkri9qW6lJ6gSkocRqjutOH0Np8wn3jEYPOEXaoo"><img loading="lazy" src="https://lh7-us.googleusercontent.com/msfxVWYiozatwIP1HzD76QP5Ks2j9_VqjIA9N4b_HqYH-48WGocV7kF5QA7EnLoFbUwFMRIJlCTEeMsR8-zHFOH_lLB6fpgK32bQguna_ELMKB3qkri9qW6lJ6gSkocRqjutOH0Np8wn3jEYPOEXaoo" style="width:600px"/></a>
</figure>
<p class="" id="adacdd9f-25db-48de-862a-016047c22a38">Prostate cancer is
                                                    testosterone-dependent and can be treated in most cases with
                                                    surgical and/or pharmacologic androgen deprivation.  Initial options
                                                    include bilateral orchiectomy or a gonadotropin-releasing hormone
                                                    (GnRH) agonist.  Pulsatile release of GnRH from the hypothalamus
                                                    stimulates secretion of LH from the anterior pituitary and leads to
                                                    increased testosterone production.  However, constant GnRH activity
                                                    causes down-regulation of the GnRH receptors on pituitary
                                                    gonadotrophin cells, which suppresses LH secretion.  Therefore,
                                                    long-acting GnRH agonists (eg, leuprolide) paradoxically cause a
                                                    decrease in testicular Leydig cell stimulation (Choice B).  The use
                                                    of long-acting GnRH agonists can be associated with a transient rise
                                                    in LH and testosterone levels following treatment initiation.  As a
                                                    result, antiandrogens are sometimes prescribed concurrently to limit
                                                    the tumor-stimulating effects of this initial testosterone rise.</p>
<p class="" id="4de283d3-d0e2-408e-9198-0a917e04ced0">Flutamide is a
                                                    nonsteroid agent that acts as a competitive testosterone receptor
                                                    inhibitor.  Prevention of androgen-receptor binding blocks the
                                                    stimulatory effect of androgens on the primary tumor and metastases
                                                    and leads to a reduction in their size (improving symptoms such as
                                                    bone pain and urinary obstruction).</p>
<p class="" id="4890ec57-c5d0-45a0-90c9-20475cb47cd0">(Choice A) 
                                                    Aromatase inhibitors (eg, anastrozole) decrease the peripheral
                                                    conversion of androgens to estrogen and are used in postmenopausal
                                                    women with estrogen receptor-positive breast cancer.  They do not
                                                    lower androgen levels and are not used in the treatment of prostate
                                                    cancer.</p>
<p class="" id="75677982-f9ad-40cd-9464-c53c263ed116">(Choice C) 
                                                    Finasteride decreases peripheral conversion of testosterone to
                                                    dihydrotestosterone by inhibiting 5-Œ±-reductase.  It is used for
                                                    treatment of benign prostatic hyperplasia and male-pattern baldness.
                                                </p>
<p class="" id="8b0d8810-e8df-4051-82fa-1bcc36683d98">(Choice E) 
                                                    Ketoconazole is a weak antiandrogen that decreases synthesis of
                                                    steroid hormones in the gonads and adrenals.  Flutamide does not
                                                    inhibit testosterone production by Leydig cells.</p>
<p class="" id="1203061a-567b-46d0-8fc1-51facd7405be">Educational
                                                    objective:</p>
<p class="" id="8d2e90ad-b9e9-445a-bd3e-4787f5d5d735">Flutamide is a
                                                    nonsteroid anti-androgen that acts as a competitive inhibitor of
                                                    testosterone receptors.  It is used in combination with long-acting
                                                    gonadotropin-releasing hormone agonists for the treatment of
                                                    prostate cancer.</p>
<p class="" id="976caac8-96a8-48b5-ab3b-de658df4d0e5">References</p>
<ul class="bulleted-list" id="18c64a65-6928-4d54-a093-952d5cd04bfe">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/25523493">Non-steroidal
                                                            antiandrogen monotherapy compared with luteinizing
                                                            hormone-releasing hormone agonists or surgical castration
                                                            monotherapy for advanced prostate cancer: a Cochrane
                                                            systematic review.</a></li>
</ul>
<ul class="bulleted-list" id="1fd8baca-5a0e-45f0-9450-6bc299dd597f">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/17956709">Combined
                                                            androgen blockade in advanced prostate cancer: looking back
                                                            to move forward.</a></li>
</ul>
<p class="" id="f62f2ed9-6a5d-405a-80e3-8ee82ea48197">Pharmacology</p>
<p class="" id="8c89e83f-4253-4785-9ade-497a6b24f12e">Subject</p>
<p class="" id="b8fc2922-2368-425f-aa28-bb7f9be1733a">Male Reproductive
                                                    System</p>
<p class="" id="ee5b05ab-a8c1-4033-b170-1527ac69255d">System</p>
<p class="" id="49181b86-5424-4174-953a-3990bf6a7d34">Prostate cancer
                                                </p>
<p class="" id="fd17bd4f-520f-40c6-af06-2e1f50fb5015">Topic</p>
<p class="" id="72e1f4c2-6750-4694-af59-a551c3d21f5e">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="e15fc8c5-d906-42e5-b3d4-922e8bda15a3">My Notebook</p>
<p class="" id="68d9ff5e-4cff-40ef-9f6e-2ceecc2ef01a">0</p>
<p class="" id="7109f83f-00ca-4c39-ad3d-5c8507a30e83">Flashcards</p>
<p class="" id="9150b270-d551-4e2b-8e3b-fb4051680e65">Feedback</p>
<p class="" id="a80f5ed5-987b-4330-a176-6befbe3eda69">Suspend</p>
<p class="" id="c3ad037d-142e-492e-b4fc-b7bc4e561ea1">End Block</p>
<p class="" id="54986c9a-dfd0-423c-bf84-a6ab660a1d96">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
