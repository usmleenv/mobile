
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>796</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="9d55edd2-1760-49c4-b8c1-dc1acf2f5ba8">A 29-year-old African American
                                        woman is being evaluated for exertional dyspnea and dry cough.  She has no
                                        significant medical history and takes no medications.  The patient works
                                        part-time as a bird keeper at a zoo.  Chest x-ray reveals bilateral hilar
                                        adenopathy and reticular pulmonary infiltrates.  Serum ACE levels and calcium
                                        levels are elevated.  Purified protein derivative testing is negative.  A
                                        bronchoscopy is scheduled to help determine the diagnosis.  Which of the
                                        following is most likely to be the predominant cell type in this patient's
                                        bronchoalveolar lavage fluid?</p>
<table class="simple-table" id="a4ee0179-996b-46ce-a4f3-3e2b348f475c">
<tbody>
<tr id="34dd5c56-5a37-4ddc-94bc-db4814ef078d">
<td class="" id="q^hQ">A.</td>
<td class="" id="vUW_">CD4+ lymphocytes</td>
<td class="" id="FNV?"></td>
</tr>
<tr id="0465b544-00b4-4722-aec8-4533a559c8a3">
<td class="" id="q^hQ">B.</td>
<td class="" id="vUW_">CD8+ lymphocytes</td>
<td class="" id="FNV?"></td>
</tr>
<tr id="1c92aae1-9bf8-44d3-9d72-b00ff5a8f25a">
<td class="" id="q^hQ">C.</td>
<td class="" id="vUW_">CD22+ lymphocytes</td>
<td class="" id="FNV?"></td>
</tr>
<tr id="686c37ac-b23b-4827-8aad-5f2492ec218c">
<td class="" id="q^hQ">D.</td>
<td class="" id="vUW_">Eosinophils</td>
<td class="" id="FNV?"></td>
</tr>
<tr id="96d446da-f6ed-4a47-9d27-ce24dbde5343">
<td class="" id="q^hQ">E.</td>
<td class="" id="vUW_">Mast cells</td>
<td class="" id="FNV?"></td>
</tr>
<tr id="b6a4ec99-cbf3-45f9-b8c6-32ba2d777f64">
<td class="" id="q^hQ">F.</td>
<td class="" id="vUW_">Neutrophils</td>
<td class="" id="FNV?"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="dba3bb87-7472-4173-8e13-f033afebebac">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="847d837e-de68-4522-8e97-fc8568510580">
<tbody>
<tr id="0adae7fa-49bf-4e76-b491-00b913fe5e7b">
<td class="" id="P_i:">A.</td>
<td class="" id="hs:K">CD4+ lymphocytes (60%)</td>
<td class="" id="b|=D"></td>
</tr>
<tr id="d6e59081-c71c-4d43-8a2a-39623b380dba">
<td class="" id="P_i:">B.</td>
<td class="" id="hs:K">CD8+ lymphocytes (13%)</td>
<td class="" id="b|=D"></td>
</tr>
<tr id="52d6de0a-bf42-4c20-9459-3781a8fbde91">
<td class="" id="P_i:">C.</td>
<td class="" id="hs:K">CD22+ lymphocytes (2%)</td>
<td class="" id="b|=D"></td>
</tr>
<tr id="1859159a-2094-49a2-bf3b-64207c198a87">
<td class="" id="P_i:">D.</td>
<td class="" id="hs:K">Eosinophils (10%)</td>
<td class="" id="b|=D"></td>
</tr>
<tr id="47eefa8a-6da1-461d-9881-8d7ee3663f6c">
<td class="" id="P_i:">E.</td>
<td class="" id="hs:K">Mast cells (3%)</td>
<td class="" id="b|=D"></td>
</tr>
<tr id="339ce4af-5582-4541-8f97-9ee50453191b">
<td class="" id="P_i:">F.</td>
<td class="" id="hs:K">Neutrophils (8%)</td>
<td class="" id="b|=D"></td>
</tr>
</tbody>
</table>
<p class="" id="01a67150-7df5-4944-937f-ed78874101cb">Incorrect</p>
<p class="" id="40c70e00-c78f-4cd9-92ae-dfc3a7d1f2c7">Correct answer A
                                                </p>
<p class="" id="3fce005d-f8e3-4cce-b1a1-2aa714a1a72d">60%Answered
                                                    correctly</p>
<p class="" id="e669d149-5e7e-4a95-add9-d5b3bf29a726">13 secsTime Spent
                                                </p>
<p class="" id="a079ddb3-c7f8-4027-ac2b-1d7040bb32ed">2024Version</p>
<ul class="bulleted-list" id="8e19fb21-2564-4fab-9ff8-4212a6bda1ac">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="ec9ca3f7-5afa-4189-845b-209df50f49e0">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="263b60f6-9247-45ba-9e2e-e733da28e7f5">
<tbody>
<tr id="5d7c9f16-95b5-496f-976d-21f2f9ded8f4">
<td class="" id="C`PL">Common features of sarcoidosis</td>
<td class="" id="?Yw_"></td>
</tr>
<tr id="a210f207-9725-4d97-93ad-28423b0a2305">
<td class="" id="C`PL">Epidemiology</td>
<td class="" id="?Yw_">‚Ä¢ Young adults<br/>‚Ä¢ African
                                                                Americans<br/></td>
</tr>
<tr id="4f3e8241-fc89-4bb6-914a-e4213b63f5c0">
<td class="" id="C`PL">Clinical</td>
<td class="" id="?Yw_">‚Ä¢ Constitutional symptoms<br/>‚Ä¢
                                                                Cough, dyspnea &amp; chest pain<br/>‚Ä¢ Extrapulmonary
                                                                findings<br/> ‚ó¶ Skin lesions<br/> ‚ó¶ Anterior/posterior
                                                                uveitis<br/> ‚ó¶ L√∂fgren syndrome<br/>‚Ä¢ Parotid gland
                                                                swelling<br/></td>
</tr>
<tr id="bee9bd4f-17a1-464c-bc0c-bd9842077329">
<td class="" id="C`PL">Imaging</td>
<td class="" id="?Yw_">‚Ä¢ Bilateral hilar adenopathy<br/>‚Ä¢
                                                                Pulmonary reticular infiltrates<br/></td>
</tr>
<tr id="f33e2db7-8bca-4175-aeae-8eb8b74ca9da">
<td class="" id="C`PL">Laboratory</td>
<td class="" id="?Yw_">‚Ä¢ Hypercalcemia/hypercalciuria<br/>‚Ä¢
                                                                Elevated serum ACE level<br/></td>
</tr>
<tr id="cd37273f-f730-4132-bcc2-358066cd89f9">
<td class="" id="C`PL">Pathology</td>
<td class="" id="?Yw_">‚Ä¢ Biopsy showing noncaseating
                                                                granulomas<br/>that stain negative for fungi &amp;
                                                                acid-fast bacilli<br/></td>
</tr>
</tbody>
</table>
<p class="" id="4ea94a4a-e8b1-437e-ad39-b76effad4005">This
                                                    patient's hilar adenopathy, hypercalcemia, and elevated ACE
                                                    levels are suggestive of sarcoidosis, a condition characterized
                                                    histologically by noncaseating granulomas composed of activated
                                                    macrophages and T lymphocytes.  Activated macrophages can
                                                    ectopically produce ACE and 1-alpha-hydroxylase (increases
                                                    production of 1,25-dihydroxycholecalciferol, the active form of
                                                    vitamin D).  This results in high ACE levels and hypercalcemia
                                                    commonly seen in patients with sarcoidosis.  Any organ can be
                                                    affected; however, the lungs (interstitial lung disease), lymph
                                                    nodes (hilar adenopathy), skin (nodular rash), and eyes (anterior
                                                    uveitis) are most commonly involved.</p>
<p class="" id="95311c12-0822-4a26-8ebd-17673ccc16ed">Sarcoidosis may
                                                    resemble other interstitial lung diseases (eg, hypersensitivity
                                                    pneumonitis, cryptogenic organizing pneumonia).  In such cases,
                                                    quantification of the CD4+/CD8+ ratio in bronchoalveolar lavage
                                                    (BAL) fluid may help in determining the diagnosis.  Sarcoidosis is a
                                                    CD4+ T-cell‚Äìmediated disease in which large amounts of CD4+
                                                    lymphocytes release interferon-gamma and TNF-alpha to drive
                                                    macrophage activation and granuloma formation.  Therefore, the BAL
                                                    fluid in patients with pulmonary sarcoidosis demonstrates a
                                                    lymphocytic predominance with a high CD4+/CD8+ ratio (&gt;2:1).</p>
<p class="" id="1d4af020-b1f4-4d29-a629-e77d6ba12c69">(Choice B)  CD8+
                                                    cells predominate in the BAL fluid of patients with hypersensitivity
                                                    pneumonitis.  Although this patient has an exposure risk for
                                                    hypersensitivity pneumonitis (bird handling), her hilar adenopathy
                                                    as well as elevated serum calcium and ACE levels make sarcoidosis
                                                    more likely.</p>
<p class="" id="1b07b38a-09d2-4afd-a3dc-52951b86a4ab">(Choice C)  CD19,
                                                    CD20, and CD22 are markers for the B-cell lineage.  Precursor B-cell
                                                    lymphoblastic leukemia (CD22+) may sometimes involve the pleura or
                                                    present as diffuse, patchy pulmonary infiltrates.  In such cases,
                                                    the BAL fluid might contain CD22+ lymphocytes; however, elevated ACE
                                                    and calcium levels suggest sarcoidosis.</p>
<p class="" id="dd52a15b-7d8f-4227-9dc4-76db63d45e35">(Choice D)  BAL
                                                    fluid eosinophilia is found in eosinophilic pneumonias and tropical
                                                    pulmonary eosinophilia.  Although patients with hypersensitivity
                                                    pneumonitis may have elevations in circulating eosinophils, they do
                                                    not have elevated eosinophil counts in their BAL fluid.</p>
<p class="" id="fac38276-2dec-4e7b-a2d4-cc9d4c5f6b81">(Choice E)  Even
                                                    though the quantity of mast cells in BAL fluid may be elevated in
                                                    various pulmonary diseases, there are few, if any, conditions
                                                    reported to have a predominance of such cells.</p>
<p class="" id="2a17b360-d22d-4a4d-9583-697f91d29af2">(Choice F) 
                                                    Neutrophils would predominate in patients with bacterial pneumonias.
                                                </p>
<p class="" id="4e9891b4-ede5-4754-84ac-c7bc5086bcd4">Educational
                                                    objective:</p>
<p class="" id="f521c7e3-b768-4231-ac34-e8cc7a253086">Sarcoidosis is a
                                                    CD4+ T-cell mediated disease, in which large numbers of CD4+
                                                    lymphocytes release interferon-gamma and tumor necrosis factor-alpha
                                                    to drive macrophage activation and granuloma formation. 
                                                    Bronchoalveolar lavage fluid in pulmonary sarcoidosis demonstrates a
                                                    lymphocytic predominance with a high CD4+/CD8+ ratio.</p>
<p class="" id="86b4e54d-f691-4668-9adf-6f402289c704">Pathology</p>
<p class="" id="9a1bbcaa-8b48-4fa5-b4a1-a89cdcf0ec09">Subject</p>
<p class="" id="079defdf-0ce1-459d-870c-5c557165a203">Pulmonary &amp;
                                                    Critical Care</p>
<p class="" id="a1792657-88bb-4c8b-a9b6-fba04bfc1ba1">System</p>
<p class="" id="0685d623-a4fd-447d-8f1d-eaac87a745e5">Sarcoidosis</p>
<p class="" id="8796e5aa-40e0-48d8-a418-c232543e9851">Topic</p>
<p class="" id="739e7e4e-4483-44a8-8429-4fb7c89ab56e">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="01e59154-fdc8-4eea-872c-e1da7d0bd662">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
