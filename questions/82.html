
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>82</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="d220fee1-1bb1-490b-b1a7-2c61834fafbf">An 18-year-old man suddenly
                                        collapses during a high school soccer game.  There was no preceding collision or
                                        trauma.  Immediate resuscitation is initiated but he dies before the emergency
                                        medical service arrives.  The patient had recently experienced occasional
                                        exertion-related chest discomfort and dyspnea.  Otherwise, he had no significant
                                        medical history.  He took no medications and did not use tobacco, alcohol, or
                                        illicit drugs.  Which of the following is most likely to be seen on autopsy?</p>
<table class="simple-table" id="82ba8c42-034b-4aee-8537-a76c1c94693a">
<tbody>
<tr id="55b2587c-8525-4d72-b8db-df255e4cd4c1">
<td class="" id="IqBV">A.</td>
<td class="" id="]~Hh">Atherosclerotic narrowing of the left anterior
                                                    descending artery</td>
<td class="" id="AYhj"></td>
</tr>
<tr id="62aba09f-fe16-47b6-aa9c-a11cf21c59ff">
<td class="" id="IqBV">B.</td>
<td class="" id="]~Hh">Dilation of all cardiac chambers with thin
                                                    ventricular walls</td>
<td class="" id="AYhj"></td>
</tr>
<tr id="1ba3c212-2988-4fb7-8c52-eb439682a033">
<td class="" id="IqBV">C.</td>
<td class="" id="]~Hh">Extracellular deposits and stiff ventricular
                                                    walls</td>
<td class="" id="AYhj"></td>
</tr>
<tr id="db602db1-9bbe-4227-ae14-0b9eaaf949f5">
<td class="" id="IqBV">D.</td>
<td class="" id="]~Hh">Myocardial hypertrophy with patchy interstitial
                                                    fibrosis</td>
<td class="" id="AYhj"></td>
</tr>
<tr id="56bc3c5a-2d13-462e-9f5a-a6ed84c7836b">
<td class="" id="IqBV">E.</td>
<td class="" id="]~Hh">Thrombus at the bifurcation of the main pulmonary
                                                    artery</td>
<td class="" id="AYhj"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="fbc06e5d-58b8-4111-83f9-4aeeefca49d4">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="16c572ba-cc7f-46b8-958a-f24787567e1d">
<tbody>
<tr id="e2754d6d-638f-4dd8-87cd-257c726886e2">
<td class="" id="eZ|r">A.</td>
<td class="" id="owZh">Atherosclerotic narrowing of the left
                                                                anterior descending artery (2%)</td>
<td class="" id="n::b"></td>
</tr>
<tr id="52c614fc-7836-419f-8b1c-03c3aaf7f17e">
<td class="" id="eZ|r">B.</td>
<td class="" id="owZh">Dilation of all cardiac chambers with
                                                                thin ventricular walls (13%)</td>
<td class="" id="n::b"></td>
</tr>
<tr id="c14df720-2a40-40da-8caf-89ca137fd597">
<td class="" id="eZ|r">C.</td>
<td class="" id="owZh">Extracellular deposits and stiff
                                                                ventricular walls (5%)</td>
<td class="" id="n::b"></td>
</tr>
<tr id="dc29ad24-98be-4d4b-a25c-790aa6c8aad6">
<td class="" id="eZ|r">D.</td>
<td class="" id="owZh">Myocardial hypertrophy with patchy
                                                                interstitial fibrosis (75%)</td>
<td class="" id="n::b"></td>
</tr>
<tr id="8ded451b-c878-470d-a520-5eeeb37e11b5">
<td class="" id="eZ|r">E.</td>
<td class="" id="owZh">Thrombus at the bifurcation of the
                                                                main pulmonary artery (2%)</td>
<td class="" id="n::b"></td>
</tr>
</tbody>
</table>
<p class="" id="e8c9de12-ba03-4159-9992-e2de6d67cf79">Omitted</p>
<p class="" id="698d78d9-8e16-4fc5-9ef2-0cbac6891407">Correct answer D
                                                </p>
<p class="" id="0cdedb0f-031f-439a-9d62-59f9f394b576">75%Answered
                                                    correctly</p>
<p class="" id="ee639e6b-52ce-4be2-86f9-d9674f2df1ad">0 secsTime Spent
                                                </p>
<p class="" id="7df4d69f-3bb6-4c58-9f58-9e3e4ea8223b">2024Version</p>
<ul class="bulleted-list" id="da963d32-3a92-4d93-b75f-9edb7a447194">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="75788e2f-e46b-43e5-bead-c98b73438186">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="46fb0129-4fb4-45b9-955d-da1e91541166">Sudden cardiac
                                                    death (SCD) is most often precipitated by cardiac arrhythmia (eg,
                                                    ventricular tachycardia/fibrillation) that leads to markedly
                                                    decreased cardiac output and impaired coronary artery perfusion.  In
                                                    older adults (eg, age ‚â•35), myocardial ischemia due to
                                                    atherosclerotic coronary artery disease (Choice A) is the most
                                                    common cause of SCD.  However, young adults who experience SCD
                                                    usually have underlying structural heart disease; hypertrophic
                                                    cardiomyopathy (HCM) is one of the most common precipitating
                                                    diseases.  Most patients with HCM are asymptomatic, but some may
                                                    experience exertional dyspnea, fatigue, chest pain, or syncope.</p>
<p class="" id="493e66c9-0b0a-40c8-9640-0bf50ca4c715">HCM is an
                                                    autosomal dominant genetic disorder caused by mutation of one of
                                                    several genes coding for cardiac sarcomere proteins.  It is
                                                    characterized by cardiomyocyte hypertrophy (predominantly affecting
                                                    the septum) and myofiber disarray consisting of an irregular
                                                    arrangement of abnormally shaped cardiomyocytes and increased
                                                    interstitial fibrosis.  This structural disarray leads to conduction
                                                    abnormalities that predispose to ventricular arrhythmia and SCD.</p>
<p class="" id="159d336f-8454-43b2-a64e-0801885bd906">(Choice B) 
                                                    Dilated cardiac chambers and thin ventricular walls are consistent
                                                    with dilated cardiomyopathy (DCM), a less common cause of SCD than
                                                    HCM in young adults.  A patient with DCM would likely have symptoms
                                                    of heart failure (eg, lower extremity swelling, dyspnea, orthopnea)
                                                    and would not be capable of participating in strenuous activities
                                                    such as soccer.</p>
<p class="" id="ff8b4fdb-d49f-4366-b660-fcdf66892bd8">(Choice C) 
                                                    Extracellular deposits and stiff ventricular walls suggest
                                                    restrictive cardiomyopathy due to amyloidosis or hemochromatosis. 
                                                    Although restrictive cardiomyopathy can cause SCD, there is usually
                                                    a preceding course of progressive and symptomatic heart failure.</p>
<p class="" id="6e371381-71e5-40e6-b603-37295a1cad40">(Choice E) 
                                                    Thrombus at the bifurcation of the main pulmonary artery (ie, saddle
                                                    pulmonary embolism) is a potential cause of SCD; however, a
                                                    preceding history of exertion-related dyspnea and chest discomfort
                                                    would not be expected.</p>
<p class="" id="ecbd1e47-b588-41b9-9304-61143d1adcd0">Educational
                                                    objective:</p>
<p class="" id="cb2e74db-f357-4c73-a048-27bd137329bc">Hypertrophic
                                                    cardiomyopathy is a common cause of sudden cardiac death (SCD) in
                                                    young adults.  Histologic features include cardiomyocyte hypertrophy
                                                    and myofiber disarray with increased interstitial fibrosis.  The
                                                    structural disarray creates a substrate for ventricular arrhythmia
                                                    (eg, ventricular tachycardia, ventricular fibrillation) that can
                                                    lead to SCD.</p>
<p class="" id="a9df7223-fd6d-4ff3-8102-9cfb201fac58">References</p>
<ul class="bulleted-list" id="1370c3ae-72ec-4ee0-949a-a277e28139af">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/19221222">Sudden
                                                            deaths in young competitive athletes: analysis of 1866
                                                            deaths in the United States, 1980-2006.</a></li>
</ul>
<p class="" id="ddd36641-bccb-44a4-8ba4-96cbc61818b3">Pathology</p>
<p class="" id="20b68b3f-71d1-459d-95a1-5c61b6a403bb">Subject</p>
<p class="" id="ac58840c-d422-45da-ae95-a73047e311f3">Cardiovascular
                                                    System</p>
<p class="" id="c2212b87-b8ec-4ca4-9da3-cb0cdc6333db">System</p>
<p class="" id="35679235-b19f-4e8f-8066-a291c600b59a">Hypertrophic
                                                    cardiomyopathy</p>
<p class="" id="2b259959-67bc-48fa-8489-b4cac3768281">Topic</p>
<p class="" id="c298c961-72c2-4313-99c6-9a782fa95f93">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="fbf8e70c-5115-4a46-ad5d-de1dbb1eee35">REVIEW</p>
<p class="" id="9f2ea9cd-428c-4412-b187-1ac3f514a8d3">‚ú®Done</p>
<p class="" id="8f89071d-7fc9-4de6-96e7-a946f044f93c">Exhibit Display
                                                </p>
<figure class="image" id="b0e35940-55ff-43ff-b271-ba532371f965"><a href="https://lh7-us.googleusercontent.com/HjTS5dlCdx4pRBS3PJ4Byhtve8sbl2J45hUvSyilUIsu59zzdhJvFo5TjXGIWms3P0WB0xiQoigOYSh7Iy2fB95JoZQ39tNRByH3-sCX-c9zC4ui9XigBematLF-UE4bCwk9oDQji-pCQewRFUhSuJY"><img loading="lazy" src="https://lh7-us.googleusercontent.com/HjTS5dlCdx4pRBS3PJ4Byhtve8sbl2J45hUvSyilUIsu59zzdhJvFo5TjXGIWms3P0WB0xiQoigOYSh7Iy2fB95JoZQ39tNRByH3-sCX-c9zC4ui9XigBematLF-UE4bCwk9oDQji-pCQewRFUhSuJY" style="width:602px"/></a>
</figure>
<p class="" id="958c6d27-7fb2-4d1c-adf8-cf3b514b6b89">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="5df6faee-12b9-4066-9822-8ddef6b31d1f">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
