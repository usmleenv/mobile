
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>8327</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="cc6933f0-6dea-4f58-8bed-56be57639dca">A 52-year-old woman comes to
                                        the emergency department due to recurrent right lower extremity swelling, pain,
                                        and erythema.  The patient's medical history includes type 2 diabetes
                                        mellitus and depression.  Her medications include metformin, paroxetine, and a
                                        multivitamin.  The patient is diagnosed with cellulitis, admitted to the
                                        hospital, and started on antibiotics.  She is continued on her home
                                        medications.  Three days later, the patient becomes agitated and delirious with
                                        severe abdominal cramps and diarrhea.  Her temperature is 39.2 C (102.6 F),
                                        blood pressure is 180/100 mm Hg, and heart rate is 120/min and regular.  On
                                        examination, the patient is diaphoretic and tremulous, and her pupils are
                                        dilated.  Bilateral hyperreflexia and ankle clonus are present.  She begins to
                                        have seizures.  Which of the following antibiotics was the patient most likely
                                        given to treat the cellulitis?</p>
<table class="simple-table" id="2a46400d-5078-4bf0-8277-ef6b9cbb1010">
<tbody>
<tr id="9e8d43bc-9bd4-4567-9b64-cadd05fbf8bf">
<td class="" id="PGPf">A.</td>
<td class="" id="QDPi">Clindamycin</td>
<td class="" id="yZ@~"></td>
</tr>
<tr id="b4d2650f-0a74-4032-9a40-b18d14b9d4d9">
<td class="" id="PGPf">B.</td>
<td class="" id="QDPi">Doxycycline</td>
<td class="" id="yZ@~"></td>
</tr>
<tr id="6c2645e5-f785-469d-b10e-37379f4aeaa8">
<td class="" id="PGPf">C.</td>
<td class="" id="QDPi">Linezolid</td>
<td class="" id="yZ@~"></td>
</tr>
<tr id="ed2b0c5c-5b6b-4202-a427-2297fe0d0d33">
<td class="" id="PGPf">D.</td>
<td class="" id="QDPi">Penicillin</td>
<td class="" id="yZ@~"></td>
</tr>
<tr id="7c4219b0-2b6c-4b07-bcff-bfdd4d810a7f">
<td class="" id="PGPf">E.</td>
<td class="" id="QDPi">Vancomycin</td>
<td class="" id="yZ@~"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="e458f22a-123d-4790-9336-ac247e6ba4b0">
<li>
<details>
<summary>Explanation</summary>
<table class="simple-table" id="876a9f17-1a9b-469a-b098-1a6b27734ce3">
<tbody>
<tr id="310ae76c-871a-46de-b86a-fdcea75b7848">
<td class="" id="`Hok">A.</td>
<td class="" id="yzfL">Clindamycin (18%)</td>
<td class="" id="JseP"></td>
</tr>
<tr id="ab388085-ccbf-41fd-bbf8-3164c8ca29aa">
<td class="" id="`Hok">B.</td>
<td class="" id="yzfL">Doxycycline (10%)</td>
<td class="" id="JseP"></td>
</tr>
<tr id="0d587ba3-78e7-48f3-9baf-0567830ea0f1">
<td class="" id="`Hok">C.</td>
<td class="" id="yzfL">Linezolid (49%)</td>
<td class="" id="JseP"></td>
</tr>
<tr id="7fe0514a-2e86-4573-9e94-e89111d5c20d">
<td class="" id="`Hok">D.</td>
<td class="" id="yzfL">Penicillin (8%)</td>
<td class="" id="JseP"></td>
</tr>
<tr id="e88fa7cf-4b09-469c-b676-a3030c364fae">
<td class="" id="`Hok">E.</td>
<td class="" id="yzfL">Vancomycin (13%)</td>
<td class="" id="JseP"></td>
</tr>
</tbody>
</table>
<p class="" id="33710836-9880-4938-85d3-ce1f061fa13b">Correct</p>
<p class="" id="10f0eee1-37e5-491f-993b-bee2cedca50c">49%Answered
                                                    correctly</p>
<p class="" id="83564ab9-eb87-4ea0-b14f-ea7118e54790">19 secsTime Spent
                                                </p>
<p class="" id="a9c4f6c8-948a-4e36-8f99-4c6fcb271900">2024Version</p>
<ul class="bulleted-list" id="d784cb59-44b5-42f2-b315-6a61ada4c2dc">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="86af0ded-3ba6-40f4-84af-019458c2567c">
<li style="list-style-type:disc"></li>
</ul>
<table class="simple-table" id="efe73c34-e26b-45a0-8355-9d7ed6055cdf">
<tbody>
<tr id="9b5ff633-9e24-47d1-ad9e-da243bc464a4">
<td class="" id="Ix=X">Serotonin syndrome</td>
<td class="" id="azhR"></td>
</tr>
<tr id="b82772de-e822-4aad-94fd-003ef2586b63">
<td class="" id="Ix=X">Causes</td>
<td class="" id="azhR">‚Ä¢ Serotonergic medications,
                                                                especially in combination (eg, SSRI/SNRI, TCA,
                                                                tramadol)<br/>‚Ä¢ Drug interactions: Serotonergic
                                                                medication &amp; MAOI or linezolid<br/>‚Ä¢ Intentional
                                                                overdose of serotonergic medications<br/>‚Ä¢ Serotonergic
                                                                drugs of abuse (eg, MDMA)<br/></td>
</tr>
<tr id="af4d1225-c091-4ff6-b3ee-f4fc42aa2d20">
<td class="" id="Ix=X">Clinical features</td>
<td class="" id="azhR">‚Ä¢ Mental status changes (eg, anxiety,
                                                                agitation, delirium)<br/>‚Ä¢ Autonomic dysregulation (eg,
                                                                diaphoresis, hypertension, tachycardia, hyperthermia,
                                                                vomiting, diarrhea)<br/>‚Ä¢ Neuromuscular hyperactivity
                                                                (eg, tremor, myoclonus, hyperreflexia)<br/></td>
</tr>
<tr id="4a9a47af-4672-4cb0-ac6c-aabb0dec5892">
<td class="" id="Ix=X">MAOI = monoamine oxidase inhibitor;
                                                                MDMA = 3,4-Methyl‚Äãenedioxy‚Äãmethamphetamine;<br/>SNRI =
                                                                serotonin-norepinephrine reuptake inhibitor; SSRI =
                                                                selective serotonin reuptake inhibitor; TCA = tricyclic
                                                                antidepressant.<br/></td>
<td class="" id="azhR"></td>
</tr>
</tbody>
</table>
<p class="" id="9ac7425b-d88f-4812-ae1d-0c899853938f">Serotonin syndrome
                                                    is characterized by a triad of autonomic instability (eg,
                                                    hyperthermia, hypertension, tachycardia), altered mental status (eg,
                                                    agitation, confusion), and neuromuscular hyperactivity (eg, tremor,
                                                    hyperreflexia, myoclonus), as well as gastrointestinal symptoms and
                                                    diaphoresis.  It is due to an increased serotonergic effect in the
                                                    central nervous system (eg, increased 5-HT1A and 5-HT2A receptor
                                                    stimulation).</p>
<p class="" id="5dad5bd4-f354-4bc7-b62d-6f58ea210f6f">Serotonin syndrome
                                                    rarely occurs with a single serotonergic drug used at therapeutic
                                                    doses.  More commonly, it is due to the combined effects of several
                                                    serotonergic medications, overdose, and/or a drug-drug interaction. 
                                                    Serotonin effect is increased when a monoamine oxidase inhibitor
                                                    (MAOI) is combined with a serotonergic antidepressant (selective
                                                    serotonin reuptake inhibitor [SSRI], serotonin-norepinephrine
                                                    reuptake inhibitor, or tricyclic antidepressant).</p>
<p class="" id="fc421f27-afed-41ef-b2ba-93bd64225b77">Linezolid is used
                                                    to treat infections caused by gram-positive bacteria, particularly
                                                    vancomycin-resistant enterococcus and methicillin-resistant
                                                    <em>Staphylococcus aureus</em>.  Linezolid has MAOI activity and
                                                    therefore can precipitate serotonin syndrome with concomitant use of
                                                    an SSRI (eg, paroxetine) or with other serotonergic medications.</p>
<p class="" id="44d6a3a2-557a-471e-8d65-b4993376aba2">(Choices A, B, D,
                                                    and E)  Clindamycin, doxycycline, penicillin, and vancomycin do not
                                                    have MAOI effects.  They do not cause serotonin syndrome when
                                                    combined with a serotonergic antidepressant.</p>
<p class="" id="363c3353-65f5-4cf0-b7b3-d8a85b5c3888">Educational
                                                    objective:</p>
<p class="" id="c513c081-c9dd-4f94-92cf-e9104796d503">Serotonin syndrome
                                                    is characterized by a triad of autonomic instability, altered mental
                                                    status, and neuromuscular irritability.  It may develop when a
                                                    monoamine oxidase inhibitor (MAOI) antidepressant or a
                                                    non-antidepressant with MAOI activity (eg, linezolid) is combined
                                                    with a serotonergic medication such as a selective serotonin
                                                    reuptake inhibitor, serotonin-norepinephrine reuptake inhibitor, or
                                                    tricyclic antidepressant.</p>
<p class="" id="a6233b5a-685b-4e0b-830d-15d686100c9a">References</p>
<ul class="bulleted-list" id="f86cea6e-ff9d-41e7-9624-54d0b3701a8a">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/23424229">Clinical
                                                            relevance of linezolid-associated serotonin toxicity.</a>
</li>
</ul>
<ul class="bulleted-list" id="7f042e76-7e50-4400-a492-23dfb65a01f1">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/28956544">Serotonin
                                                            syndrome due to co-administration of linezolid and
                                                            methadone.</a></li>
</ul>
<p class="" id="1e641a80-7755-4dad-a196-c1c383a3e6f6">Pharmacology</p>
<p class="" id="a0197140-09c9-4e38-bd2f-f3b342e08aa8">Subject</p>
<p class="" id="ef30fc51-baa6-4859-bc3f-7de8e3bc0465">Pharmacology
                                                    (General Principles)</p>
<p class="" id="4d8fe898-a2cd-4bb8-9b41-a77f141e3bfd">System</p>
<p class="" id="a249d0c2-eb81-4ca5-9f80-c7cacfa21785">Serotonin syndrome
                                                </p>
<p class="" id="21ba5252-ccbe-4677-ac56-8ffcb58daf59">Topic</p>
<p class="" id="6fa87e69-17ba-4692-ad2e-eb8c17a6f88a">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
