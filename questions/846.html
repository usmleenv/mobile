
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>846</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="e18acb1d-2e20-4274-ba36-6921d408f651">A 56-year-old man is evaluated
                                        for progressive visual impairment.  The patient works as part of the grounds
                                        crew at an airport, and says he has trouble identifying aircraft at a distance
                                        and with filling out paperwork at the end of his shift.  His medical history
                                        includes poorly controlled diabetes mellitus, hypertension, and gout.  A year
                                        ago, the patient underwent an uncomplicated repair of a right inguinal hernia. 
                                        Physical examination shows bilateral clouding of the lens.  The remainder of the
                                        examination is unremarkable.  Which of the following metabolic conversions is
                                        most likely contributing to this patient's current condition?</p>
<table class="simple-table" id="6677c904-e54c-411d-9105-64b034909662">
<tbody>
<tr id="94c69486-8558-4d42-89a3-6eabb7734297">
<td class="" id="UCr\">A.</td>
<td class="" id="=UWy">Galactitol to tagatose</td>
<td class="" id="VS&lt;O"></td>
</tr>
<tr id="5e9c4ef4-c915-4c6e-b691-ef6360353a40">
<td class="" id="UCr\">B.</td>
<td class="" id="=UWy">Galactose to galactitol</td>
<td class="" id="VS&lt;O"></td>
</tr>
<tr id="4e64a616-2334-4ab4-b945-5ec48e04c936">
<td class="" id="UCr\">C.</td>
<td class="" id="=UWy">Glucose to sorbitol</td>
<td class="" id="VS&lt;O"></td>
</tr>
<tr id="ff63fa28-19cc-4652-9ed1-896aa7806751">
<td class="" id="UCr\">D.</td>
<td class="" id="=UWy">Glucose-6-phosphate to 6-phosphogluconolactone
                                                </td>
<td class="" id="VS&lt;O"></td>
</tr>
<tr id="7aace85c-66e2-4d5a-adfd-1ab495d84c67">
<td class="" id="UCr\">E.</td>
<td class="" id="=UWy">Pyruvate to lactate</td>
<td class="" id="VS&lt;O"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="212153a0-cc24-4680-9d79-d7a0c042b6ae">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="8b27f79d-02d8-46dc-981f-8b779ce85805">
<tbody>
<tr id="27681b23-d2cf-4737-aaeb-d9b741072bf8">
<td class="" id="SIbb">A.</td>
<td class="" id="=e[f">Galactitol to tagatose (0%)</td>
<td class="" id=";:?h"></td>
</tr>
<tr id="6a6d2741-2cb0-4a25-9d11-b530bbcf8348">
<td class="" id="SIbb">B.</td>
<td class="" id="=e[f">Galactose to galactitol (13%)</td>
<td class="" id=";:?h"></td>
</tr>
<tr id="39627842-92fa-42fb-882e-31b3d26d1e8e">
<td class="" id="SIbb">C.</td>
<td class="" id="=e[f">Glucose to sorbitol (82%)</td>
<td class="" id=";:?h"></td>
</tr>
<tr id="97375391-c4dd-4832-91c5-3092d0820871">
<td class="" id="SIbb">D.</td>
<td class="" id="=e[f">Glucose-6-phosphate to
                                                                6-phosphogluconolactone (2%)</td>
<td class="" id=";:?h"></td>
</tr>
<tr id="77883625-d789-4278-97fe-bf39cf0045c7">
<td class="" id="SIbb">E.</td>
<td class="" id="=e[f">Pyruvate to lactate (1%)</td>
<td class="" id=";:?h"></td>
</tr>
</tbody>
</table>
<p class="" id="f462c2ee-7b33-49bf-ab92-f7fadd406d4b">Correct</p>
<p class="" id="a9646e01-945c-40e6-b07c-d4382e650712">82%Answered
                                                    correctly</p>
<p class="" id="27f6149b-d6c8-49da-8f12-eaaf946e649d">18 secsTime Spent
                                                </p>
<p class="" id="525da478-00a8-4b3a-a418-fe066b632c16">2024Version</p>
<ul class="bulleted-list" id="ce60d0fa-8f73-4edd-81c2-a9148fe23f99">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="5f46c7ea-0506-4b3f-bb2e-c52ef6d18dab">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="8697b8b5-7104-475d-9082-eed36d3a3460"><a href="https://lh7-us.googleusercontent.com/eboBeByxRexJM9-KTJkIsIodGC_h94dTsLoj-xa-z1aoSRe0zHhzzCW4ZsWBEOFMNubqHZ3wmOiOj4RvvHGda9yr_n0PCjrLhvkqeWCpZ9ECI0JzjCFl-pAoNsgrK710R_XJHgAv4OSNawSMMADyD2s"><img loading="lazy" src="https://lh7-us.googleusercontent.com/eboBeByxRexJM9-KTJkIsIodGC_h94dTsLoj-xa-z1aoSRe0zHhzzCW4ZsWBEOFMNubqHZ3wmOiOj4RvvHGda9yr_n0PCjrLhvkqeWCpZ9ECI0JzjCFl-pAoNsgrK710R_XJHgAv4OSNawSMMADyD2s" style="width:298px"/></a>
</figure>
<p class="" id="7999741d-ee48-4f33-872d-99a9f0891b67">This patient has
                                                    cataracts, an opacification of the lens of the eye that can lead to
                                                    blindness, likely a result of long-standing hyperglycemia due to
                                                    poorly controlled diabetes mellitus.  Certain cells (eg, retinal,
                                                    endothelial, lens, renal mesangial, Schwann) are more vulnerable to
                                                    hyperglycemia-induced damage because they are unable to regulate
                                                    glucose transport when circulating levels are high.</p>
<p class="" id="73388dc7-ab5b-4d18-a94c-90c9b8ff7f70">Multiple metabolic
                                                    pathways are involved in the pathogenesis of hyperglycemia-induced
                                                    tissue damage:</p>
<ul class="bulleted-list" id="a0c3f7e1-c3b0-4705-9007-b0423e3a31db">
<li style="list-style-type:disc">Advanced glycosylation end-products
                                                        (AGEs): Glucose can nonenzymatically attach to proteins and
                                                        lipids, forming reversible glycosylation products that slowly
                                                        stabilize into irreversible products. Under hyperglycemic
                                                        conditions, AGEs accumulate and facilitate deposition of LDL in
                                                        blood vessel walls and inflammatory cell invasion that causes
                                                        atherosclerosis and microangiopathic complications. High glucose
                                                        levels in the aqueous humor may also induce nonenzymatic
                                                        glycation of lens proteins, which contributes to cataract
                                                        formation.</li>
</ul>
<ul class="bulleted-list" id="79fd7827-1508-4760-b116-24ba74bdfad3">
<li style="list-style-type:disc">Polyol pathway overactivity: The
                                                        enzyme aldose reductase converts glucose to sorbitol, which is
                                                        then oxidized to fructose by the enzyme sorbitol dehydrogenase.
                                                        With hyperglycemia, formation of sorbitol occurs faster than its
                                                        metabolism to fructose, resulting in its accumulation. Sorbitol
                                                        increases the osmotic pressure in tissues and stimulates the
                                                        influx of water, leading to osmotic cellular injury. In
                                                        addition, oxidative stress resulting from the depletion of NADPH
                                                        (aldose reductase consumes NADPH) also contributes to cataract
                                                        formation and other diabetic complications such as retinopathy,
                                                        peripheral neuropathy, and nephropathy.</li>
</ul>
<p class="" id="24b3035d-fd0a-429c-bfa7-5a4926d49919">(Choices A and B) 
                                                    Aldose reductase also catalyzes the conversion of galactose
                                                    (obtained from dietary lactose) to galactitol, but sorbitol
                                                    dehydrogenase is incapable of oxidizing galactitol to its
                                                    corresponding keto sugar (tagatose, a food sweetener).  In
                                                    galactosemia (galactose 1-phosphate uridyltransferase deficiency),
                                                    excess galactitol is produced, which causes cataracts in newborns.
                                                </p>
<p class="" id="77a63dff-896c-428d-ac0c-b170ca21836e">(Choice D)  In the
                                                    hexose monophosphate shunt, glucose-6-phosphate is converted to
                                                    6-phosphogluconolactone by the enzyme glucose-6-phosphate
                                                    dehydrogenase (G6PD), generating the reducing equivalent NADPH. 
                                                    G6PD deficiency results in hemolytic anemia during times of
                                                    increased oxidative stress.</p>
<p class="" id="1592f232-7244-4cbc-b377-86afd74172ef">(Choice E) 
                                                    Lactate dehydrogenase catalyzes the conversion of pyruvate to
                                                    lactate under anaerobic conditions.  Excess lactate forms in hypoxic
                                                    states, causing metabolic acidosis.</p>
<p class="" id="71d99478-8285-4cfc-a86c-0664a858d57f">Educational
                                                    objective:</p>
<p class="" id="ecdef13b-64bf-4eae-893a-bac894a9b2c0">In hyperglycemic
                                                    states, aldose reductase converts glucose to sorbitol at a rate
                                                    faster than sorbitol can be metabolized.  Sorbitol accumulates in
                                                    certain cells such as lens cells, causing an influx of water and
                                                    resulting in osmotic cellular injury.  Depletion of NADPH by aldose
                                                    reductase also increases oxidative stress, which accelerates
                                                    development of cataracts and diabetic microvascular complications
                                                    (eg, neuropathy, retinopathy).</p>
<p class="" id="239b5f7c-3d52-4bcc-a630-ba2127124bc8">References</p>
<ul class="bulleted-list" id="200523b4-fcc6-443e-bac6-c699ca16a356">
<li style="list-style-type:disc"><a href="http://www.ncbi.nlm.nih.gov/pubmed/15919781">The
                                                            pathobiology of diabetic complications: a unifying
                                                            mechanism.</a></li>
</ul>
<p class="" id="fcc28542-e77c-4577-a8a3-fe1981429feb">Biochemistry</p>
<p class="" id="673725cb-2d5c-456a-8ddf-79b44d491930">Subject</p>
<p class="" id="1be0c69a-511c-4b92-8a78-2b01ddd1acb6">Endocrine,
                                                    Diabetes &amp; Metabolism</p>
<p class="" id="1f4a4fb4-b484-44e9-82fa-f328e4dd396b">System</p>
<p class="" id="9539c934-2d96-4b2e-b474-9853c2176670">Diabetes mellitus
                                                </p>
<p class="" id="5cd7fd84-db76-48a6-bc2b-dcf018eafc6e">Topic</p>
<p class="" id="5eb6362b-a850-45b0-aa81-1faf9564f802">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
