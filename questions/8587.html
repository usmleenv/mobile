
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>8587</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="148d299e-44a2-42b9-986b-b33e41155270">A 47-year-old morbidly obese
                                        woman comes to the physician seeking advice regarding weight loss.  She has
                                        tried diet and exercise a number of times without success.  Her other medical
                                        problems include type 2 diabetes mellitus and obstructive sleep apnea.  Her body
                                        mass index is 43 kg/m2.  After a discussion about available surgical options,
                                        she expresses interest in the adjustable gastric band, an inflatable silicone
                                        device that is placed around the cardiac part of the stomach.  In order to
                                        encircle the stomach, the band must pass through which of the following
                                        structures?</p>
<table class="simple-table" id="452ae357-21c7-46cb-9a0d-183da09ac26a">
<tbody>
<tr id="4853c5b9-b119-4b72-b78e-01a55bda9947">
<td class="" id="?[I&gt;">A.</td>
<td class="" id="iJXm">Falciform ligament</td>
<td class="" id="&gt;SXR"></td>
</tr>
<tr id="dad51d8d-6587-47de-aaf6-550c8540ce9a">
<td class="" id="?[I&gt;">B.</td>
<td class="" id="iJXm">Gastrocolic ligament</td>
<td class="" id="&gt;SXR"></td>
</tr>
<tr id="65a6b2db-ebcb-4b3e-994d-65e3ec7680ef">
<td class="" id="?[I&gt;">C.</td>
<td class="" id="iJXm">Greater omentum</td>
<td class="" id="&gt;SXR"></td>
</tr>
<tr id="68646bc3-5ca7-4be1-af1f-8a7fdb22eb13">
<td class="" id="?[I&gt;">D.</td>
<td class="" id="iJXm">Lesser omentum</td>
<td class="" id="&gt;SXR"></td>
</tr>
<tr id="df37b5bb-6253-4b38-a8bf-fe75c61980da">
<td class="" id="?[I&gt;">E.</td>
<td class="" id="iJXm">Splenorenal ligament</td>
<td class="" id="&gt;SXR"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="da9205f0-f25f-4d5e-b6c4-c52680d07273">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="7548d5f3-19f7-4e45-9937-2102ba594c06">
<tbody>
<tr id="a9c551d8-8d8f-4c43-bb82-d703f696952b">
<td class="" id="?SFc">A.</td>
<td class="" id="&lt;eXh">Falciform ligament (4%)</td>
<td class="" id="G&lt;Pr"></td>
</tr>
<tr id="1abcf6ab-43cc-4024-a317-052097ceb94c">
<td class="" id="?SFc">B.</td>
<td class="" id="&lt;eXh">Gastrocolic ligament (14%)</td>
<td class="" id="G&lt;Pr"></td>
</tr>
<tr id="957f9b64-58e5-4cef-a893-afa75ff92ee3">
<td class="" id="?SFc">C.</td>
<td class="" id="&lt;eXh">Greater omentum (18%)</td>
<td class="" id="G&lt;Pr"></td>
</tr>
<tr id="47cb0721-d4ea-4179-9379-c1ffe9889f31">
<td class="" id="?SFc">D.</td>
<td class="" id="&lt;eXh">Lesser omentum (60%)</td>
<td class="" id="G&lt;Pr"></td>
</tr>
<tr id="4eeeddfb-f952-4710-82e0-a98d9df40906">
<td class="" id="?SFc">E.</td>
<td class="" id="&lt;eXh">Splenorenal ligament (2%)</td>
<td class="" id="G&lt;Pr"></td>
</tr>
</tbody>
</table>
<p class="" id="12c3a3f6-b5c2-4892-bed0-e809dd1703ec">Incorrect</p>
<p class="" id="e1b5aeb7-f5bd-4bc7-8ca7-707c3c41fce1">Correct answer D
                                                </p>
<p class="" id="afce5696-77d4-49c4-b245-8138ebe62d5c">60%Answered
                                                    correctly</p>
<p class="" id="ad3e858b-795b-47e4-8ca1-04af808c343f">13 secsTime Spent
                                                </p>
<p class="" id="c1e14edf-83bb-4acf-9fad-6bf99576a42c">2024Version</p>
<ul class="bulleted-list" id="0aea46bc-6f2d-44b9-9d02-230cd6607529">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="8cc6aa3e-3bb0-4204-8d8f-8d8068e6ad69">
<li style="list-style-type:disc"></li>
</ul>
<figure class="image" id="774c6d91-e1c8-46d4-a8fe-da6303e3ac29"><a href="https://lh7-us.googleusercontent.com/3mSRisFtei2N_g7cpUlsSdCm8lSgr4bFV4NmTDJjkwSfPJX0Vs5U0FqIgg6QgEEIwXF-s4j95El0zfWRIoTDZmufPQqswVI3h4XYQZcHLDqCS9rha7wEystMQxQWadr4LThAoyWLEqHJOS-1r9PtG8g"><img loading="lazy" src="https://lh7-us.googleusercontent.com/3mSRisFtei2N_g7cpUlsSdCm8lSgr4bFV4NmTDJjkwSfPJX0Vs5U0FqIgg6QgEEIwXF-s4j95El0zfWRIoTDZmufPQqswVI3h4XYQZcHLDqCS9rha7wEystMQxQWadr4LThAoyWLEqHJOS-1r9PtG8g" style="width:602px"/></a>
</figure>
<p class="" id="2dd0b9f5-dede-4e3d-8216-01271e485d0c">Adjustable gastric
                                                    banding is a type of restrictive bariatric surgery designed for
                                                    obese patients.  The adjustable gastric band is an inflatable
                                                    silicone device placed around the gastric cardia.  It is intended to
                                                    slow the passage of food, increasing satiety and limiting the amount
                                                    of food consumed.  To encircle the upper stomach, the gastric band
                                                    must pass through the lesser omentum.</p>
<p class="" id="b1af5292-542f-4e26-8a76-7574dd20ea59">The lesser omentum
                                                    is a double layer of peritoneum that extends from the liver to the
                                                    lesser curvature of the stomach and the beginning of the duodenum. 
                                                    Anatomically, the lesser omentum is divided into 2 ligaments:</p>
<ol class="numbered-list" id="779f7086-6046-44f3-b647-0be509c985e9" start="1" type="1">
<li>Hepatogastric ligament: the portion connecting to the lesser
                                                        curvature of the stomach</li>
</ol>
<ol class="numbered-list" id="81a25beb-3522-4b0a-a48f-a7203eb2c69d" start="2" type="1">
<li>Hepatoduodenal ligament: the portion connecting to the duodenum
                                                    </li>
</ol>
<p class="" id="e361add3-d56d-4201-9bfb-6e5d44e01996">Between the 2
                                                    layers of the lesser omentum, close to the right-sided free margin,
                                                    lie the hepatic artery, common bile duct, portal vein, lymphatics,
                                                    and hepatic plexus.  The right and left gastric arteries and gastric
                                                    veins also lie between the 2 layers, near where the lesser omentum
                                                    attaches to the stomach.</p>
<p class="" id="3c62b152-1304-4768-9bb3-309913262575">(Choice A)  The
                                                    falciform ligament attaches the liver to the anterior body wall.  It
                                                    is a derivative of the embryonic ventral mesentery and contains the
                                                    round ligament, the remnant of the fetal umbilical vein.</p>
<p class="" id="fad7d710-3b75-4c15-b51e-bd0717d9f0a6">(Choices B and C) 
                                                    The greater omentum is a large fold of visceral peritoneum that
                                                    extends from the greater curvature of the stomach, travels
                                                    inferiorly over the small intestine, and then reflects on itself and
                                                    ascends to encompass the transverse colon before reaching the
                                                    posterior abdominal wall.  The gastrocolic ligament is the section
                                                    that stretches from the greater curvature of the stomach to the
                                                    transverse colon.  It forms part of the anterior wall of the lesser
                                                    sac and is often divided during surgery to provide access to the
                                                    anterior pancreas and posterior wall of the stomach.</p>
<p class="" id="3adf40ec-abef-443e-993e-e0d0c7622db6">(Choice E)  The
                                                    splenorenal ligament is derived from the peritoneum and lies between
                                                    the left kidney and the spleen.  It contains the splenic vessels and
                                                    the tail of the pancreas.</p>
<p class="" id="05a9a589-c32c-499b-b17e-5d3a351cb6a9">Educational
                                                    objective:</p>
<p class="" id="b51c04e9-55ac-4f9f-bfe1-512ea0133a1a">The lesser omentum
                                                    is a double layer of peritoneum that extends from the liver to the
                                                    lesser curvature of the stomach and the beginning of the duodenum. 
                                                    It is divided into the hepatogastric and hepatoduodenal ligaments.
                                                </p>
<p class="" id="5d098b99-341a-44fe-bb14-afbb53a83364">Anatomy</p>
<p class="" id="bcd65285-7fb7-4216-ae2d-9871fb024547">Subject</p>
<p class="" id="71aed409-2c2c-49c1-be43-6e658a4c52c7">Gastrointestinal
                                                    &amp; Nutrition</p>
<p class="" id="6d1dc9bc-389d-4ad3-baba-d8b052fc65f3">System</p>
<p class="" id="c4e5174b-25e8-4a5e-bf32-3a4a053e711f">Obesity</p>
<p class="" id="c653cb78-5d6d-4fce-8a84-3b87b6f7b31d">Topic</p>
<p class="" id="fa82ec15-7988-406f-b2b6-5fc3bf05c100">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="d6ebaad0-805c-4651-9b22-3a45919d0c42">‚ú®Done</p>
<p class="" id="6df38da3-df53-46e5-ad40-26d36fec8618">Exhibit Display
                                                </p>
<figure class="image" id="115ee90c-04f1-425a-9489-fb49b3479237"><a href="https://lh7-us.googleusercontent.com/HARNebsuiU_QuMqOaImov7p3_gbyWs8wIXQvhnS_LOee4nEwzOsBMkdW7McunC_DgfgR5t-Ny36PPdygFSxyDDGopeKCthlcLcmdrcFKGm-X3l8ucXPrwa6jNQbbL_xGHCxxjj3HTaXtrLuHNp8rgzE"><img loading="lazy" src="https://lh7-us.googleusercontent.com/HARNebsuiU_QuMqOaImov7p3_gbyWs8wIXQvhnS_LOee4nEwzOsBMkdW7McunC_DgfgR5t-Ny36PPdygFSxyDDGopeKCthlcLcmdrcFKGm-X3l8ucXPrwa6jNQbbL_xGHCxxjj3HTaXtrLuHNp8rgzE" style="width:602px"/></a>
</figure>
<p class="" id="371fffee-0054-4dd4-bc25-e629d2cef581">Zoom InZoom Out 
                                                    ResetNew</p>
<p class="" id="8a4b3ae0-1cc5-4bdb-84a4-8c41c408903f">ExistingMy
                                                    Notebook</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
