
<style>
    * {
        box-sizing: border-box !important;
    }

    body {
        font-family: 'Inter', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        line-height: 1.9 !important;
        color: #1f1f1f !important;
        max-width: none !important;
        margin: 0 !important;
        padding: 8px 16px 16px 16px !important;
        background: #ffffff !important;
        font-size: 16.5px !important;
    }

    p {
        margin-bottom: 20px !important;
        font-size: 16.5px !important;
        line-height: 1.95 !important;
        color: #1f1f1f !important;
        font-weight: 400 !important;
    }

    strong, b {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        background: rgba(26, 115, 232, 0.08) !important;
        padding: 2px 6px !important;
        border-radius: 8px !important;
    }

    /* Details/Summary (collapsible sections) */
    details {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%) !important;
        border-radius: 8px !important;
        padding: 24px 28px !important;
        margin: 24px 0 !important;
        border: none;
        box-shadow: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    details:hover {
        border-color: #1a73e8 !important;
        box-shadow: none !important;
        transform: translateY(-2px) !important;
    }

    details[open] {
        background: #ffffff !important;
        border-color: #1a73e8 !important;
        box-shadow: none !important;
    }

    summary {
        cursor: pointer !important;
        font-weight: 800 !important;
        color: #ffffff !important;
        font-size: 20px !important;
        padding: 16px 24px !important;
        border-radius: 8px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        display: flex !important;
        align-items: center !important;
        user-select: none !important;
        box-shadow: none !important;
        letter-spacing: 0.5px !important;
    }

    summary:hover {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        transform: translateX(6px) scale(1.02) !important;
        box-shadow: none !important;
    }

    summary:active {
        transform: translateX(4px) scale(0.99) !important;
    }

    summary::marker {
        color: rgba(255, 255, 255, 0.9) !important;
        font-size: 1.3em !important;
    }

    summary strong {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        padding: 4px 12px !important;
        border-radius: 8px !important;
        margin-left: 8px !important;
        font-size: 19px !important;
        letter-spacing: 1px !important;
    }

    /* Tables - Premium Design */
    table {
        width: 100% !important;
        border-collapse: separate !important;
        border-spacing: 0 !important;
        margin: 28px 0 !important;
        border-radius: 8px !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
        background: #ffffff !important;
    }

    table.simple-table {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
    }

    table tr {
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
        position: relative !important;
    }

    table tr:nth-child(odd) {
        background: rgba(248, 249, 250, 0.5) !important;
    }

    table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.8) !important;
    }

    table tr:hover {
        background: linear-gradient(90deg, #e8f0fe 0%, #f1f8ff 100%) !important;
        transform: translateX(4px) scale(1.01) !important;
        box-shadow: none !important;
        z-index: 1 !important;
    }

    table td {
        padding: 18px 24px !important;
        border-bottom: 1px solid rgba(232, 234, 237, 0.6) !important;
        font-size: 16.5px !important;
        line-height: 1.7 !important;
        color: #1f1f1f !important;
        vertical-align: middle !important;
    }

    table tr:last-child td {
        border-bottom: none !important;
    }

    /* First column (A, B, C, D, E) */
    table td:first-child {
        font-weight: 800 !important;
        color: #ffffff !important;
        width: 52px !important;
        text-align: center !important;
        font-size: 18px !important;
        background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%) !important;
        border-right: 3px solid #1557b0 !important;
        position: relative !important;
        letter-spacing: 0.5px !important;
    }

    table tr:hover td:first-child {
        background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%) !important;
        box-shadow: none !important;
    }

    /* Second column (content) */
    table td:nth-child(2) {
        font-weight: 500 !important;
        padding-left: 28px !important;
    }

    /* Third column (empty - hide it) */
    table td:last-child:empty {
        display: none !important;
    }

    /* Lists */
    ul, ol {
        margin: 16px 0 !important;
        padding-left: 32px !important;
    }

    li {
        margin: 10px 0 !important;
        line-height: 1.8 !important;
        color: #1f1f1f !important;
    }

    ul.bulleted-list li {
        position: relative !important;
        padding-left: 8px !important;
    }

    ul.toggle {
        list-style: none !important;
        padding-left: 0 !important;
    }

    /* Links */
    a {
        color: #1a73e8 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        border-bottom: 2px solid transparent !important;
        transition: all 0.2s !important;
    }

    a:hover {
        border-bottom-color: #1a73e8 !important;
        background: rgba(26,115,232,0.08) !important;
        padding: 2px 4px !important;
        border-radius: 8px !important;
    }

    /* Images & Media */
    img, video {
        max-width: none !important;
        height: auto !important;
        border-radius: 8px !important;
        box-shadow: none !important;
        margin: 24px 0 !important;
        display: block !important;
        border: none !important;
    }

    img:hover, video:hover {
        box-shadow: none !important;
        border-color: #1a73e8 !important;
    }

    /* Code blocks (if any) */
    code {
        background: #f1f3f4 !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        font-family: 'Courier New', monospace !important;
        font-size: 14px !important;
        color: #d93025 !important;
    }

    pre {
        background: #f8f9fa !important;
        padding: 8px 16px 16px 16px !important;
        border-radius: 8px !important;
        overflow-x: auto !important;
        border-left: 4px solid #1a73e8 !important;
    }

    /* Headings */
    h1, h2, h3, h4, h5, h6 {
        color: #1a73e8 !important;
        font-weight: 700 !important;
        margin-top: 24px !important;
        margin-bottom: 16px !important;
        line-height: 1.4 !important;
    }

    h1 { font-size: 32px !important; }
    h2 { font-size: 26px !important; }
    h3 { font-size: 22px !important; }
    h4 { font-size: 19px !important; }

    /* Blockquotes */
    blockquote {
        border-left: 4px solid #1a73e8 !important;
        padding-left: 20px !important;
        margin: 20px 0 !important;
        font-style: italic !important;
        color: #5f6368 !important;
        background: #f8f9fa !important;
        padding: 16px 20px !important;
        border-radius: 8px !important;
    }

    /* Horizontal Rule */
    hr {
        border: none !important;
        height: 2px !important;
        background: linear-gradient(to right, transparent, #1a73e8, transparent) !important;
        margin: 32px 0 !important;
    }

    /* Selection */
    ::selection {
        background: #e8f0fe !important;
        color: #1a73e8 !important;
    }

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>




<details open>
<summary><strong>972</strong><button class="bionic-reading-btn" onclick="toggleBionicReading(event)" title="Toggle Bionic Reading (Ctrl+B)"><span id="bionicIcon">üëÅÔ∏è</span></button><button class="highlighter-btn" onclick="toggleHighlighter(event)" title="Toggle Highlighter (Ctrl+H)"><span id="highlighterIcon">üñäÔ∏è</span></button></summary>
<p class="" id="a6edbffa-f816-41e1-be80-04663293a37d">A 34-year-old man comes to the
                                        emergency department due to 2 days of fever, malaise, and myalgia.  He has also
                                        had worsening shortness of breath and cough.  The patient works in the mail room
                                        at a large company, does not smoke cigarettes, and drinks alcohol occasionally. 
                                        Chest imaging shows lung infiltrates and prominent widening of the mediastinum. 
                                        Sputum and blood cultures yield large, gram-positive rods that form colonies
                                        resembling a "Medusa head."  Which of the following is the most likely
                                        bacterial virulence factor contributing to this patient's condition?</p>
<table class="simple-table" id="73c74bcb-9633-49ce-b44f-c224754617fb">
<tbody>
<tr id="ee626e49-a198-4e3a-ba8a-53e826e7073c">
<td class="" id="}=wx">A.</td>
<td class="" id="vHx&gt;">Antiphagocytic D-glutamate capsule</td>
<td class="" id="@UdP"></td>
</tr>
<tr id="b5ed43fd-515f-4925-97b0-2fa130833245">
<td class="" id="}=wx">B.</td>
<td class="" id="vHx&gt;">Antiphagocytic polysaccharide capsule</td>
<td class="" id="@UdP"></td>
</tr>
<tr id="c97598b5-06ca-49cd-a43d-cb0daba7fced">
<td class="" id="}=wx">C.</td>
<td class="" id="vHx&gt;">IgG-binding, outer membrane protein</td>
<td class="" id="@UdP"></td>
</tr>
<tr id="dd1fe383-34a5-4604-b5bb-2aa7be6b9f68">
<td class="" id="}=wx">D.</td>
<td class="" id="vHx&gt;">Intracellular polyphosphate granules</td>
<td class="" id="@UdP"></td>
</tr>
<tr id="30693c47-a737-4d87-8ed0-4b9c557e5bae">
<td class="" id="}=wx">E.</td>
<td class="" id="vHx&gt;">Peritrichous flagella</td>
<td class="" id="@UdP"></td>
</tr>
</tbody>
</table>
<ul class="toggle" id="a7b26485-96f7-49f7-88d1-9c3e2ed61ed2">
<li>
<details>
<summary>Submit</summary>
<table class="simple-table" id="de0621f1-67a6-4c71-a2cd-9583c4760c2b">
<tbody>
<tr id="b7647d4e-621d-40dd-8f57-c087c1c38c9c">
<td class="" id="q|ql">A.</td>
<td class="" id="[=Zb">Antiphagocytic D-glutamate capsule
                                                                (61%)</td>
<td class="" id="\Lrp"></td>
</tr>
<tr id="acfc39bd-f9f5-4371-af69-9a9997a2dc41">
<td class="" id="q|ql">B.</td>
<td class="" id="[=Zb">Antiphagocytic polysaccharide capsule
                                                                (19%)</td>
<td class="" id="\Lrp"></td>
</tr>
<tr id="c8b8a8a9-3748-4da3-93f4-7363162f15e8">
<td class="" id="q|ql">C.</td>
<td class="" id="[=Zb">IgG-binding, outer membrane protein
                                                                (4%)</td>
<td class="" id="\Lrp"></td>
</tr>
<tr id="7846ccf3-7eb3-4c4e-84b8-c7fe826edf8e">
<td class="" id="q|ql">D.</td>
<td class="" id="[=Zb">Intracellular polyphosphate granules
                                                                (6%)</td>
<td class="" id="\Lrp"></td>
</tr>
<tr id="d76c6b6a-1d4c-43ef-8ebe-0d071d12ff9f">
<td class="" id="q|ql">E.</td>
<td class="" id="[=Zb">Peritrichous flagella (7%)</td>
<td class="" id="\Lrp"></td>
</tr>
</tbody>
</table>
<p class="" id="ab68796b-99b8-4ca1-a718-774f0d16ac32">Incorrect</p>
<p class="" id="69cf0739-1441-44a9-922b-a5a3b9c53cd4">Correct answer A
                                                </p>
<p class="" id="aa651d97-3564-4468-9cf7-f61c58b32967">61%Answered
                                                    correctly</p>
<p class="" id="35186585-da7b-4bb3-a701-a5c7d1ee2516">14 secsTime Spent
                                                </p>
<p class="" id="1da3feea-d0a2-4929-a066-e7b838faa5d4">2024Version</p>
<ul class="bulleted-list" id="af347b21-fc11-4014-a4f5-6049705b63e4">
<li style="list-style-type:disc">Explanation</li>
</ul>
<ul class="bulleted-list" id="93b5ae13-4a90-4cd4-925c-a8df48b57503">
<li style="list-style-type:disc"></li>
</ul>
<p class="" id="51c3cfe0-1e76-4ae2-9982-5c35bde95b84"><em>Bacillus
                                                        anthracis</em> is a large, nonmotile, nonhemolytic,
                                                    gram-positive rod that forms colonies in culture with multiple
                                                    curled extensions at the edges that resemble a "Medusa
                                                    head."  Because the organism proliferates in soil contaminated
                                                    with manure, pasture-grazing herbivores such as sheep, cattle, and
                                                    horses are at greatest risk for infection.  However, transmission to
                                                    humans occasionally occurs when <em>B anthracis</em> spores are
                                                    inhaled, ingested, or inoculated into the skin.</p>
<p class="" id="ba4bdd37-af36-4bde-aeb1-58791a846792">Inhalation of
                                                    spores into the alveoli causes pulmonary anthrax.  Alveolar
                                                    macrophages phagocytose the spores and bring them to mediastinal
                                                    lymph nodes, where the spores germinate into vegetative rods and
                                                    multiply.  The vegetative form of the bacteria contains a
                                                    polypeptide capsule composed of D-glutamic acid, which is
                                                    antiphagocytic.  <em>B anthracis</em> rods also produce a potent
                                                    exotoxin complex composed of edema factor, lethal factor, and
                                                    protective antigen, which enter host cells and cause cell death.</p>
<p class="" id="c206f25c-2681-49cb-9acf-9b9ccd143c33">Initial
                                                    manifestations of infection are nonspecific (eg, myalgia, fever,
                                                    malaise), but proliferation of the bacteria in the mediastinum
                                                    eventually causes hemorrhagic mediastinitis (often visible on chest
                                                    x-ray as a widened mediastinum).  Subsequent dissemination through
                                                    the bloodstream causes shock, brain edema/hemorrhage, and death. 
                                                    Although pulmonary anthrax is quite rare, it can be seen in
                                                    individuals who handle contaminated hides or animal hair
                                                    ("woolsorter's disease") or those exposed to
                                                    aerosolized biologic weapons (eg, opening contaminated mail).</p>
<p class="" id="ebcab19b-7aad-48b1-b9d8-2a4f2efe4be3">(Choice B)  Many
                                                    bacteria (eg, <em>Streptococcus pneumoniae</em>) are resistant to
                                                    phagocytosis due to the presence of a polysaccharide capsule. 
                                                    However, <em>B anthracis</em> has a polypeptide, not polysaccharide,
                                                    capsule.</p>
<p class="" id="fa236fad-80c4-4e64-9fa5-31da8e79b3f4">(Choice C) 
                                                    <em>Staphylococcus aureus</em> produces protein A, which binds the
                                                    Fc portion of IgG.  This inhibits opsonization and
                                                    complement-mediated killing of the bacteria.</p>
<p class="" id="d7f9d2b5-1d7c-40b9-b7af-e8ea329ec0fb">(Choice D) 
                                                    Intracellular polyphosphate granules are characteristic of
                                                    <em>Corynebacterium diphtheriae</em>; they can be visualized on
                                                    microscopy after growing the pathogen on Loeffler medium and
                                                    staining it with methylene blue.</p>
<p class="" id="f3bc63eb-6558-4c29-b5c1-2e7ba2d8d2aa">(Choice E) 
                                                    Peritrichous flagella (flagella distributed uniformly over the
                                                    entire surface of a bacterial cell) are not present on the surface
                                                    of <em>B anthracis</em> as this organism is nonmotile.  Peritrichous
                                                    flagella are characteristic of highly motile organisms such as
                                                    <em>Proteus mirabilis</em>.</p>
<p class="" id="00fbeaa1-c503-44cb-af79-799fcd9cb4ca">Educational
                                                    objective:</p>
<p class="" id="b220f068-442e-4f61-943c-231f5f46c010"><em>Bacillus
                                                        anthracis</em> is a large, sporulating, gram-positive rod that
                                                    is encased in an antiphagocytic polypeptide capsule composed of
                                                    D-glutamic acid.  Inhalation of <em>B anthracis</em> spores can
                                                    cause pulmonary anthrax, which is usually characterized by
                                                    nonspecific symptoms followed by hemorrhagic mediastinitis, shock,
                                                    and death.</p>
<p class="" id="1e1fe961-9a76-4f6f-b357-0a1d1ce8eb25">Microbiology</p>
<p class="" id="2ad6d089-fecc-40c0-aef3-2e593ebcf56c">Subject</p>
<p class="" id="eae04415-dd05-450e-a915-141735214db7">Infectious
                                                    Diseases</p>
<p class="" id="18d67a13-175c-4059-b4c5-c95b11cdf53e">System</p>
<p class="" id="309a4a61-a347-4b3d-b750-c1e024cb4a08">Anthrax</p>
<p class="" id="3a800df1-bdf5-4209-b26a-686edba53576">Topic</p>
<p class="" id="a1af0796-8112-4bf3-a355-3443b09267b1">Copyright ¬©
                                                    UWorld. All rights reserved.</p>
<p class="" id="27f2fd72-2cb7-4b6e-9d29-cf9034bceda5">‚ùåelementFinder:
                                                    //a[@href='javascript:void(0)']</p>
</details>
</li>
</ul>
</details>


















<style>
.bionic-reading-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    margin-left: auto;
    flex-shrink: 0;
}

.bionic-reading-btn:hover {
    background: rgba(255, 255, 255, 0.35);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.bionic-reading-btn.active {
    background: rgba(52, 168, 83, 0.4);
    border-color: rgba(52, 168, 83, 0.6);
}

.bionic-reading-btn.active:hover {
    background: rgba(52, 168, 83, 0.5);
}

summary {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
}

    /* Highlighter styles */
    .highlighted {
        background-color: #ffeb3b !important;
        transition: background-color 0.2s ease !important;
    }

    .highlighter-btn {
        background: none !important;
        border: none !important;
        cursor: pointer !important;
        font-size: 20px !important;
        padding: 0 8px !important;
        margin-left: 8px !important;
        transition: transform 0.2s ease !important;
        vertical-align: middle !important;
    }

    .highlighter-btn:hover {
        transform: scale(1.2) !important;
    }

    .highlighter-btn.active {
        transform: scale(1.1) !important;
        filter: brightness(1.2) !important;
    }

    .highlighter-mode-active {
        cursor: text !important;
    }


    /* Right padding to avoid overlap with sidebar buttons */
    body {
        padding-right: 50px !important;
    }

    @media (max-width: 768px) {
        body {
            padding-right: 16px !important;
        }
    }

</style>



<script>
let bionicEnabled = false;
const originalContent = {};

function toggleBionicReading(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }

    bionicEnabled = !bionicEnabled;
    const btn = document.querySelector('.bionic-reading-btn');
    const icon = document.getElementById('bionicIcon');

    if (bionicEnabled) {
        btn.classList.add('active');
        icon.textContent = '‚úÖ';
        applyBionicReading();
    } else {
        btn.classList.remove('active');
        icon.textContent = 'üëÅÔ∏è';
        restoreOriginalText();
    }
}

function applyBionicReading() {
    // Seleciona todos os elementos de texto, EXCETO summary e buttons
    const textElements = document.querySelectorAll('p:not(summary p):not(button p), td:not(summary td):not(button td), li:not(summary li):not(button li)');

    textElements.forEach((element, index) => {
        // Ignora elementos que cont√™m outros elementos complexos
        if (element.querySelector('p, td, li, h1, h2, h3, h4, h5, h6, button, summary')) {
            return;
        }

        // Ignora se o elemento est√° dentro de um summary ou button
        if (element.closest('summary') || element.closest('button') || element.closest('.bionic-reading-btn')) {
            return;
        }

        // Salva o conte√∫do original
        if (!originalContent[index]) {
            originalContent[index] = {
                element: element,
                html: element.innerHTML
            };
        }

        // Aplica Bionic Reading
        const bionicText = convertToBionic(element.textContent);
        element.innerHTML = bionicText;
    });
}

function restoreOriginalText() {
    // Restaura o conte√∫do original
    Object.values(originalContent).forEach(item => {
        item.element.innerHTML = item.html;
    });
}

function convertToBionic(text) {
    // Divide o texto em palavras, mantendo pontua√ß√£o
    const words = text.split(/(\s+|[.,;:!?()""''\-‚Äì‚Äî])/);

    const bionicWords = words.map(word => {
        // Ignora espa√ßos e pontua√ß√£o
        if (word.match(/^\s+$/) || word.match(/^[.,;:!?()""''\-‚Äì‚Äî]+$/)) {
            return word;
        }

        // Ignora palavras muito curtas (1-2 letras)
        if (word.length <= 2) {
            return word;
        }

        // Determina quantas letras deixar em negrito (metade da palavra, arredondado para cima)
        const boldLength = Math.ceil(word.length / 2);

        // Separa a parte em negrito da parte normal
        const boldPart = word.substring(0, boldLength);
        const normalPart = word.substring(boldLength);

        // Retorna com a primeira parte em negrito
        return `<strong style="font-weight: 700 !important; color: inherit !important; background: none !important; padding: 0 !important;">${boldPart}</strong>${normalPart}`;
    });

    return bionicWords.join('');
}

// Adiciona atalho de teclado (Ctrl+B ou Cmd+B)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
        e.preventDefault();
        toggleBionicReading();
    }
});
</script>

<script>
    let highlighterActive = false;
    let questionHighlights = {};

    // Get question ID from the first summary strong tag
    function getQuestionId() {
        const firstSummary = document.querySelector('summary strong');
        return firstSummary ? firstSummary.textContent.trim() : '1';
    }

    // Load highlights from localStorage
    function loadHighlights() {
        const questionId = getQuestionId();
        const stored = localStorage.getItem('highlights_' + questionId);
        if (stored) {
            questionHighlights = JSON.parse(stored);
            applyStoredHighlights();
        }
    }

    // Save highlights to localStorage
    function saveHighlights() {
        const questionId = getQuestionId();
        localStorage.setItem('highlights_' + questionId, JSON.stringify(questionHighlights));
    }

    // Apply stored highlights
    function applyStoredHighlights() {
        Object.keys(questionHighlights).forEach(key => {
            const element = document.querySelector(`[data-highlight-id="${key}"]`);
            if (element && questionHighlights[key]) {
                element.classList.add('highlighted');
            }
        });
    }

    // Toggle highlighter mode
    function toggleHighlighter(event) {
        event.stopPropagation();
        highlighterActive = !highlighterActive;

        const btn = event.target.closest('.highlighter-btn');
        const icon = btn.querySelector('#highlighterIcon');

        if (highlighterActive) {
            btn.classList.add('active');
            icon.textContent = 'üñçÔ∏è';
            document.body.classList.add('highlighter-mode-active');
        } else {
            btn.classList.remove('active');
            icon.textContent = 'üñäÔ∏è';
            document.body.classList.remove('highlighter-mode-active');
        }
    }

    // Clear all highlights for this question
    function clearHighlights() {
        const questionId = getQuestionId();
        questionHighlights = {};
        localStorage.removeItem('highlights_' + questionId);
        document.querySelectorAll('.highlighted').forEach(el => {
            el.classList.remove('highlighted');
        });
    }

    // Handle text selection and highlighting
    document.addEventListener('mouseup', function(e) {
        if (!highlighterActive) return;

        const selection = window.getSelection();
        if (!selection.toString().trim()) return;

        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer;

        // Only highlight text in paragraphs, not in buttons or other elements
        const paragraph = container.nodeType === 3 ? container.parentElement : container;
        if (paragraph.tagName !== 'P' && paragraph.tagName !== 'LI' && paragraph.tagName !== 'TD') {
            return;
        }

        // Create highlight span
        const span = document.createElement('span');
        span.classList.add('highlighted');

        // Generate unique ID for this highlight
        const highlightId = 'hl-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        span.setAttribute('data-highlight-id', highlightId);

        try {
            range.surroundContents(span);
            questionHighlights[highlightId] = true;
            saveHighlights();
        } catch (e) {
            console.log('Could not highlight selection');
        }

        selection.removeAllRanges();
    });

    // Load highlights when page loads
    window.addEventListener('load', loadHighlights);

    // Keyboard shortcut: Ctrl+H to toggle highlighter
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            const btn = document.querySelector('.highlighter-btn');
            if (btn) {
                toggleHighlighter({target: btn, stopPropagation: () => {}});
            }
        }
        // Ctrl+Shift+H to clear all highlights
        if (e.ctrlKey && e.shiftKey && e.key === 'H') {
            e.preventDefault();
            if (confirm('Clear all highlights for this question?')) {
                clearHighlights();
            }
        }
    });
</script>
